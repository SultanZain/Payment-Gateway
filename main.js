(()=>{"use strict";var e=[,e=>{e.exports=require("@nestjs/common")},e=>{e.exports=require("@nestjs/core")},(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.AppModule=void 0;const o=a(4),r=a(1),n=a(5),i=a(8),d=a(57),y=a(58),s=a(13),p=a(141),c=a(142),u=a(15),_=a(14),l=a(29),m=a(17),v=a(16),f=a(53);let g=class AppModule{};t.AppModule=g,t.AppModule=g=o.__decorate([(0,r.Module)({imports:[d.CryptoModule,y.PaymentModule,l.HttpModule,s.TypeOrmModule.forRootAsync({useFactory:async()=>{const e={type:"mysql",host:process.env.MYSQL_HOST||"localhost",port:3306,username:process.env.MYSQL_USER||"root",password:process.env.MYSQL_PASS||"defaultpassword"},t=await(0,u.createConnection)({...e,name:"ts"});return await t.query(`CREATE DATABASE IF NOT EXISTS ${process.env.MYSQL_DB||"waves"}`),{...e,database:process.env.MYSQL_DB||"waves",autoLoadEntities:!0,logging:!0}}}),s.TypeOrmModule.forFeature([_.PaymentGatewayEntity,m.SavedPaymentMethodEntity,v.GatewayToUserEntity,f.PayoutMethodEntity]),p.ConfigModule.forRoot(),c.GatewaysModule],controllers:[n.AppController],providers:[i.AppService]})],g)},e=>{e.exports=require("tslib")},(e,t,a)=>{var o,r,n,i,d,y,s,p,c,u,_,l,m,v,f,g,b,S;Object.defineProperty(t,"__esModule",{value:!0}),t.AppController=void 0;const P=a(4),O=a(1),M=a(6),E=a(7),C=a(8);let h=class AppController{constructor(e){this.appService=e}async defaultPath(e){e.send(`\u2705 Payment Gateways microservice running.\nVersion: ${E.version}`)}async createPaymentLink(e){return this.appService.createPaymentLink(e.body)}async pay(e,t){let a=await this.appService.createPaymentLink(e.query);t.redirect(301,a.url)}async capturePayment(e){return{status:"success"==(await this.appService.capturePayment({id:e.query.id,amount:parseFloat(e.query.amount)})).status?"OK":"FAILED"}}async cancelPreauthPayment(e){return this.appService.cancelCapture({id:e.query.id}),{status:"OK"}}async setupSavedPaymentMethod(e,t){O.Logger.log(e.body.token,"setupSavedPaymentMethod");const a=await this.appService.setupSavedPaymentMethod(e.body.token);return t.send(a),a}async chargeSavedPaymentMethod(e){return this.appService.chargeSavedPaymentMethod(e.body)}async getPayoutLinkUrl(e,t){const a=await this.appService.getPayoutLinkUrl(e.body);return t.send(a),a}};t.AppController=h,P.__decorate([(0,O.Get)(),P.__param(0,(0,O.Res)()),P.__metadata("design:type",Function),P.__metadata("design:paramtypes",["function"==typeof(r=void 0!==M.FastifyReply&&M.FastifyReply)?r:Object]),P.__metadata("design:returntype",Promise)],h.prototype,"defaultPath",null),P.__decorate([(0,O.Post)("create_payment_link"),P.__param(0,(0,O.Req)()),P.__metadata("design:type",Function),P.__metadata("design:paramtypes",["function"==typeof(n=void 0!==M.FastifyRequest&&M.FastifyRequest)?n:Object]),P.__metadata("design:returntype","function"==typeof(i="undefined"!=typeof Promise&&Promise)?i:Object)],h.prototype,"createPaymentLink",null),P.__decorate([(0,O.Get)("pay"),P.__param(0,(0,O.Req)()),P.__param(1,(0,O.Res)()),P.__metadata("design:type",Function),P.__metadata("design:paramtypes",["function"==typeof(d=void 0!==M.FastifyRequest&&M.FastifyRequest)?d:Object,"function"==typeof(y=void 0!==M.FastifyReply&&M.FastifyReply)?y:Object]),P.__metadata("design:returntype",Promise)],h.prototype,"pay",null),P.__decorate([(0,O.Get)("capture"),P.__param(0,(0,O.Req)()),P.__metadata("design:type",Function),P.__metadata("design:paramtypes",["function"==typeof(s=void 0!==M.FastifyRequest&&M.FastifyRequest)?s:Object]),P.__metadata("design:returntype","function"==typeof(p="undefined"!=typeof Promise&&Promise)?p:Object)],h.prototype,"capturePayment",null),P.__decorate([(0,O.Get)("cancel_preauth"),P.__param(0,(0,O.Req)()),P.__metadata("design:type",Function),P.__metadata("design:paramtypes",["function"==typeof(c=void 0!==M.FastifyRequest&&M.FastifyRequest)?c:Object]),P.__metadata("design:returntype","function"==typeof(u="undefined"!=typeof Promise&&Promise)?u:Object)],h.prototype,"cancelPreauthPayment",null),P.__decorate([(0,O.Post)("setup_saved_payment_method"),P.__param(0,(0,O.Req)()),P.__param(1,(0,O.Res)()),P.__metadata("design:type",Function),P.__metadata("design:paramtypes",["function"==typeof(_=void 0!==M.FastifyRequest&&M.FastifyRequest)?_:Object,"function"==typeof(l=void 0!==M.FastifyReply&&M.FastifyReply)?l:Object]),P.__metadata("design:returntype","function"==typeof(m="undefined"!=typeof Promise&&Promise)?m:Object)],h.prototype,"setupSavedPaymentMethod",null),P.__decorate([(0,O.Post)("charge_saved_payment_method"),P.__param(0,(0,O.Req)()),P.__metadata("design:type",Function),P.__metadata("design:paramtypes",["function"==typeof(v=void 0!==M.FastifyRequest&&M.FastifyRequest)?v:Object]),P.__metadata("design:returntype","function"==typeof(f="undefined"!=typeof Promise&&Promise)?f:Object)],h.prototype,"chargeSavedPaymentMethod",null),P.__decorate([(0,O.Post)("get_payout_link_url"),P.__param(0,(0,O.Req)()),P.__param(1,(0,O.Res)()),P.__metadata("design:type",Function),P.__metadata("design:paramtypes",["function"==typeof(g=void 0!==M.FastifyRequest&&M.FastifyRequest)?g:Object,"function"==typeof(b=void 0!==M.FastifyReply&&M.FastifyReply)?b:Object]),P.__metadata("design:returntype","function"==typeof(S="undefined"!=typeof Promise&&Promise)?S:Object)],h.prototype,"getPayoutLinkUrl",null),t.AppController=h=P.__decorate([(0,O.Controller)(),P.__metadata("design:paramtypes",["function"==typeof(o=void 0!==C.AppService&&C.AppService)?o:Object])],h)},e=>{e.exports=require("fastify")},e=>{e.exports=JSON.parse('{"name":"ridy","version":"3.1.5","license":"MIT","scripts":{"ng":"nx","postinstall":"node ./decorate-angular-cli.js","nx":"nx","start":"ts-node src/index.ts","build":"ng build","test":"ng test","lint":"nx workspace-lint && ng lint","e2e":"ng e2e","affected:apps":"nx affected:apps","affected:libs":"nx affected:libs","affected:build":"nx affected:build","affected:e2e":"nx affected:e2e","affected:test":"nx affected:test","affected:lint":"nx affected:lint","affected:dep-graph":"nx affected:dep-graph","affected":"nx affected","format":"nx format:write","format:write":"nx format:write","format:check":"nx format:check","update":"nx migrate latest","workspace-generator":"nx workspace-generator","dep-graph":"nx dep-graph","help":"nx help","i18n:extract":"ngx-translate-extract --input ./apps/admin-panel/src --output ./apps/admin-panel/src/assets/i18n/{en,es,bn,de,hi,ko,id,ja,pt,ru,ur,zh,fr,ar,hy}.json --clean --format namespaced-json","typeorm":"node --require ts-node/register ./node_modules/typeorm/cli.js","semantic-release":"semantic-release"},"private":true,"dependencies":{"@angular/animations":"17.0.9","@angular/cdk":"17.0.6","@angular/common":"17.0.9","@angular/compiler":"17.0.9","@angular/core":"17.0.9","@angular/forms":"17.0.9","@angular/google-maps":"^16.2.1","@angular/platform-browser":"17.0.9","@angular/platform-browser-dynamic":"17.0.9","@angular/router":"17.0.9","@angular/service-worker":"17.0.9","@ant-design/icons-angular":"17.0.0","@antv/g2":"^4.2.10","@apollo/client":"^3.7.17","@apollo/server":"^4.9.1","@as-integrations/fastify":"^2.1.0","@fastify/cors":"^8.3.0","@fastify/multipart":"^7.7.3","@fastify/static":"^6.10.2","@googlemaps/google-maps-services-js":"^3.3.34","@ingameltd/payu":"^1.0.5","@nestjs/apollo":"12.0.11","@nestjs/axios":"^3.0.1","@nestjs/common":"10.3.1","@nestjs/config":"^3.1.1","@nestjs/core":"10.3.1","@nestjs/graphql":"^12.0.11","@nestjs/jwt":"^10.2.0","@nestjs/passport":"^10.0.0","@nestjs/platform-fastify":"^10.3.1","@nestjs/schedule":"^4.0.0","@nestjs/serve-static":"^4.0.0","@nestjs/typeorm":"10.0.1","@nestjs/websockets":"^10.3.1","@nx/angular":"17.2.8","@nx/web":"17.2.8","@paypal/checkout-server-sdk":"^1.0.3","@ptc-org/nestjs-query-core":"^4.2.0","@ptc-org/nestjs-query-graphql":"^4.2.0","@ptc-org/nestjs-query-typeorm":"^4.2.0","@songkeys/nestjs-redis":"^10.0.0","apollo-angular":"^6.0.0","autoprefixer":"^10.4.14","class-transformer":"0.5.1","class-validator":"0.14.0","core-js":"^3.37.0","dataloader":"^2.2.2","dotenv":"16.3.1","fastify":"^4.21.0","firebase-admin":"^11.10.1","graphql":"^16.7.1","graphql-redis-subscriptions":"^2.6.0","graphql-relay":"^0.10.0","graphql-subscriptions":"^2.0.0","graphql-tools":"^9.0.0","handlebars":"^4.7.7","instamojo-payment-nodejs":"^3.0.0","ioredis":"^5.3.2","json-2-csv":"^4.0.0","jwt-decode":"^3.1.2","mercadopago":"^1.5.17","mysql2":"^3.9.1","ng-zorro-antd":"^17.2.0","ngx-timeago":"^3.0.0","node-rsa":"^1.1.1","overshom-wayforpay":"^1.1.0","passport":"^0.6.0","passport-jwt":"^4.0.1","passport-local":"^1.0.0","paystack-node":"^0.3.0","paytm-pg-node-sdk":"^1.0.4","paytmchecksum":"^1.5.1","plivo":"^4.60.1","razorpay":"^2.9.1","reflect-metadata":"^0.1.13","rxjs":"^7.8.1","sberbank-acquiring":"^1.2.1","stripe":"^12.14.0","tslib":"^2.6.1","twilio":"^4.17.0","typeorm":"0.3.17","zone.js":"0.14.3"},"devDependencies":{"@angular-devkit/build-angular":"17.0.10","@angular-devkit/core":"17.0.10","@angular-devkit/schematics":"17.0.10","@angular-eslint/eslint-plugin":"17.0.1","@angular-eslint/eslint-plugin-template":"17.0.1","@angular-eslint/template-parser":"17.0.1","@angular/cli":"~17.0.0","@angular/compiler-cli":"17.0.9","@angular/language-service":"17.0.9","@bartholomej/ngx-translate-extract":"^8.0.2","@graphql-codegen/cli":"^5.0.0","@graphql-codegen/introspection":"^4.0.0","@graphql-codegen/typescript":"^4.0.1","@graphql-codegen/typescript-apollo-angular":"^4.0.0","@graphql-codegen/typescript-operations":"^4.0.1","@nestjs/schematics":"10.1.0","@nestjs/testing":"10.3.1","@ngx-translate/core":"^15.0.0","@ngx-translate/http-loader":"^8.0.0","@nx/eslint":"17.2.8","@nx/eslint-plugin":"17.2.8","@nx/jest":"17.2.8","@nx/js":"17.2.8","@nx/nest":"17.2.8","@nx/node":"17.2.8","@nx/workspace":"17.2.8","@nxrocks/common":"^3.1.0","@nxrocks/nx-flutter":"^8.1.0","@parcel/watcher":"^2.3.0","@schematics/angular":"17.0.10","@semantic-release/changelog":"^6.0.3","@semantic-release/commit-analyzer":"^10.0.1","@semantic-release/git":"^10.0.1","@semantic-release/gitlab":"^12.0.3","@semantic-release/npm":"^10.0.4","@semantic-release/release-notes-generator":"^11.0.4","@tailwindcss/forms":"^0.5.4","@tailwindcss/typography":"^0.5.9","@types/busboy":"^1.5.0","@types/cron":"^2.0.1","@types/estree":"1.0.1","@types/ioredis":"^5.0.0","@types/jest":"29.5.3","@types/node":"^20.11.10","@types/paypal__checkout-server-sdk":"^1.0.5","@typescript-eslint/eslint-plugin":"^6.21.0","@typescript-eslint/parser":"^6.21.0","conventional-changelog-conventionalcommits":"^6.1.0","eslint":"^8.56.0","eslint-config-prettier":"9.1.0","jest":"29.6.1","jest-environment-jsdom":"29.6.1","jest-preset-angular":"13.1.6","json-autotranslate":"^1.11.0","ng-packagr":"17.0.3","nx":"17.2.8","postcss":"^8.4.27","postcss-import":"15.1.0","postcss-preset-env":"9.1.0","postcss-url":"10.1.3","prettier":"3.0.0","semantic-release":"^21.0.7","semantic-release-npm-github-publish":"^1.5.4","semantic-release-plus":"^20.0.0","tailwindcss":"^3.3.3","ts-jest":"29.1.1","ts-node":"10.9.1","typescript":"^5.2.2"},"overrides":{"@googlemaps/url-signature":"1.0.32"},"repository":{"type":"git","url":"https://github.com/ridyio/ridy-monorepo.git"},"publishConfig":{"access":"restricted"}}')},(e,t,a)=>{var o,r,n,i,d,y,s,p,c,u,_,l,m,v,f,g,b,S,P,O,M,E,C,h,T;Object.defineProperty(t,"__esModule",{value:!0}),t.AppService=void 0;const w=a(4),R=a(1),j=a(9),I=a(11),A=a(13),F=a(14),D=a(15),N=a(20),k=a(21),q=a(26),G=a(28),x=a(31),$=a(32),U=a(33),B=a(35),L=a(37),W=a(39),V=a(42),K=a(43),H=a(44),z=a(46),J=a(48),Y=a(50),Z=a(52),Q=a(29),X=a(22),ee=a(30),te=a(17),ae=a(16),oe=a(24),re=a(53),ne=a(54),ie=a(56);let de=class AppService{constructor(e,t,a,o,r,n,i,d,y,s,p,c,u,_,l,m,v,f,g,b,S,P,O,M,E){this.gatewayRepository=e,this.savedPaymentMethodRepo=t,this.gatewayToUserRepo=a,this.payoutMethodRepo=o,this.amazonPaymentServices=r,this.paymentService=n,this.payPalService=i,this.flutterwaveService=d,this.payStackService=y,this.mipsService=s,this.mytMoneyService=p,this.stripService=c,this.razorPayService=u,this.payUMoneyService=_,this.payTMService=l,this.myFatoorahService=m,this.sberBankService=v,this.mercadopagoService=f,this.wayForPayService=g,this.instamojoService=b,this.binancePayService=S,this.openPixService=P,this.paytrService=O,this.httpService=M,this.cryptoService=E}async createPaymentLink(e){const t=await this.gatewayRepository.findOneByOrFail({id:e.paymentGatewayId});let a;switch(t.type){case j.PaymentGatewayType.AmazonPaymentServices:a=await this.amazonPaymentServices.getPaymentLink({gateway:t,...e});break;case j.PaymentGatewayType.PayPal:a=await this.payPalService.getPaymentLink(t.merchantId,t.privateKey,e.currency,e.amount);break;case j.PaymentGatewayType.Paystack:a=await this.payStackService.getPaymentLink(t.privateKey,e.userType,e.userId,e.currency,e.amount);break;case j.PaymentGatewayType.Stripe:a=await this.stripService.createPaymentLink({shouldPreauth:"1"==e.shouldPreauth,gatewayId:t.id,userType:e.userType,userId:e.userId,privateKey:t.privateKey,currency:e.currency,amount:e.amount});break;case j.PaymentGatewayType.Instamojo:a=await this.instamojoService.getPaymentLink({gateway:t,...e});break;case j.PaymentGatewayType.Flutterwave:a=await this.flutterwaveService.getPaymentLink({gateway:t,...e});break;case j.PaymentGatewayType.MIPS:a=await this.mipsService.getPaymentLink({gateway:t,...e});break;case j.PaymentGatewayType.MyTMoney:a=await this.mytMoneyService.getPaymentLink({gateway:t,...e});break;case j.PaymentGatewayType.Razorpay:a=await this.razorPayService.getPaymentLink({gateway:t,...e});break;case j.PaymentGatewayType.PayU:a=await this.payUMoneyService.getPaymentLink({gateway:t,...e});break;case j.PaymentGatewayType.Paytm:a=await this.payTMService.getPaymentLink({gateway:t,...e});break;case j.PaymentGatewayType.WayForPay:a=await this.wayForPayService.getPaymentLink({gateway:t,...e});break;case j.PaymentGatewayType.MercadoPago:a=await this.mercadopagoService.getPaymentLink({gateway:t,...e});break;case j.PaymentGatewayType.MyFatoorah:a=await this.myFatoorahService.getPaymentLink({gateway:t,...e});break;case j.PaymentGatewayType.SberBank:a=await this.sberBankService.getPaymentLink({gateway:t,...e});break;case j.PaymentGatewayType.BinancePay:a=await this.binancePayService.getPaymentLink({gateway:t,...e});break;case j.PaymentGatewayType.OpenPix:a=await this.openPixService.getPaymentLink({gateway:t,...e});break;case j.PaymentGatewayType.PayTR:a=await this.paytrService.getPaymentLink({gateway:t,...e});break;case j.PaymentGatewayType.CustomLink:a={invoiceId:`${e.userType}_${e.userId}_${(new Date).getTime()}`,url:t.publicKey??t.privateKey}}return await this.paymentService.createRecord({transactionNumber:a.invoiceId,paymentInterface:e,orderNumber:e.orderNumber??void 0,externalReferenceNumber:a.externalReferenceNumber}),{status:"success",url:a.url}}async capturePayment(e){let t=await this.paymentService.getOne(e.id);const a=await this.gatewayRepository.findOneByOrFail({id:t.gatewayId});let o;if(a.type!==j.PaymentGatewayType.Stripe)throw new Error("Pre-authentication is not supported for this gateway");if(o=await this.stripService.capturePayment({gateway:a,transactionNumber:t.externalReferenceNumber,amount:e.amount}),!o)return{status:"failed"};t=await this.paymentService.markAsCaptured(t.id,e.amount);const r=await this.paymentService.getEncryptedWithPayment(t);return"success"==o.status&&await(0,ee.firstValueFrom)(this.httpService.get(`${t.returnUrl}?token=${r}&redirect=0`)),o}async cancelCapture(e){let t=await this.paymentService.getOne(e.id);const a=await this.gatewayRepository.findOneByOrFail({id:t.gatewayId});let o;if(a.type!==j.PaymentGatewayType.Stripe)throw new Error("Pre-authentication is not supported for this gateway");return o=await this.stripService.cancelPreauth({gateway:a,transactionNumber:t.externalReferenceNumber}),t=await this.paymentService.markAsCanceled(t.id),o}async chargeSavedPaymentMethod(e){let t,a=await this.savedPaymentMethodRepo.findOneOrFail({where:{id:parseInt(e.savedPaymentMethodId)},relations:{paymentGateway:!0}}),o=a.paymentGateway,r=await this.gatewayToUserRepo.findOneOrFail({where:{gatewayId:o.id,internalUserId:`${e.userType}_${e.userId}`}});if(o?.type!==j.PaymentGatewayType.Stripe)throw new R.HttpException("Unsupported payment gateway",400);t=await this.stripService.chargeSavedPaymentMethod({gatewayPrivateKey:o.privateKey,customerId:r.externalReferenceNumber,token:a.token,currency:e.currency,amount:e.amount});const n=this.paymentService.paymentRepository.create({transactionNumber:t.transactionNumber,gatewayId:o.id,returnUrl:e.returnUrl,amount:e.amount,currency:e.currency,userType:e.userType,userId:e.userId.toString(),status:"success"==t.status?oe.PaymentStatus.Success:oe.PaymentStatus.Processing});if(await this.paymentService.paymentRepository.save(n),"success"==t.status){const e=await this.paymentService.getEncryptedWithPayment(n);await(0,ee.firstValueFrom)(this.httpService.post(n.returnUrl,{token:e}))}return t}async setupSavedPaymentMethod(e){const t=JSON.parse(await this.cryptoService.decrypt(e));R.Logger.log(JSON.stringify(t),"setupSavedPaymentMethod");let a,o=await this.gatewayRepository.findOneOrFail({where:{id:parseInt(t.gatewayId)}});if(o.type!==j.PaymentGatewayType.Stripe)throw new R.HttpException("Unsupported payment gateway",400);return a=await this.stripService.setupSavedMethod({paymentGatewayId:o.id.toString(),paymentGatewayPrivateKey:o.privateKey,userType:t.userType,userId:t.userId,currency:t.currency}),await this.paymentService.createRecord({transactionNumber:a.invoiceId,paymentInterface:{userType:t.userType,userId:t.userId,currency:t.currency,amount:"0",paymentGatewayId:o.id,shouldPreauth:"0",returnUrl:t.returnUrl,orderNumber:null},orderNumber:void 0,externalReferenceNumber:a.externalReferenceNumber}),R.Logger.log(JSON.stringify(a),"AppService.setupSavedPaymentMethod"),{status:"success",url:a.url}}async getPayoutLinkUrl(e){const t=await this.payoutMethodRepo.findOneOrFail({where:{id:e.payoutMethodId}});let a;if(t.type!==ne.PayoutMethodType.Stripe)throw new R.HttpException("Unsupported payout method",400);return a=await this.stripService.getPayoutLinkUrl({method:t,userType:"driver",userId:e.driverId,returnUrl:e.returnUrl}),{status:"success",url:a}}};t.AppService=de,t.AppService=de=w.__decorate([(0,R.Injectable)(),w.__param(0,(0,A.InjectRepository)(F.PaymentGatewayEntity)),w.__param(1,(0,A.InjectRepository)(te.SavedPaymentMethodEntity)),w.__param(2,(0,A.InjectRepository)(ae.GatewayToUserEntity)),w.__param(3,(0,A.InjectRepository)(re.PayoutMethodEntity)),w.__metadata("design:paramtypes",["function"==typeof(o=void 0!==D.Repository&&D.Repository)?o:Object,"function"==typeof(r=void 0!==D.Repository&&D.Repository)?r:Object,"function"==typeof(n=void 0!==D.Repository&&D.Repository)?n:Object,"function"==typeof(i=void 0!==D.Repository&&D.Repository)?i:Object,"function"==typeof(d=void 0!==N.AmazonPaymentServicesService&&N.AmazonPaymentServicesService)?d:Object,"function"==typeof(y=void 0!==k.PaymentService&&k.PaymentService)?y:Object,"function"==typeof(s=void 0!==I.PaypalService&&I.PaypalService)?s:Object,"function"==typeof(p=void 0!==G.FlutterwaveService&&G.FlutterwaveService)?p:Object,"function"==typeof(c=void 0!==q.PaystackService&&q.PaystackService)?c:Object,"function"==typeof(u=void 0!==x.MIPSService&&x.MIPSService)?u:Object,"function"==typeof(_=void 0!==$.MyTMoneyService&&$.MyTMoneyService)?_:Object,"function"==typeof(l=void 0!==U.StripeService&&U.StripeService)?l:Object,"function"==typeof(m=void 0!==B.RazorPayService&&B.RazorPayService)?m:Object,"function"==typeof(v=void 0!==L.PayUMoneyService&&L.PayUMoneyService)?v:Object,"function"==typeof(f=void 0!==W.PayTMService&&W.PayTMService)?f:Object,"function"==typeof(g=void 0!==V.MyFatoorahService&&V.MyFatoorahService)?g:Object,"function"==typeof(b=void 0!==K.SberBankService&&K.SberBankService)?b:Object,"function"==typeof(S=void 0!==H.MercadopagoService&&H.MercadopagoService)?S:Object,"function"==typeof(P=void 0!==z.WayForPayService&&z.WayForPayService)?P:Object,"function"==typeof(O=void 0!==J.InstaMojoService&&J.InstaMojoService)?O:Object,"function"==typeof(M=void 0!==Y.BinancePayService&&Y.BinancePayService)?M:Object,"function"==typeof(E=void 0!==Z.OpenPixService&&Z.OpenPixService)?E:Object,"function"==typeof(C=void 0!==ie.PayTRService&&ie.PayTRService)?C:Object,"function"==typeof(h=void 0!==Q.HttpService&&Q.HttpService)?h:Object,"function"==typeof(T=void 0!==X.CryptoService&&X.CryptoService)?T:Object])],de)},(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.PaymentGatewayType=void 0;const o=a(10);var r;!function(e){e.Stripe="stripe",e.BrainTree="braintree",e.PayPal="paypal",e.Paytm="paytm",e.Razorpay="razorpay",e.Paystack="paystack",e.PayU="payu",e.Instamojo="instamojo",e.Flutterwave="flutterwave",e.PayGate="paygate",e.MIPS="mips",e.MercadoPago="mercadopago",e.AmazonPaymentServices="amazon",e.MyTMoney="mytmoney",e.WayForPay="wayforpay",e.MyFatoorah="MyFatoorah",e.SberBank="SberBank",e.BinancePay="BinancePay",e.OpenPix="OpenPix",e.PayTR="PayTR",e.CustomLink="link"}(r||(t.PaymentGatewayType=r={})),(0,o.registerEnumType)(r,{name:"PaymentGatewayType"})},e=>{e.exports=require("@nestjs/graphql")},(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.PaypalService=void 0;const o=a(4),r=a(1),n=o.__importStar(a(12));let i=class PaypalService{async getPaymentLink(e,t,a,o){r.Logger.log("getting payment link in "+(null!=process.env.DEMO_MODE?"DEMO MODE":"PRODUCTION MODE")),r.Logger.log(`merchantId: ${e}, privateKey: ${t}`);const i=null!=process.env.DEMO_MODE?new n.core.SandboxEnvironment(e,t):new n.core.LiveEnvironment(e,t),d=new n.core.PayPalHttpClient(i),y=new n.orders.OrdersCreateRequest;y.requestBody({intent:"CAPTURE",application_context:{return_url:`${process.env.GATEWAY_SERVER_URL}/paypal/verify`,cancel_url:`${process.env.GATEWAY_SERVER_URL}/paypal/cancel`,shipping_preference:"NO_SHIPPING"},purchase_units:[{amount:{currency_code:a,value:o}}]});const s=await d.execute(y);if(console.log(`PayPal Result: ${JSON.stringify(s)}`),null==s.result?.id)throw new Error(JSON.stringify(s));const p=s.result;return{invoiceId:p.id,url:p.links.filter((e=>"approve"==e.rel))[0].href}}async verify(e,t){const a=null!=process.env.DEMO_MODE?new n.core.SandboxEnvironment(e.merchantId,e.privateKey):new n.core.LiveEnvironment(e.merchantId,e.privateKey),o=new n.core.PayPalHttpClient(a),r=new n.orders.OrdersCaptureRequest(t);await o.execute(r);return!0}};t.PaypalService=i,t.PaypalService=i=o.__decorate([(0,r.Injectable)()],i)},e=>{e.exports=require("@paypal/checkout-server-sdk")},e=>{e.exports=require("@nestjs/typeorm")},(e,t,a)=>{var o;Object.defineProperty(t,"__esModule",{value:!0}),t.PaymentGatewayEntity=void 0;const r=a(4),n=a(9),i=a(15),d=a(16),y=a(17);let s=class PaymentGatewayEntity{};t.PaymentGatewayEntity=s,r.__decorate([(0,i.PrimaryGeneratedColumn)(),r.__metadata("design:type",Number)],s.prototype,"id",void 0),r.__decorate([(0,i.Column)(),r.__metadata("design:type",String)],s.prototype,"title",void 0),r.__decorate([(0,i.Column)("enum",{enum:n.PaymentGatewayType}),r.__metadata("design:type","function"==typeof(o=void 0!==n.PaymentGatewayType&&n.PaymentGatewayType)?o:Object)],s.prototype,"type",void 0),r.__decorate([(0,i.Column)({nullable:!0}),r.__metadata("design:type",String)],s.prototype,"publicKey",void 0),r.__decorate([(0,i.Column)(),r.__metadata("design:type",String)],s.prototype,"privateKey",void 0),r.__decorate([(0,i.Column)({nullable:!0}),r.__metadata("design:type",String)],s.prototype,"merchantId",void 0),r.__decorate([(0,i.Column)({nullable:!0}),r.__metadata("design:type",String)],s.prototype,"saltKey",void 0),r.__decorate([(0,i.OneToMany)((()=>d.GatewayToUserEntity),(e=>e.gateway)),r.__metadata("design:type",Array)],s.prototype,"userIds",void 0),r.__decorate([(0,i.OneToMany)((()=>y.SavedPaymentMethodEntity),(e=>e.paymentGateway)),r.__metadata("design:type",Array)],s.prototype,"savedPaymentMethods",void 0),t.PaymentGatewayEntity=s=r.__decorate([(0,i.Entity)("payment_gateway")],s)},e=>{e.exports=require("typeorm")},(e,t,a)=>{var o;Object.defineProperty(t,"__esModule",{value:!0}),t.GatewayToUserEntity=void 0;const r=a(4),n=a(15),i=a(14);let d=class GatewayToUserEntity{};t.GatewayToUserEntity=d,r.__decorate([(0,n.PrimaryGeneratedColumn)(),r.__metadata("design:type",Number)],d.prototype,"id",void 0),r.__decorate([(0,n.ManyToOne)((()=>i.PaymentGatewayEntity),(e=>e.userIds)),r.__metadata("design:type","function"==typeof(o=void 0!==i.PaymentGatewayEntity&&i.PaymentGatewayEntity)?o:Object)],d.prototype,"gateway",void 0),r.__decorate([(0,n.Column)(),r.__metadata("design:type",Number)],d.prototype,"gatewayId",void 0),r.__decorate([(0,n.Index)(),(0,n.Column)(),r.__metadata("design:type",String)],d.prototype,"internalUserId",void 0),r.__decorate([(0,n.Column)(),r.__metadata("design:type",String)],d.prototype,"externalReferenceNumber",void 0),t.GatewayToUserEntity=d=r.__decorate([(0,n.Entity)("gateway_to_user")],d)},(e,t,a)=>{var o,r,n,i;Object.defineProperty(t,"__esModule",{value:!0}),t.SavedPaymentMethodEntity=void 0;const d=a(4),y=a(15),s=a(14),p=a(18),c=a(19);let u=class SavedPaymentMethodEntity{};t.SavedPaymentMethodEntity=u,d.__decorate([(0,y.PrimaryGeneratedColumn)(),d.__metadata("design:type",Number)],u.prototype,"id",void 0),d.__decorate([(0,y.Column)(),d.__metadata("design:type",String)],u.prototype,"title",void 0),d.__decorate([(0,y.Column)({default:!1}),d.__metadata("design:type",Boolean)],u.prototype,"isDefault",void 0),d.__decorate([(0,y.Column)("enum",{enum:p.SavedPaymentMethodType}),d.__metadata("design:type","function"==typeof(o=void 0!==p.SavedPaymentMethodType&&p.SavedPaymentMethodType)?o:Object)],u.prototype,"type",void 0),d.__decorate([(0,y.Column)("enum",{enum:c.ProviderBrand,nullable:!0}),d.__metadata("design:type","function"==typeof(r=void 0!==c.ProviderBrand&&c.ProviderBrand)?r:Object)],u.prototype,"providerBrand",void 0),d.__decorate([(0,y.Column)({nullable:!0}),d.__metadata("design:type","function"==typeof(n="undefined"!=typeof Date&&Date)?n:Object)],u.prototype,"expiryDate",void 0),d.__decorate([(0,y.Column)({nullable:!0}),d.__metadata("design:type",String)],u.prototype,"holderName",void 0),d.__decorate([(0,y.Column)({nullable:!0}),d.__metadata("design:type",Number)],u.prototype,"riderId",void 0),d.__decorate([(0,y.Column)({nullable:!0}),d.__metadata("design:type",Number)],u.prototype,"driverId",void 0),d.__decorate([(0,y.Column)(),d.__metadata("design:type",String)],u.prototype,"token",void 0),d.__decorate([(0,y.ManyToOne)((()=>s.PaymentGatewayEntity),(e=>e.savedPaymentMethods)),d.__metadata("design:type","function"==typeof(i=void 0!==s.PaymentGatewayEntity&&s.PaymentGatewayEntity)?i:Object)],u.prototype,"paymentGateway",void 0),d.__decorate([(0,y.Column)(),d.__metadata("design:type",Number)],u.prototype,"paymentGatewayId",void 0),t.SavedPaymentMethodEntity=u=d.__decorate([(0,y.Entity)("saved_payment_method")],u)},(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.SavedPaymentMethodType=void 0;const o=a(10);var r;!function(e){e.CARD="CARD",e.BANK_ACCOUNT="BANK_ACCOUNT"}(r||(t.SavedPaymentMethodType=r={})),(0,o.registerEnumType)(r,{name:"SavedPaymentMethodType",description:"Saved payment method type"})},(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ProviderBrand=void 0;const o=a(10);var r;!function(e){e.Visa="visa",e.Mastercard="mastercard",e.Amex="amex",e.Discover="discover",e.Diners="diners",e.EftPosAu="eftpos_au",e.JCB="jcb",e.UnionPay="unionpay",e.Unknown="unknown"}(r||(t.ProviderBrand=r={})),(0,o.registerEnumType)(r,{name:"ProviderBrand",description:"Brand of the provider wether bank name or card provider"})},(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.PayFortDTO=t.AmazonPaymentServicesService=void 0;const o=a(4),r=a(1);let n=class AmazonPaymentServicesService{async getPaymentLink(e){const t=`${e.userType}_${e.userId}_${(new Date).getTime()}`,a={transactionId:t,gatewayId:e.gateway.id,userType:e.userType,userId:e.userId,amount:parseFloat(e.amount),currency:e.currency},o=Buffer.from(JSON.stringify(a),"utf8").toString("base64");return{invoiceId:t,url:`${process.env.GATEWAY_SERVER_URL}amazon/redirect?token=${o}`}}async verify(e,t){return!0}};t.AmazonPaymentServicesService=n,t.AmazonPaymentServicesService=n=o.__decorate([(0,r.Injectable)()],n);t.PayFortDTO=class PayFortDTO{}},(e,t,a)=>{var o,r;Object.defineProperty(t,"__esModule",{value:!0}),t.PaymentService=void 0;const n=a(4),i=a(1),d=a(13),y=a(15),s=a(22),p=a(24);let c=class PaymentService{constructor(e,t){this.paymentRepository=e,this.cryptoService=t}async createRecord(e){await this.paymentRepository.insert({amount:parseFloat(e.paymentInterface.amount),currency:e.paymentInterface.currency,transactionNumber:e.transactionNumber,externalReferenceNumber:e.externalReferenceNumber,userId:e.paymentInterface.userId,userType:e.paymentInterface.userType,gatewayId:e.paymentInterface.paymentGatewayId,orderNumber:e.orderNumber,returnUrl:e.paymentInterface.returnUrl.replace('"',"")})}async getOne(e){return this.paymentRepository.findOneOrFail({where:{transactionNumber:e}})}async markAsCaptured(e,t){return await this.paymentRepository.update(e,{status:p.PaymentStatus.Success,amount:t}),this.paymentRepository.findOneByOrFail({id:e})}async markAsCanceled(e){return await this.paymentRepository.update(e,{status:p.PaymentStatus.Canceled}),this.paymentRepository.findOneByOrFail({id:e})}async getEncryptedWithPayment(e){const t={status:e.status,userType:e.userType,userId:parseInt(e.userId),timestamp:(new Date).getTime(),gatewayId:e.gatewayId,transactionNumber:e.transactionNumber,amount:e.amount,currency:e.currency},a=JSON.stringify(t);return this.cryptoService.encrypt(a)}async updatePaymentStatus(e,t){return await this.paymentRepository.update(e,{status:t}),this.paymentRepository.findOneByOrFail({id:e})}};t.PaymentService=c,t.PaymentService=c=n.__decorate([(0,i.Injectable)(),n.__param(0,(0,d.InjectRepository)(p.PaymentEntity)),n.__metadata("design:paramtypes",["function"==typeof(o=void 0!==y.Repository&&y.Repository)?o:Object,"function"==typeof(r=void 0!==s.CryptoService&&s.CryptoService)?r:Object])],c)},(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CryptoService=void 0;const o=a(4),r=a(1),n=a(23);let i=class CryptoService{constructor(){this.ENCRYPTION_KEY=process.env.ENCRYPTION_KEY,this.IV_LENGTH=16}async encrypt(e){const t=(0,n.randomBytes)(this.IV_LENGTH),a=(0,n.createCipheriv)("aes-256-cbc",Buffer.from(this.ENCRYPTION_KEY),t);let o=a.update(e);return o=Buffer.concat([o,a.final()]),t.toString("hex")+":"+o.toString("hex")}async decrypt(e){const t=e.split(":"),a=Buffer.from(t.shift(),"hex"),o=Buffer.from(t.join(":"),"hex"),r=(0,n.createDecipheriv)("aes-256-cbc",Buffer.from(this.ENCRYPTION_KEY),a);let i=r.update(o);return i=Buffer.concat([i,r.final()]),i.toString()}};t.CryptoService=i,t.CryptoService=i=o.__decorate([(0,r.Injectable)()],i)},e=>{e.exports=require("crypto")},(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.PaymentEntity=t.PaymentStatus=void 0;const o=a(4),r=a(15),n=a(25);var i;!function(e){e.Processing="processing",e.Success="success",e.Canceled="canceled",e.Authorized="authorized",e.Failed="failed"}(i||(t.PaymentStatus=i={}));let d=class PaymentEntity{};t.PaymentEntity=d,o.__decorate([(0,r.PrimaryGeneratedColumn)(),o.__metadata("design:type",Number)],d.prototype,"id",void 0),o.__decorate([(0,r.Column)("enum",{enum:i,default:i.Processing}),o.__metadata("design:type",String)],d.prototype,"status",void 0),o.__decorate([(0,r.Column)("float",{default:"0.00",precision:10,scale:2}),o.__metadata("design:type",Number)],d.prototype,"amount",void 0),o.__decorate([(0,r.Column)(),o.__metadata("design:type",String)],d.prototype,"currency",void 0),o.__decorate([(0,r.Column)(),o.__metadata("design:type",String)],d.prototype,"transactionNumber",void 0),o.__decorate([(0,r.Column)(),o.__metadata("design:type",String)],d.prototype,"userType",void 0),o.__decorate([(0,r.Column)(),o.__metadata("design:type",String)],d.prototype,"userId",void 0),o.__decorate([(0,r.Column)("int"),o.__metadata("design:type",Number)],d.prototype,"gatewayId",void 0),o.__decorate([(0,r.Column)(),o.__metadata("design:type",String)],d.prototype,"returnUrl",void 0),o.__decorate([(0,r.Column)("text",{nullable:!0}),o.__metadata("design:type",String)],d.prototype,"externalReferenceNumber",void 0),o.__decorate([(0,r.Column)({nullable:!0}),o.__metadata("design:type",String)],d.prototype,"orderNumber",void 0),t.PaymentEntity=d=o.__decorate([(0,n.Entity)("payment")],d)},e=>{e.exports=require("typeorm/decorator/entity/Entity")},(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.PaystackService=void 0;const o=a(4),r=a(1),n=a(27);let i=class PaystackService{async getPaymentLink(e,t,a,o,r){const i=`${t}_${a}_${(new Date).getTime()}`,d=`${a}@${t}.id`,y=new n(e,"prod");return{invoiceId:i,url:(await y.initializeTransaction({amount:100*Math.round(parseFloat(r)),currency:o,callback_url:`${process.env.GATEWAY_SERVER_URL}/paystack/callback`,email:d,reference:i})).body.data.authorization_url}}async verify(e,t){const a=new n(e.privateKey,"prod");return(await a.verifyTransaction({reference:t})).body}};t.PaystackService=i,t.PaystackService=i=o.__decorate([(0,r.Injectable)()],i)},e=>{e.exports=require("paystack-node")},(e,t,a)=>{var o;Object.defineProperty(t,"__esModule",{value:!0}),t.FlutterwaveService=void 0;const r=a(4),n=a(1),i=a(29),d=a(30);let y=class FlutterwaveService{constructor(e){this.httpService=e}async getPaymentLink(e){const t=`${e.userType}_${e.userId}_${(new Date).getTime()}`,a=`${e.userId}@${e.userType}.id`,o={tx_ref:t,amount:e.amount,currency:e.currency,payment_options:"card",redirect_url:`${process.env.GATEWAY_SERVER_URL}/flutterwave/callback`,customer:{email:a},customizations:{title:"Wallet Top-up",description:"Charging your in-app wallet"}};try{return{invoiceId:t,url:(await(0,d.firstValueFrom)(this.httpService.post("https://api.flutterwave.com/v3/payments",o,{headers:{Authorization:`Bearer ${e.gateway.privateKey}`}}))).data.data.link}}catch(r){throw console.log(r),r}}};t.FlutterwaveService=y,t.FlutterwaveService=y=r.__decorate([(0,n.Injectable)(),r.__metadata("design:paramtypes",["function"==typeof(o=void 0!==i.HttpService&&i.HttpService)?o:Object])],y)},e=>{e.exports=require("@nestjs/axios")},e=>{e.exports=require("rxjs")},(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.MIPSService=void 0;const o=a(4),r=a(1),n=o.__importStar(a(23));let i=class MIPSService{constructor(){}async getPaymentLink(e){const t=`${e.userType}_${e.userId}_${(new Date).getTime()}`,a=e.gateway.merchantId,o=e.gateway.publicKey,i=e.gateway.saltKey,d=e.gateway.privateKey,y=`${o}${t}${100*parseInt(e.amount)}${e.currency}${i}`,s=n.createHash("sha256").update(y).digest("hex"),p={id_form:o,id_order:t,amount:100*parseInt(e.amount),currency:e.currency,checksum:s},c=n.createCipheriv("AES-128-ECB",d.substring(0,16),Buffer.alloc(0));let u=c.update(JSON.stringify(p),"utf8","base64");u+=c.final("base64");const _=Buffer.from(u,"utf8").toString("base64");return r.Logger.log(`calling mips with base64: ${_}`),{url:`https://go.mips.mu/mipsit.php?c=${_}&smid=${a}`,invoiceId:t}}async getMipsDecrypted(e,t){const a=e.saltKey,o=e.privateKey,r=Buffer.from(t,"base64").toString(),i=n.createDecipheriv("aes-128-ecb",o.substring(0,16),Buffer.alloc(0)),d=i.update(r,"base64","utf8"),y=JSON.parse(d+i.final("utf8")),s=n.createHash("sha256").update(`${y.amount}${y.currency}${y.status}${a}`).digest("hex");if(y.checksum==s){if("success"==y.status.toLowerCase())return y;throw new Error(y.status)}throw new Error("Invalid Request")}};t.MIPSService=i,t.MIPSService=i=o.__decorate([(0,r.Injectable)(),o.__metadata("design:paramtypes",[])],i)},(e,t,a)=>{var o;Object.defineProperty(t,"__esModule",{value:!0}),t.MyTMoneyService=void 0;const r=a(4),n=a(1),i=a(29);let d=class MyTMoneyService{constructor(e){this.httpService=e}async getPaymentLink(e){const t=`${e.userType}_${e.userId}_${(new Date).getTime()}`,a={gatewayId:e.gateway.id,userType:e.userType,userId:parseInt(e.userId),amount:parseFloat(e.amount),transactionId:t,currency:e.currency},o=Buffer.from(JSON.stringify(a),"utf8").toString("base64");return{url:`${process.env.GATEWAY_SERVER_URL}/mytmoney/redirect?token=${o}`,invoiceId:t}}};t.MyTMoneyService=d,t.MyTMoneyService=d=r.__decorate([(0,n.Injectable)(),r.__metadata("design:paramtypes",["function"==typeof(o=void 0!==i.HttpService&&i.HttpService)?o:Object])],d)},(e,t,a)=>{var o;Object.defineProperty(t,"__esModule",{value:!0}),t.StripeService=void 0;const r=a(4),n=a(1),i=a(13),d=a(34),y=a(15),s=a(16);let p=class StripeService{constructor(e){this.gatewayToUserRepo=e}async createPaymentLink(e){const t=`${`${e.userType}_${e.userId}`}_${(new Date).getTime()}`,a=new d.Stripe(e.privateKey,{apiVersion:"2022-11-15"});let o=await this.getCustomerId({paymentGatewayId:e.gatewayId.toString(),paymentGatewayPrivateKey:e.privateKey,userId:e.userId,userType:e.userType});const r=await a.checkout.sessions.create({customer:o,line_items:[{price_data:{currency:e.currency,product_data:{name:"Add funds"},unit_amount:Math.ceil(100*parseFloat(e.amount))},quantity:1}],mode:"payment",success_url:`${process.env.GATEWAY_SERVER_URL}/stripe/success?transactionId=${t}`,cancel_url:`${process.env.GATEWAY_SERVER_URL}/stripe/cancel?transactionId=${t}`,payment_intent_data:{setup_future_usage:"off_session",capture_method:e.shouldPreauth?"manual":"automatic"}});return{invoiceId:t,url:r.url,externalReferenceNumber:r.id}}async getCustomerId(e){const t=`${e.userType}_${e.userId}`,a=await this.gatewayToUserRepo.findOneBy({internalUserId:t});if(null==a){const a=await this.createCustomer({apiKey:e.paymentGatewayPrivateKey,userType:e.userType,userId:e.userId});return await this.gatewayToUserRepo.insert({internalUserId:t,externalReferenceNumber:a.id,gatewayId:parseInt(e.paymentGatewayId)}),a.id}return a.externalReferenceNumber}async setupSavedMethod(e){const t=new d.Stripe(e.paymentGatewayPrivateKey,{apiVersion:"2022-11-15"});let a=await this.getCustomerId({...e});const o=`${`${e.userType}_${e.userId}`}_${(new Date).getTime()}`,r=await t.checkout.sessions.create({customer:a,mode:"setup",currency:e.currency,metadata:{userId:e.userId,userType:e.userType,gatewayId:e.paymentGatewayId},success_url:`${process.env.GATEWAY_SERVER_URL}/stripe/success_attach?session_id={CHECKOUT_SESSION_ID}`,cancel_url:`${process.env.GATEWAY_SERVER_URL}/stripe/cancel_attach?session_id={CHECKOUT_SESSION_ID}`});return n.Logger.log(r,"setupSavedMethod"),{url:r.url,invoiceId:o,externalReferenceNumber:r.id}}async chargeSavedPaymentMethod(e){const t=new d.Stripe(e.gatewayPrivateKey,{apiVersion:"2022-11-15"}),a=await t.paymentIntents.create({payment_method:e.token,customer:e.customerId,currency:e.currency,amount:Math.ceil(100*e.amount),confirm:!0});if("requires_action"==a.status)return{status:"redirect",transactionNumber:a.id,url:a.next_action.redirect_to_url.url};if("succeeded"==a.status)return{transactionNumber:a.id,status:"success"};throw new Error("Unknown payment intent status")}async getSession(e,t){const a=new d.Stripe(e.privateKey,{apiVersion:"2022-11-15"});return await a.checkout.sessions.retrieve(t)}async getSetupIntentPaymentMethodDetails(e,t){const a=new d.Stripe(e.privateKey,{apiVersion:"2022-11-15"});return(await a.setupIntents.retrieve(t,{expand:["payment_method"]})).payment_method}async createCustomer(e){const t=new d.Stripe(e.apiKey,{apiVersion:"2022-11-15"});return await t.customers.create({name:`${e.userType}_${e.userId}`})}async capturePayment(e){const t=new d.Stripe(e.gateway.privateKey,{apiVersion:"2022-11-15"}),a=await t.checkout.sessions.retrieve(e.transactionNumber),o=await t.paymentIntents.capture(a.payment_intent,{amount_to_capture:Math.ceil(100*e.amount)});return this.handlePaymentIntentStatus(o)}handlePaymentIntentStatus(e){if("requires_action"==e.status){if(e.next_action?.redirect_to_url)return{status:"redirect",url:e.next_action.redirect_to_url.url};throw new Error("Unknown next action")}if("succeeded"==e.status)return{status:"success"};throw new Error("Unknown payment intent status")}async cancelPreauth(e){const t=new d.Stripe(e.gateway.privateKey,{apiVersion:"2022-11-15"}),a=await t.checkout.sessions.retrieve(e.transactionNumber),o=await t.paymentIntents.cancel(a.payment_intent);return this.handlePaymentIntentStatus(o)}async getPayoutLinkUrl(e){const t=new d.Stripe(e.method.privateKey,{apiVersion:"2022-11-15"});let a;try{a=await t.accounts.retrieve(e.userId.toString())}catch(r){a=await t.accounts.create({type:"express",capabilities:{transfers:{requested:!0}},metadata:{userId:e.userId.toString(),userType:e.userType,return_url:e.returnUrl},business_type:"individual"})}n.Logger.log(a,"stripeService.getPayoutLinkUrl.account");const o=await t.accountLinks.create({account:a.id,refresh_url:`${process.env.GATEWAY_SERVER_URL}/stripe/payout/refresh`,return_url:`${process.env.GATEWAY_SERVER_URL}/stripe/payout/return?account_id=${a.id}&payout_method_id=${e.method.id}`,type:"account_onboarding"});return n.Logger.log(o,"stripeService.getPayoutLinkUrl.link"),o.url}async verify(e,t){const a=new d.Stripe(e.privateKey,{apiVersion:"2022-11-15"});return await a.checkout.sessions.retrieve(t)}};t.StripeService=p,t.StripeService=p=r.__decorate([(0,n.Injectable)(),r.__param(0,(0,i.InjectRepository)(s.GatewayToUserEntity)),r.__metadata("design:paramtypes",["function"==typeof(o=void 0!==y.Repository&&y.Repository)?o:Object])],p)},e=>{e.exports=require("stripe")},(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.RazorPayService=void 0;const o=a(4),r=a(1),n=a(36);let i=class RazorPayService{async getPaymentLink(e){const t=`${e.userType}_${e.userId}_${(new Date).getTime()}`;var a=new n({key_id:e.gateway.merchantId,key_secret:e.gateway.privateKey});return{invoiceId:t,url:(await a.paymentLink.create({amount:100*parseInt(e.amount),currency:e.currency,accept_partial:!1,reference_id:t,callback_url:`${process.env.GATEWAY_SERVER_URL}/razorpay/callback`,customer:{name:`${e.userType}_${e.userId}`},options:{order:{offers:[]}}})).short_url}}async verify(e,t){return!0}};t.RazorPayService=i,t.RazorPayService=i=o.__decorate([(0,r.Injectable)()],i)},e=>{e.exports=require("razorpay")},(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.PayUMoneyService=void 0;const o=a(4),r=a(38),n=a(1);let i=class PayUMoneyService{async getPaymentLink(e){const t=`${e.userType}_${e.userId}_${(new Date).getTime()}`,a=new r.PayU(parseInt(e.userId),e.gateway.privateKey,parseInt(e.gateway.merchantId),e.gateway.merchantId,{sandbox:!1});return{invoiceId:t,url:(await a.createOrder({extOrderId:t,notifyUrl:`${process.env.GATEWAY_SERVER_URL}/payumoney/callback`,customerIp:"127.0.0.1",continueUrl:`${process.env.GATEWAY_SERVER_URL}/payumoney/callback`,description:"My order",currencyCode:e.currency,totalAmount:parseFloat(e.amount),products:[{name:"Recharge account",quantity:1,unitPrice:parseFloat(e.amount)}]})).redirectUri}}async verify(e,t){return!0}};t.PayUMoneyService=i,t.PayUMoneyService=i=o.__decorate([(0,n.Injectable)()],i)},e=>{e.exports=require("@ingameltd/payu")},(e,t,a)=>{var o;Object.defineProperty(t,"__esModule",{value:!0}),t.PayTMService=void 0;const r=a(4),n=a(1),i=r.__importStar(a(40)),d=a(29),y=r.__importStar(a(41)),s=a(30);let p=class PayTMService{constructor(e){this.httpService=e}async getPaymentLink(e){const t=`${e.userType}_${e.userId}_${(new Date).getTime()}`;i.LibraryConstants.STAGING_ENVIRONMENT;var a=`${process.env.GATEWAY_SERVER_URL}/paytm/callback`;const o={merchantRequestId:t,mid:e.gateway.merchantId,linkName:"Recharge",linkDescription:"Recharge wallet",linkType:"FIXED",amount:e.amount,statusCallbackUrl:a},r=JSON.stringify(o),n=""+(null==process.env.DEMO_MODE?"https://securegw.paytm.in/link/create":"https://securegw-stage.paytm.in/link/create"),d=await y.generateSignature(r,e.gateway.privateKey);console.log(d);const p=await(0,s.firstValueFrom)(this.httpService.post(n,o,{headers:{tokenType:"AES",signature:d}}));return console.log(p.data),{invoiceId:t,url:p.data.shortUrl}}async verify(e,t){return!0}};t.PayTMService=p,t.PayTMService=p=r.__decorate([(0,n.Injectable)(),r.__metadata("design:paramtypes",["function"==typeof(o=void 0!==d.HttpService&&d.HttpService)?o:Object])],p)},e=>{e.exports=require("paytm-pg-node-sdk")},e=>{e.exports=require("paytmchecksum")},(e,t,a)=>{var o;Object.defineProperty(t,"__esModule",{value:!0}),t.MyFatoorahService=void 0;const r=a(4),n=a(1),i=a(29),d=a(30);let y=class MyFatoorahService{constructor(e){this.httpService=e}async getPaymentLink(e){const t=`${e.userType}_${e.userId}_${(new Date).getTime()}`,a=null!=process.env.DEMO_MODE?"https://apitest.myfatoorah.com/":"https://api.myfatoorah.com/",o=(e.userId,e.userType,{tx_ref:t,InvoiceAmount:e.amount,CurrencyIso:e.currency}),r=await(0,d.firstValueFrom)(this.httpService.post(`${a}v2/InitiatePayment`,o,{headers:{Authorization:`Bearer ${e.gateway.privateKey}`}})),i=r.data.Data.PaymentMethods.filter((t=>t.PaymentMethodCode==e.gateway.merchantId))[0];n.Logger.log(`MyFatoorah initialPaymentResult: ${JSON.stringify(r)}`);const y={PaymentMethodId:i.PaymentMethodId,InvoiceValue:parseInt(e.amount),DisplayCurrencyIso:e.currency,CustomerReference:t,CallBackUrl:`${process.env.GATEWAY_SERVER_URL}/myfatoorah/callback`},s=await(0,d.firstValueFrom)(this.httpService.post(`${a}v2/ExecutePayment`,y,{headers:{Authorization:`Bearer ${e.gateway.privateKey}`}}));return n.Logger.log(`MyFatoorah excutePaymentResult: ${JSON.stringify(s)}`),{invoiceId:t,url:s.data.Data.PaymentURL}}};t.MyFatoorahService=y,t.MyFatoorahService=y=r.__decorate([(0,n.Injectable)(),r.__metadata("design:paramtypes",["function"==typeof(o=void 0!==i.HttpService&&i.HttpService)?o:Object])],y)},(e,t,a)=>{var o;Object.defineProperty(t,"__esModule",{value:!0}),t.SberBankService=void 0;const r=a(4),n=a(1),i=a(29),d=a(30);let y=class SberBankService{constructor(e){this.httpService=e}async getPaymentLink(e){const t=`${e.userType}_${e.userId}_${(new Date).getTime()}`;var a=`${process.env.GATEWAY_SERVER_URL}/sberbank/callback`;console.log(`Getting sberbank url with username: ${e.gateway.publicKey} and password ${e.gateway.privateKey}`);const o=null==process.env.DEMO_MODE?"https://3dsec.sberbank.ru/payment/rest/register.do":"https://securepayments.sberbank.ru/payment/rest/register.do";console.log(`Remote url: ${o}`);try{const r=await(0,d.firstValueFrom)(this.httpService.get(o,{params:{userName:e.gateway.publicKey,password:e.gateway.privateKey,amount:e.amount,orderNumber:t,returnUrl:a,failUrl:a,description:`\u041f\u043e\u043f\u043e\u043b\u043d\u0435\u043d\u0438\u0435 \u0431\u0430\u043b\u0430\u043d\u0441\u0430 \u043d\u0430 ${e.amount} ${e.currency}`,currency:e.currency}}));return console.log(`SberBank order: ${JSON.stringify(r.data)}`),{invoiceId:t,url:r.data.formUrl}}catch(r){throw console.log(r),new n.GatewayTimeoutException("Sberbank gateway is not available")}}};t.SberBankService=y,t.SberBankService=y=r.__decorate([(0,n.Injectable)(),r.__metadata("design:paramtypes",["function"==typeof(o=void 0!==i.HttpService&&i.HttpService)?o:Object])],y)},(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.MercadopagoService=void 0;const o=a(4),r=a(1),n=a(45);let i=class MercadopagoService{constructor(){}async getPaymentLink(e){const t=`${e.userType}_${e.userId}_${(new Date).getTime()}`;n.configure({access_token:e.gateway.privateKey});const a=`${process.env.GATEWAY_SERVER_URL}/mercadopago/callback?gatewayId=${e.gateway.id}`,o={items:[{title:"Recharge account",unit_price:parseFloat(e.amount),quantity:1,currency_id:e.currency}],payer:{name:"",surname:"",phone:{area_code:"1",number:6505551234}},back_urls:{success:a,failure:a,pending:a},external_reference:t,auto_return:"approved"},r=await n.preferences.create(o);return{url:`${process.env.GATEWAY_SERVER_URL}/mercadopago/redirect?token=${r.body.id}&gatewayId=${e.gateway.id}`,invoiceId:t}}};t.MercadopagoService=i,t.MercadopagoService=i=o.__decorate([(0,r.Injectable)(),o.__metadata("design:paramtypes",[])],i)},e=>{e.exports=require("mercadopago")},(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.WayForPayService=void 0;const o=a(4),r=a(1),n=a(47);let i=class WayForPayService{async getPaymentLink(e){const t=`${e.userType}_${e.userId}_${(new Date).getTime()}`;n.WFP_CONFIG.DEFAULT_PAYMENT_CURRENCY=e.currency;const a=new n.WFP({MERCHANT_ACCOUNT:e.gateway.merchantId,MERCHANT_SECRET_KEY:e.gateway.privateKey,MERCHANT_DOMAIN_NAME:e.gateway.publicKey,SERVICE_URL:`${process.env.GATEWAY_SERVER_URL}wayforpay/callback`});return{invoiceId:t,url:(await a.createInvoiceUrl({orderReference:t,productName:["Wallet"],productCount:[1],productPrice:[parseFloat(e.amount)]})).value.invoiceUrl}}async verify(e,t){return!0}};t.WayForPayService=i,t.WayForPayService=i=o.__decorate([(0,r.Injectable)()],i)},e=>{e.exports=require("overshom-wayforpay")},(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.InstaMojoService=void 0;const o=a(4),r=a(1);let n=class InstaMojoService{constructor(){}async getPaymentLink(e){const t=`${e.userType}_${e.userId}_${(new Date).getTime()}`,o=a(49);o.isSandboxMode(null!=process.env.DEMO_MODE),o.setKeys(e.gateway.publicKey,e.gateway.privateKey);const r={purpose:"Wallet Top-up",amount:e.amount,currency:e.currency,buyer_name:"Unknown",email:`${e.userType}_${e.userId}@mobile.com`,phone:e.userId,redirect_url:`${process.env.GATEWAY_SERVER_URL}/instamojo/callback?gatewayId=${e.gateway.id}`},n=o.PaymentData(r),i=await o.createNewPaymentRequest(n);return console.log(i),{url:`${process.env.GATEWAY_SERVER_URL}/instamojo/redirect?token=${i}&gatewayId=${e.gateway.id}`,invoiceId:t}}};t.InstaMojoService=n,t.InstaMojoService=n=o.__decorate([(0,r.Injectable)(),o.__metadata("design:paramtypes",[])],n)},e=>{e.exports=require("instamojo-payment-nodejs")},(e,t,a)=>{var o;Object.defineProperty(t,"__esModule",{value:!0}),t.BinancePayService=void 0;const r=a(4),n=a(1),i=a(29),d=a(30),y=a(23),s=a(51);let p=class BinancePayService{constructor(e){this.httpService=e}async getPaymentLink(e){const t=`${e.userType}z${e.userId}z${(new Date).getTime()}`,a={env:{terminalType:"APP"},merchantTradeNo:t,fiatAmount:e.amount,fiatCurrency:e.currency,goods:{goodsType:"02",goodsCategory:"9000",referenceGoodsId:"1",goodsName:"Wallet top-up",goodsUnitAmount:{amount:e.amount,currency:e.currency}},description:"Wallet top-up",returnUrl:`${process.env.GATEWAY_SERVER_URL}/binance/callback`,cancelUrl:`${process.env.GATEWAY_SERVER_URL}/binance/callback`};try{const o=await this.callBinancePay(e.gateway,"https://bpay.binanceapi.com/binancepay/openapi/v2/order",a);if(console.log(o.data.checkoutUrl),"SUCCESS"!==o.status)throw new Error(o.errorMessage);return{invoiceId:t,url:o.data.checkoutUrl}}catch(o){throw console.log(o),o}}async getPublicKey(e){return this.callBinancePay(e,"https://bpay.binanceapi.com/binancepay/openapi/certificates",{})}async verify(e,t){return!0}async callBinancePay(e,t,a){const o=(0,y.randomBytes)(32).toString("hex").substring(0,32),r=Date.now(),n=r+"\n"+o+"\n"+JSON.stringify(a)+"\n",i=(0,y.createHmac)("sha512",e.privateKey).update(n).digest("hex").toUpperCase();return(await(0,d.firstValueFrom)(this.httpService.post(t,a,{headers:{"content-type":"application/json","BinancePay-Timestamp":r,"BinancePay-Nonce":o,"BinancePay-Certificate-SN":e.publicKey,"BinancePay-Signature":i,httpsAgent:new s.Agent({rejectUnauthorized:!1})}}))).data}};t.BinancePayService=p,t.BinancePayService=p=r.__decorate([(0,n.Injectable)(),r.__metadata("design:paramtypes",["function"==typeof(o=void 0!==i.HttpService&&i.HttpService)?o:Object])],p)},e=>{e.exports=require("https")},(e,t,a)=>{var o;Object.defineProperty(t,"__esModule",{value:!0}),t.OpenPixService=void 0;const r=a(4),n=a(1),i=a(29),d=a(30),y=a(51);let s=class OpenPixService{constructor(e){this.httpService=e}async getPaymentLink(e){const t=`${e.userType}_${e.userId}_${(new Date).getTime()}`,a=await(0,d.firstValueFrom)(this.httpService.post("https://api.openpix.com.br/api/v1/charge?return_existing=true",{correlationID:t,value:100*parseFloat(e.amount)},{headers:{"Content-Type":"application/json",Authorization:e.gateway.privateKey,httpsAgent:new y.Agent({rejectUnauthorized:!1})}}));return console.log("result",JSON.stringify(a.data),"OpenPixService"),{url:a.data.charge.paymentLinkUrl,invoiceId:t}}};t.OpenPixService=s,t.OpenPixService=s=r.__decorate([(0,n.Injectable)(),r.__metadata("design:paramtypes",["function"==typeof(o=void 0!==i.HttpService&&i.HttpService)?o:Object])],s)},(e,t,a)=>{var o,r;Object.defineProperty(t,"__esModule",{value:!0}),t.PayoutMethodEntity=void 0;const n=a(4),i=a(54),d=a(15),y=a(55);let s=class PayoutMethodEntity{};t.PayoutMethodEntity=s,n.__decorate([(0,d.PrimaryGeneratedColumn)(),n.__metadata("design:type",Number)],s.prototype,"id",void 0),n.__decorate([(0,d.Column)({default:!0}),n.__metadata("design:type",Boolean)],s.prototype,"enabled",void 0),n.__decorate([(0,d.Column)(),n.__metadata("design:type",String)],s.prototype,"name",void 0),n.__decorate([(0,d.Column)(),n.__metadata("design:type",String)],s.prototype,"description",void 0),n.__decorate([(0,d.Column)("enum",{enum:i.PayoutMethodType}),n.__metadata("design:type","function"==typeof(o=void 0!==i.PayoutMethodType&&i.PayoutMethodType)?o:Object)],s.prototype,"type",void 0),n.__decorate([(0,d.Column)({nullable:!0,type:"text"}),n.__metadata("design:type",String)],s.prototype,"publicKey",void 0),n.__decorate([(0,d.Column)({type:"text"}),n.__metadata("design:type",String)],s.prototype,"privateKey",void 0),n.__decorate([(0,d.Column)({nullable:!0,type:"text"}),n.__metadata("design:type",String)],s.prototype,"saltKey",void 0),n.__decorate([(0,d.Column)({nullable:!0,type:"text"}),n.__metadata("design:type",String)],s.prototype,"merchantId",void 0),n.__decorate([(0,d.DeleteDateColumn)(),n.__metadata("design:type","function"==typeof(r="undefined"!=typeof Date&&Date)?r:Object)],s.prototype,"deletedAt",void 0),n.__decorate([(0,d.OneToMany)((()=>y.PayoutAccountEntity),(e=>e.payoutMethod)),n.__metadata("design:type",Array)],s.prototype,"payoutAccounts",void 0),t.PayoutMethodEntity=s=n.__decorate([(0,d.Entity)("payout_method")],s)},(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.PayoutMethodType=void 0;const o=a(10);var r;!function(e){e.Stripe="stripe",e.BankTransfer="bank_transfer"}(r||(t.PayoutMethodType=r={})),(0,o.registerEnumType)(r,{name:"PayoutMethodType",description:"The type of payout method"})},(e,t,a)=>{var o,r,n,i,d,y;Object.defineProperty(t,"__esModule",{value:!0}),t.PayoutAccountEntity=void 0;const s=a(4),p=a(15),c=a(53),u=a(18);let _=class PayoutAccountEntity{};t.PayoutAccountEntity=_,s.__decorate([(0,p.PrimaryGeneratedColumn)(),s.__metadata("design:type",Number)],_.prototype,"id",void 0),s.__decorate([(0,p.Column)(),s.__metadata("design:type",String)],_.prototype,"name",void 0),s.__decorate([(0,p.Column)(),s.__metadata("design:type",Number)],_.prototype,"driverId",void 0),s.__decorate([(0,p.ManyToOne)((()=>c.PayoutMethodEntity),(e=>e.payoutAccounts)),s.__metadata("design:type","function"==typeof(o=void 0!==c.PayoutMethodEntity&&c.PayoutMethodEntity)?o:Object)],_.prototype,"payoutMethod",void 0),s.__decorate([(0,p.Column)(),s.__metadata("design:type",Number)],_.prototype,"payoutMethodId",void 0),s.__decorate([(0,p.Column)({nullable:!0}),s.__metadata("design:type",String)],_.prototype,"token",void 0),s.__decorate([(0,p.Column)("enum",{enum:u.SavedPaymentMethodType}),s.__metadata("design:type","function"==typeof(r=void 0!==u.SavedPaymentMethodType&&u.SavedPaymentMethodType)?r:Object)],_.prototype,"type",void 0),s.__decorate([(0,p.Column)(),s.__metadata("design:type",String)],_.prototype,"last4",void 0),s.__decorate([(0,p.Column)(),s.__metadata("design:type",String)],_.prototype,"currency",void 0),s.__decorate([(0,p.Column)({nullable:!0}),s.__metadata("design:type",String)],_.prototype,"accountNumber",void 0),s.__decorate([(0,p.Column)({nullable:!0}),s.__metadata("design:type",String)],_.prototype,"routingNumber",void 0),s.__decorate([(0,p.Column)({nullable:!0}),s.__metadata("design:type",String)],_.prototype,"accountHolderName",void 0),s.__decorate([(0,p.Column)({nullable:!0}),s.__metadata("design:type",String)],_.prototype,"bankName",void 0),s.__decorate([(0,p.Column)({nullable:!0}),s.__metadata("design:type",String)],_.prototype,"branchName",void 0),s.__decorate([(0,p.Column)({nullable:!0}),s.__metadata("design:type",String)],_.prototype,"accountHolderAddress",void 0),s.__decorate([(0,p.Column)({nullable:!0}),s.__metadata("design:type",String)],_.prototype,"accountHolderCity",void 0),s.__decorate([(0,p.Column)({nullable:!0}),s.__metadata("design:type",String)],_.prototype,"accountHolderState",void 0),s.__decorate([(0,p.Column)({nullable:!0}),s.__metadata("design:type",String)],_.prototype,"accountHolderZip",void 0),s.__decorate([(0,p.Column)({nullable:!0}),s.__metadata("design:type",String)],_.prototype,"accountHolderCountry",void 0),s.__decorate([(0,p.Column)({nullable:!0}),s.__metadata("design:type",String)],_.prototype,"accountHolderPhone",void 0),s.__decorate([(0,p.Column)({nullable:!0}),s.__metadata("design:type","function"==typeof(n="undefined"!=typeof Date&&Date)?n:Object)],_.prototype,"accountHolderDateOfBirth",void 0),s.__decorate([(0,p.Column)({default:!1}),s.__metadata("design:type",Boolean)],_.prototype,"isVerified",void 0),s.__decorate([(0,p.Column)({default:!1}),s.__metadata("design:type",Boolean)],_.prototype,"isDefault",void 0),s.__decorate([(0,p.CreateDateColumn)(),s.__metadata("design:type","function"==typeof(i="undefined"!=typeof Date&&Date)?i:Object)],_.prototype,"createdAt",void 0),s.__decorate([(0,p.UpdateDateColumn)(),s.__metadata("design:type","function"==typeof(d="undefined"!=typeof Date&&Date)?d:Object)],_.prototype,"updatedAt",void 0),s.__decorate([(0,p.DeleteDateColumn)(),s.__metadata("design:type","function"==typeof(y="undefined"!=typeof Date&&Date)?y:Object)],_.prototype,"deletedAt",void 0),t.PayoutAccountEntity=_=s.__decorate([(0,p.Entity)("payout_account")],_)},(e,t,a)=>{var o;Object.defineProperty(t,"__esModule",{value:!0}),t.PayTRService=void 0;const r=a(4),n=a(1),i=a(29),d=a(23),y=a(30);let s=class PayTRService{constructor(e){this.httpService=e}async getPaymentLink(e){var t=e.gateway.merchantId,a=e.gateway.privateKey,o=e.gateway.saltKey;const r="Top-up wallet",n=e.amount,i=e.currency,s="collection",p=r+n+i+"2"+s+"en"+o+a,c=`${e.userType}_${e.userId}_${(new Date).getTime()}`;const u={merchant_id:t,name:r,price:n,currency:i,link_type:s,lang:"en",email:`${c}@user.com`,callback_link:"https://www.ridy.io/callback",max_installment:"2",callback_id:c,debug_on:"1",paytr_token:(0,d.createHmac)("sha256",a).update(p).digest("base64")};console.log(JSON.stringify(u));const _=await(0,y.firstValueFrom)(this.httpService.post("https://www.paytr.com/odeme/api/link/create",u,{headers:{"Content-Type":"application/x-www-form-urlencoded"}}));return console.log(JSON.stringify(_.data)),{invoiceId:c,url:_.data.url}}};t.PayTRService=s,t.PayTRService=s=r.__decorate([(0,n.Injectable)(),r.__metadata("design:paramtypes",["function"==typeof(o=void 0!==i.HttpService&&i.HttpService)?o:Object])],s)},(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CryptoModule=void 0;const o=a(4),r=a(1),n=a(22);let i=class CryptoModule{};t.CryptoModule=i,t.CryptoModule=i=o.__decorate([(0,r.Module)({providers:[n.CryptoService],exports:[n.CryptoService]})],i)},(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.PaymentModule=void 0;const o=a(4),r=a(1),n=a(13),i=a(57),d=a(24),y=a(21),s=a(53),p=a(55),c=a(59);let u=class PaymentModule{};t.PaymentModule=u,t.PaymentModule=u=o.__decorate([(0,r.Module)({imports:[i.CryptoModule,n.TypeOrmModule.forFeature([d.PaymentEntity,s.PayoutMethodEntity,p.PayoutAccountEntity])],providers:[y.PaymentService,c.PayoutService],exports:[y.PaymentService,c.PayoutService]})],u)},(e,t,a)=>{var o;Object.defineProperty(t,"__esModule",{value:!0}),t.PayoutService=void 0;const r=a(4),n=a(1),i=a(13),d=a(60),y=a(15);let s=class PayoutService{constructor(e){this.payoutAccountsRepository=e}async linkPayoutAccount(e){this.payoutAccountsRepository.update({driverId:e.driverId},{isDefault:!1});const t=this.payoutAccountsRepository.create({...e,isDefault:!0});return await this.payoutAccountsRepository.save(t),t}};t.PayoutService=s,t.PayoutService=s=r.__decorate([(0,n.Injectable)(),r.__param(0,(0,i.InjectRepository)(d.PayoutAccountEntity)),r.__metadata("design:paramtypes",["function"==typeof(o=void 0!==y.Repository&&y.Repository)?o:Object])],s)},(e,t,a)=>{var o,r,n,i,d,y,s,p;Object.defineProperty(t,"__esModule",{value:!0}),t.PayoutAccountEntity=void 0;const c=a(4),u=a(15),_=a(61),l=a(83),m=a(113),v=a(18),f=a(64);let g=class PayoutAccountEntity{};t.PayoutAccountEntity=g,c.__decorate([(0,u.PrimaryGeneratedColumn)(),c.__metadata("design:type",Number)],g.prototype,"id",void 0),c.__decorate([(0,u.Column)(),c.__metadata("design:type",String)],g.prototype,"name",void 0),c.__decorate([(0,u.ManyToOne)((()=>_.DriverEntity),(e=>e.payoutAccounts)),c.__metadata("design:type","function"==typeof(o=void 0!==_.DriverEntity&&_.DriverEntity)?o:Object)],g.prototype,"driver",void 0),c.__decorate([(0,u.Column)(),c.__metadata("design:type",Number)],g.prototype,"driverId",void 0),c.__decorate([(0,u.ManyToOne)((()=>l.PaymentGatewayEntity),(e=>e.payoutAccounts)),c.__metadata("design:type","function"==typeof(r=void 0!==l.PaymentGatewayEntity&&l.PaymentGatewayEntity)?r:Object)],g.prototype,"paymentGateway",void 0),c.__decorate([(0,u.Column)({nullable:!0}),c.__metadata("design:type",Number)],g.prototype,"paymentGatewayId",void 0),c.__decorate([(0,u.Column)("enum",{enum:v.SavedPaymentMethodType}),c.__metadata("design:type","function"==typeof(n=void 0!==v.SavedPaymentMethodType&&v.SavedPaymentMethodType)?n:Object)],g.prototype,"type",void 0),c.__decorate([(0,u.Column)(),c.__metadata("design:type",String)],g.prototype,"last4",void 0),c.__decorate([(0,u.Column)(),c.__metadata("design:type",String)],g.prototype,"currency",void 0),c.__decorate([(0,u.ManyToOne)((()=>m.PayoutMethodEntity),(e=>e.payoutAccounts)),c.__metadata("design:type","function"==typeof(i=void 0!==m.PayoutMethodEntity&&m.PayoutMethodEntity)?i:Object)],g.prototype,"payoutMethod",void 0),c.__decorate([(0,u.Column)(),c.__metadata("design:type",Number)],g.prototype,"payoutMethodId",void 0),c.__decorate([(0,u.Column)({nullable:!0}),c.__metadata("design:type",String)],g.prototype,"token",void 0),c.__decorate([(0,u.Column)({nullable:!0}),c.__metadata("design:type",String)],g.prototype,"accountNumber",void 0),c.__decorate([(0,u.Column)({nullable:!0}),c.__metadata("design:type",String)],g.prototype,"routingNumber",void 0),c.__decorate([(0,u.Column)({nullable:!0}),c.__metadata("design:type",String)],g.prototype,"accountHolderName",void 0),c.__decorate([(0,u.Column)({nullable:!0}),c.__metadata("design:type",String)],g.prototype,"bankName",void 0),c.__decorate([(0,u.Column)({nullable:!0}),c.__metadata("design:type",String)],g.prototype,"branchName",void 0),c.__decorate([(0,u.Column)({nullable:!0}),c.__metadata("design:type",String)],g.prototype,"accountHolderAddress",void 0),c.__decorate([(0,u.Column)({nullable:!0}),c.__metadata("design:type",String)],g.prototype,"accountHolderCity",void 0),c.__decorate([(0,u.Column)({nullable:!0}),c.__metadata("design:type",String)],g.prototype,"accountHolderState",void 0),c.__decorate([(0,u.Column)({nullable:!0}),c.__metadata("design:type",String)],g.prototype,"accountHolderZip",void 0),c.__decorate([(0,u.Column)({nullable:!0}),c.__metadata("design:type",String)],g.prototype,"accountHolderCountry",void 0),c.__decorate([(0,u.Column)({nullable:!0}),c.__metadata("design:type",String)],g.prototype,"accountHolderPhone",void 0),c.__decorate([(0,u.Column)({nullable:!0}),c.__metadata("design:type","function"==typeof(d="undefined"!=typeof Date&&Date)?d:Object)],g.prototype,"accountHolderDateOfBirth",void 0),c.__decorate([(0,u.Column)({default:!1}),c.__metadata("design:type",Boolean)],g.prototype,"isVerified",void 0),c.__decorate([(0,u.Column)({default:!1}),c.__metadata("design:type",Boolean)],g.prototype,"isDefault",void 0),c.__decorate([(0,u.CreateDateColumn)(),c.__metadata("design:type","function"==typeof(y="undefined"!=typeof Date&&Date)?y:Object)],g.prototype,"createdAt",void 0),c.__decorate([(0,u.UpdateDateColumn)(),c.__metadata("design:type","function"==typeof(s="undefined"!=typeof Date&&Date)?s:Object)],g.prototype,"updatedAt",void 0),c.__decorate([(0,u.DeleteDateColumn)(),c.__metadata("design:type","function"==typeof(p="undefined"!=typeof Date&&Date)?p:Object)],g.prototype,"deletedAt",void 0),c.__decorate([(0,u.OneToMany)((()=>f.DriverTransactionEntity),(e=>e.payoutAccount)),c.__metadata("design:type",Array)],g.prototype,"driverTransactions",void 0),t.PayoutAccountEntity=g=c.__decorate([(0,u.Entity)("payout_account")],g)},(e,t,a)=>{var o,r,n,i,d,y,s,p,c;Object.defineProperty(t,"__esModule",{value:!0}),t.DriverEntity=void 0;const u=a(4),_=a(15),l=a(62),m=a(63),v=a(64),f=a(139),g=a(140),b=a(77),S=a(123),P=a(109),O=a(106),M=a(80),E=a(73),C=a(94),h=a(93),T=a(121),w=a(76),R=a(60);let j=class DriverEntity{};t.DriverEntity=j,u.__decorate([(0,_.PrimaryGeneratedColumn)(),u.__metadata("design:type",Number)],j.prototype,"id",void 0),u.__decorate([(0,_.Column)({nullable:!0}),u.__metadata("design:type",String)],j.prototype,"firstName",void 0),u.__decorate([(0,_.Column)({nullable:!0}),u.__metadata("design:type",String)],j.prototype,"lastName",void 0),u.__decorate([(0,_.Column)({nullable:!0,type:"varchar",length:5}),u.__metadata("design:type",String)],j.prototype,"countryIso",void 0),u.__decorate([(0,_.Column)("bigint",{unique:!0}),u.__metadata("design:type",String)],j.prototype,"mobileNumber",void 0),u.__decorate([(0,_.Column)({nullable:!0}),u.__metadata("design:type",String)],j.prototype,"certificateNumber",void 0),u.__decorate([(0,_.Column)({nullable:!0}),u.__metadata("design:type",String)],j.prototype,"email",void 0),u.__decorate([(0,_.Column)({nullable:!0}),u.__metadata("design:type",String)],j.prototype,"password",void 0),u.__decorate([(0,_.ManyToOne)((()=>m.CarModelEntity),(e=>e.drivers),{onDelete:"SET NULL"}),u.__metadata("design:type","function"==typeof(o=void 0!==m.CarModelEntity&&m.CarModelEntity)?o:Object)],j.prototype,"car",void 0),u.__decorate([(0,_.Column)({nullable:!0}),u.__metadata("design:type",Number)],j.prototype,"carId",void 0),u.__decorate([(0,_.Column)("varchar",{nullable:!0,name:"carColor"}),u.__metadata("design:type",String)],j.prototype,"carColorLegacy",void 0),u.__decorate([(0,_.ManyToOne)((()=>l.CarColorEntity),(e=>e.drivers)),u.__metadata("design:type","function"==typeof(r=void 0!==l.CarColorEntity&&l.CarColorEntity)?r:Object)],j.prototype,"carColor",void 0),u.__decorate([(0,_.Column)({nullable:!0}),u.__metadata("design:type",Number)],j.prototype,"carColorId",void 0),u.__decorate([(0,_.Column)("int",{nullable:!0}),u.__metadata("design:type",Number)],j.prototype,"carProductionYear",void 0),u.__decorate([(0,_.Column)({nullable:!0}),u.__metadata("design:type",String)],j.prototype,"carPlate",void 0),u.__decorate([(0,_.Column)("int",{nullable:!0}),u.__metadata("design:type",Number)],j.prototype,"searchDistance",void 0),u.__decorate([(0,_.Column)("enum",{default:g.DriverStatus.WaitingDocuments,enum:g.DriverStatus}),u.__metadata("design:type","function"==typeof(n=void 0!==g.DriverStatus&&g.DriverStatus)?n:Object)],j.prototype,"status",void 0),u.__decorate([(0,_.Column)("enum",{nullable:!0,enum:b.Gender}),u.__metadata("design:type","function"==typeof(i=void 0!==b.Gender&&b.Gender)?i:Object)],j.prototype,"gender",void 0),u.__decorate([(0,_.CreateDateColumn)(),u.__metadata("design:type","function"==typeof(d="undefined"!=typeof Date&&Date)?d:Object)],j.prototype,"registrationTimestamp",void 0),u.__decorate([(0,_.Column)("tinyint",{nullable:!0}),u.__metadata("design:type",Number)],j.prototype,"rating",void 0),u.__decorate([(0,_.Column)("smallint",{default:0}),u.__metadata("design:type",Number)],j.prototype,"reviewCount",void 0),u.__decorate([(0,_.Column)({nullable:!0}),u.__metadata("design:type","function"==typeof(y="undefined"!=typeof Date&&Date)?y:Object)],j.prototype,"lastSeenTimestamp",void 0),u.__decorate([(0,_.ManyToMany)((()=>w.RiderEntity),(e=>e.favoriteDrivers)),u.__metadata("design:type",Array)],j.prototype,"ridersFavorited",void 0),u.__decorate([(0,_.ManyToMany)((()=>w.RiderEntity),(e=>e.blockedDrivers)),u.__metadata("design:type",Array)],j.prototype,"ridersBlocked",void 0),u.__decorate([(0,_.OneToMany)((()=>M.MediaEntity),(e=>e.uploadedByDriver)),u.__metadata("design:type",Array)],j.prototype,"uploads",void 0),u.__decorate([(0,_.ManyToMany)((()=>C.ServiceEntity),(e=>e.drivers)),(0,_.JoinTable)({name:"driver_services_service"}),u.__metadata("design:type",Array)],j.prototype,"enabledServices",void 0),u.__decorate([(0,_.OneToMany)((()=>M.MediaEntity),(e=>e.driverDocument)),u.__metadata("design:type",Array)],j.prototype,"documents",void 0),u.__decorate([(0,_.Column)({nullable:!0}),u.__metadata("design:type",String)],j.prototype,"accountNumber",void 0),u.__decorate([(0,_.Column)({nullable:!0}),u.__metadata("design:type",String)],j.prototype,"bankName",void 0),u.__decorate([(0,_.Column)({nullable:!0}),u.__metadata("design:type",String)],j.prototype,"bankRoutingNumber",void 0),u.__decorate([(0,_.Column)({nullable:!0}),u.__metadata("design:type",String)],j.prototype,"bankSwift",void 0),u.__decorate([(0,_.Column)({nullable:!0}),u.__metadata("design:type",String)],j.prototype,"address",void 0),u.__decorate([(0,_.Column)({nullable:!0}),u.__metadata("design:type",String)],j.prototype,"notificationPlayerId",void 0),u.__decorate([(0,_.Column)({nullable:!0,name:"documentsNote"}),u.__metadata("design:type",String)],j.prototype,"softRejectionNote",void 0),u.__decorate([(0,_.DeleteDateColumn)(),u.__metadata("design:type","function"==typeof(s="undefined"!=typeof Date&&Date)?s:Object)],j.prototype,"deletedAt",void 0),u.__decorate([(0,_.OneToOne)((()=>M.MediaEntity),(e=>e.driver)),(0,_.JoinColumn)(),u.__metadata("design:type","function"==typeof(p=void 0!==M.MediaEntity&&M.MediaEntity)?p:Object)],j.prototype,"media",void 0),u.__decorate([(0,_.Column)({nullable:!0}),u.__metadata("design:type",Number)],j.prototype,"mediaId",void 0),u.__decorate([(0,_.Column)("int",{nullable:!0}),u.__metadata("design:type",Number)],j.prototype,"presetAvatarNumber",void 0),u.__decorate([(0,_.OneToMany)((()=>R.PayoutAccountEntity),(e=>e.driver)),u.__metadata("design:type",Array)],j.prototype,"payoutAccounts",void 0),u.__decorate([(0,_.OneToMany)((()=>S.FeedbackEntity),(e=>e.driver)),u.__metadata("design:type",Array)],j.prototype,"feedbacks",void 0),u.__decorate([(0,_.ManyToOne)((()=>O.FleetEntity),(e=>e.drivers)),u.__metadata("design:type","function"==typeof(c=void 0!==O.FleetEntity&&O.FleetEntity)?c:Object)],j.prototype,"fleet",void 0),u.__decorate([(0,_.Column)({nullable:!0}),u.__metadata("design:type",Number)],j.prototype,"fleetId",void 0),u.__decorate([(0,_.OneToMany)((()=>f.DriverWalletEntity),(e=>e.driver)),u.__metadata("design:type",Array)],j.prototype,"wallet",void 0),u.__decorate([(0,_.OneToMany)((()=>v.DriverTransactionEntity),(e=>e.driver),{onDelete:"CASCADE",onUpdate:"RESTRICT"}),u.__metadata("design:type",Array)],j.prototype,"transactions",void 0),u.__decorate([(0,_.OneToMany)((()=>E.RequestEntity),(e=>e.driver),{onDelete:"SET NULL",onUpdate:"CASCADE"}),u.__metadata("design:type",Array)],j.prototype,"orders",void 0),u.__decorate([(0,_.OneToMany)((()=>P.FleetTransactionEntity),(e=>e.driver)),u.__metadata("design:type",Array)],j.prototype,"fleetTransactions",void 0),u.__decorate([(0,_.OneToMany)((()=>h.SavedPaymentMethodEntity),(e=>e.driver)),u.__metadata("design:type",Array)],j.prototype,"savedPaymentMethods",void 0),u.__decorate([(0,_.OneToMany)((()=>T.RiderReviewEntity),(e=>e.driver)),u.__metadata("design:type",Array)],j.prototype,"reviewsByDriver",void 0),t.DriverEntity=j=u.__decorate([(0,_.Entity)("driver")],j)},(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CarColorEntity=void 0;const o=a(4),r=a(15),n=a(61);let i=class CarColorEntity{};t.CarColorEntity=i,o.__decorate([(0,r.PrimaryGeneratedColumn)(),o.__metadata("design:type",Number)],i.prototype,"id",void 0),o.__decorate([(0,r.Column)(),o.__metadata("design:type",String)],i.prototype,"name",void 0),o.__decorate([(0,r.OneToMany)((()=>n.DriverEntity),(e=>e.carColor)),o.__metadata("design:type",Array)],i.prototype,"drivers",void 0),t.CarColorEntity=i=o.__decorate([(0,r.Entity)("car_color")],i)},(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CarModelEntity=void 0;const o=a(4),r=a(15),n=a(61);let i=class CarModelEntity{};t.CarModelEntity=i,o.__decorate([(0,r.PrimaryGeneratedColumn)(),o.__metadata("design:type",Number)],i.prototype,"id",void 0),o.__decorate([(0,r.Column)({name:"title"}),o.__metadata("design:type",String)],i.prototype,"name",void 0),o.__decorate([(0,r.OneToMany)((()=>n.DriverEntity),(e=>e.car)),o.__metadata("design:type",Array)],i.prototype,"drivers",void 0),t.CarModelEntity=i=o.__decorate([(0,r.Entity)("car")],i)},(e,t,a)=>{var o,r,n,i,d,y,s,p,c,u,_,l,m;Object.defineProperty(t,"__esModule",{value:!0}),t.DriverTransactionEntity=void 0;const v=a(4),f=a(15),g=a(61),b=a(65),S=a(66),P=a(67),O=a(68),M=a(69),E=a(73),C=a(83),h=a(87),T=a(114),w=a(60),R=a(113);let j=class DriverTransactionEntity{};t.DriverTransactionEntity=j,v.__decorate([(0,f.PrimaryGeneratedColumn)(),v.__metadata("design:type",Number)],j.prototype,"id",void 0),v.__decorate([(0,f.CreateDateColumn)({name:"transactionTime"}),v.__metadata("design:type","function"==typeof(o="undefined"!=typeof Date&&Date)?o:Object)],j.prototype,"createdAt",void 0),v.__decorate([(0,f.Column)("enum",{enum:O.TransactionStatus,default:O.TransactionStatus.Processing}),v.__metadata("design:type","function"==typeof(r=void 0!==O.TransactionStatus&&O.TransactionStatus)?r:Object)],j.prototype,"status",void 0),v.__decorate([(0,f.Column)("enum",{enum:P.TransactionAction}),v.__metadata("design:type","function"==typeof(n=void 0!==P.TransactionAction&&P.TransactionAction)?n:Object)],j.prototype,"action",void 0),v.__decorate([(0,f.Column)("enum",{enum:b.DriverDeductTransactionType,nullable:!0}),v.__metadata("design:type","function"==typeof(i=void 0!==b.DriverDeductTransactionType&&b.DriverDeductTransactionType)?i:Object)],j.prototype,"deductType",void 0),v.__decorate([(0,f.Column)("enum",{enum:S.DriverRechargeTransactionType,nullable:!0}),v.__metadata("design:type","function"==typeof(d=void 0!==S.DriverRechargeTransactionType&&S.DriverRechargeTransactionType)?d:Object)],j.prototype,"rechargeType",void 0),v.__decorate([(0,f.Column)("float",{default:"0.00",precision:10,scale:2}),v.__metadata("design:type",Number)],j.prototype,"amount",void 0),v.__decorate([(0,f.Column)("char",{length:"3"}),v.__metadata("design:type",String)],j.prototype,"currency",void 0),v.__decorate([(0,f.Column)({nullable:!0,name:"documentNumber"}),v.__metadata("design:type",String)],j.prototype,"refrenceNumber",void 0),v.__decorate([(0,f.Column)({nullable:!0,name:"details"}),v.__metadata("design:type",String)],j.prototype,"description",void 0),v.__decorate([(0,f.ManyToOne)((()=>g.DriverEntity),(e=>e.transactions)),v.__metadata("design:type","function"==typeof(y=void 0!==g.DriverEntity&&g.DriverEntity)?y:Object)],j.prototype,"driver",void 0),v.__decorate([(0,f.Column)(),v.__metadata("design:type",Number)],j.prototype,"driverId",void 0),v.__decorate([(0,f.ManyToOne)((()=>C.PaymentGatewayEntity),(e=>e.riderTransactions)),v.__metadata("design:type","function"==typeof(s=void 0!==C.PaymentGatewayEntity&&C.PaymentGatewayEntity)?s:Object)],j.prototype,"paymentGateway",void 0),v.__decorate([(0,f.Column)({nullable:!0}),v.__metadata("design:type",Number)],j.prototype,"paymentGatewayId",void 0),v.__decorate([(0,f.ManyToOne)((()=>M.OperatorEntity),(e=>e.driverTransactions)),v.__metadata("design:type","function"==typeof(p=void 0!==M.OperatorEntity&&M.OperatorEntity)?p:Object)],j.prototype,"operator",void 0),v.__decorate([(0,f.Column)({nullable:!0}),v.__metadata("design:type",Number)],j.prototype,"operatorId",void 0),v.__decorate([(0,f.ManyToOne)((()=>E.RequestEntity),(e=>e.driverTransactions)),v.__metadata("design:type","function"==typeof(c=void 0!==E.RequestEntity&&E.RequestEntity)?c:Object)],j.prototype,"request",void 0),v.__decorate([(0,f.Column)({nullable:!0}),v.__metadata("design:type",Number)],j.prototype,"requestId",void 0),v.__decorate([(0,f.OneToOne)((()=>h.GiftCodeEntity),(e=>e.riderTransaction)),(0,f.JoinColumn)(),v.__metadata("design:type","function"==typeof(u=void 0!==h.GiftCodeEntity&&h.GiftCodeEntity)?u:Object)],j.prototype,"giftCard",void 0),v.__decorate([(0,f.Column)({nullable:!0}),v.__metadata("design:type",Number)],j.prototype,"giftCardId",void 0),v.__decorate([(0,f.ManyToOne)((()=>T.PayoutSessionEntity),(e=>e.driverTransactions)),v.__metadata("design:type","function"==typeof(_=void 0!==T.PayoutSessionEntity&&T.PayoutSessionEntity)?_:Object)],j.prototype,"payoutSession",void 0),v.__decorate([(0,f.Column)({nullable:!0}),v.__metadata("design:type",Number)],j.prototype,"payoutSessionId",void 0),v.__decorate([(0,f.ManyToOne)((()=>w.PayoutAccountEntity),(e=>e.driverTransactions)),v.__metadata("design:type","function"==typeof(l=void 0!==w.PayoutAccountEntity&&w.PayoutAccountEntity)?l:Object)],j.prototype,"payoutAccount",void 0),v.__decorate([(0,f.Column)({nullable:!0}),v.__metadata("design:type",Number)],j.prototype,"payoutAccountId",void 0),v.__decorate([(0,f.ManyToOne)((()=>R.PayoutMethodEntity),(e=>e.driverTransactions)),v.__metadata("design:type","function"==typeof(m=void 0!==R.PayoutMethodEntity&&R.PayoutMethodEntity)?m:Object)],j.prototype,"payoutMethod",void 0),v.__decorate([(0,f.Column)({nullable:!0}),v.__metadata("design:type",Number)],j.prototype,"payoutMethodId",void 0),t.DriverTransactionEntity=j=v.__decorate([(0,f.Entity)("driver_transaction")],j)},(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.DriverDeductTransactionType=void 0;const o=a(10);var r;!function(e){e.Withdraw="Withdraw",e.Commission="Commission",e.Correction="Correction"}(r||(t.DriverDeductTransactionType=r={})),(0,o.registerEnumType)(r,{name:"DriverDeductTransactionType"})},(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.DriverRechargeTransactionType=void 0;const o=a(10);var r;!function(e){e.OrderFee="OrderFee",e.BankTransfer="BankTransfer",e.InAppPayment="InAppPayment",e.Gift="Gift"}(r||(t.DriverRechargeTransactionType=r={})),(0,o.registerEnumType)(r,{name:"DriverRechargeTransactionType"})},(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.TransactionAction=void 0;const o=a(10);var r;!function(e){e.Recharge="Recharge",e.Deduct="Deduct"}(r||(t.TransactionAction=r={})),(0,o.registerEnumType)(r,{name:"TransactionAction"})},(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.TransactionStatus=void 0;const o=a(10);var r;!function(e){e.Processing="Processing",e.Done="Done",e.Canceled="Canceled",e.Rejected="Rejected"}(r||(t.TransactionStatus=r={})),(0,o.registerEnumType)(r,{name:"TransactionStatus"})},(e,t,a)=>{var o,r,n;Object.defineProperty(t,"__esModule",{value:!0}),t.OperatorEntity=void 0;const i=a(4),d=a(15),y=a(70),s=a(64),p=a(136),c=a(109),u=a(106),_=a(80),l=a(137),m=a(89),v=a(73),f=a(84),g=a(131),b=a(114),S=a(88);let P=class OperatorEntity{};t.OperatorEntity=P,i.__decorate([(0,d.PrimaryGeneratedColumn)(),i.__metadata("design:type",Number)],P.prototype,"id",void 0),i.__decorate([(0,d.Column)({nullable:!0}),i.__metadata("design:type",String)],P.prototype,"firstName",void 0),i.__decorate([(0,d.Column)({nullable:!0}),i.__metadata("design:type",String)],P.prototype,"lastName",void 0),i.__decorate([(0,d.Column)({unique:!0}),i.__metadata("design:type",String)],P.prototype,"userName",void 0),i.__decorate([(0,d.Column)({default:"admin"}),i.__metadata("design:type",String)],P.prototype,"password",void 0),i.__decorate([(0,d.Column)("bigint",{nullable:!0,unique:!0}),i.__metadata("design:type",String)],P.prototype,"mobileNumber",void 0),i.__decorate([(0,d.Column)("set",{enum:p.EnabledNotification,default:[p.EnabledNotification.Complaint,p.EnabledNotification.SOS,p.EnabledNotification.DriverSubmittedDocs]}),i.__metadata("design:type",Array)],P.prototype,"enabledNotifications",void 0),i.__decorate([(0,d.Column)({nullable:!0}),i.__metadata("design:type",String)],P.prototype,"email",void 0),i.__decorate([(0,d.Column)({nullable:!0}),i.__metadata("design:type",String)],P.prototype,"address",void 0),i.__decorate([(0,d.OneToOne)((()=>_.MediaEntity),(e=>e.operator)),(0,d.JoinColumn)(),i.__metadata("design:type","function"==typeof(o=void 0!==_.MediaEntity&&_.MediaEntity)?o:Object)],P.prototype,"media",void 0),i.__decorate([(0,d.Column)({nullable:!0}),i.__metadata("design:type",Number)],P.prototype,"mediaId",void 0),i.__decorate([(0,d.ManyToOne)((()=>l.OperatorRoleEntity),(e=>e.operators)),i.__metadata("design:type","function"==typeof(r=void 0!==l.OperatorRoleEntity&&l.OperatorRoleEntity)?r:Object)],P.prototype,"role",void 0),i.__decorate([(0,d.Column)({nullable:!0}),i.__metadata("design:type",Number)],P.prototype,"roleId",void 0),i.__decorate([(0,d.ManyToOne)((()=>u.FleetEntity),(e=>e.operators)),i.__metadata("design:type","function"==typeof(n=void 0!==u.FleetEntity&&u.FleetEntity)?n:Object)],P.prototype,"fleet",void 0),i.__decorate([(0,d.OneToMany)((()=>v.RequestEntity),(e=>e.operator),{onDelete:"RESTRICT",onUpdate:"RESTRICT"}),i.__metadata("design:type",Array)],P.prototype,"requests",void 0),i.__decorate([(0,d.OneToMany)((()=>y.ComplaintActivityEntity),(e=>e.actor)),i.__metadata("design:type",Array)],P.prototype,"complaintActivities",void 0),i.__decorate([(0,d.OneToMany)((()=>f.RiderTransactionEntity),(e=>e.operator)),i.__metadata("design:type",Array)],P.prototype,"riderTransactions",void 0),i.__decorate([(0,d.OneToMany)((()=>s.DriverTransactionEntity),(e=>e.operator)),i.__metadata("design:type",Array)],P.prototype,"driverTransactions",void 0),i.__decorate([(0,d.OneToMany)((()=>c.FleetTransactionEntity),(e=>e.operator)),i.__metadata("design:type",Array)],P.prototype,"fleetTransactions",void 0),i.__decorate([(0,d.OneToMany)((()=>m.ProviderTransactionEntity),(e=>e.operator)),i.__metadata("design:type",Array)],P.prototype,"providerTransactions",void 0),i.__decorate([(0,d.OneToMany)((()=>g.SOSActivityEntity),(e=>e.operator)),i.__metadata("design:type",Array)],P.prototype,"sosActivities",void 0),i.__decorate([(0,d.OneToMany)((()=>b.PayoutSessionEntity),(e=>e.createdByOperator)),i.__metadata("design:type",Array)],P.prototype,"payoutSessionsCreated",void 0),i.__decorate([(0,d.OneToMany)((()=>S.GiftBatchEntity),(e=>e.createdByOperator)),i.__metadata("design:type",Array)],P.prototype,"giftBatchesCreated",void 0),t.OperatorEntity=P=i.__decorate([(0,d.Entity)("operator")],P)},(e,t,a)=>{var o,r,n,i;Object.defineProperty(t,"__esModule",{value:!0}),t.ComplaintActivityEntity=void 0;const d=a(4),y=a(15),s=a(71),p=a(135),c=a(69);let u=class ComplaintActivityEntity{};t.ComplaintActivityEntity=u,d.__decorate([(0,y.PrimaryGeneratedColumn)(),d.__metadata("design:type",Number)],u.prototype,"id",void 0),d.__decorate([(0,y.Column)("enum",{enum:p.ComplaintActivityType}),d.__metadata("design:type","function"==typeof(o=void 0!==p.ComplaintActivityType&&p.ComplaintActivityType)?o:Object)],u.prototype,"type",void 0),d.__decorate([(0,y.ManyToOne)((()=>c.OperatorEntity),(e=>e.complaintActivities)),d.__metadata("design:type","function"==typeof(r=void 0!==c.OperatorEntity&&c.OperatorEntity)?r:Object)],u.prototype,"actor",void 0),d.__decorate([(0,y.ManyToOne)((()=>c.OperatorEntity)),d.__metadata("design:type","function"==typeof(n=void 0!==c.OperatorEntity&&c.OperatorEntity)?n:Object)],u.prototype,"assignedTo",void 0),d.__decorate([(0,y.Column)({nullable:!0}),d.__metadata("design:type",Number)],u.prototype,"assignedToId",void 0),d.__decorate([(0,y.Column)({nullable:!0}),d.__metadata("design:type",String)],u.prototype,"comment",void 0),d.__decorate([(0,y.ManyToOne)((()=>s.ComplaintEntity),(e=>e.activities)),d.__metadata("design:type","function"==typeof(i=void 0!==s.ComplaintEntity&&s.ComplaintEntity)?i:Object)],u.prototype,"complaint",void 0),d.__decorate([(0,y.Column)(),d.__metadata("design:type",Number)],u.prototype,"complaintId",void 0),t.ComplaintActivityEntity=u=d.__decorate([(0,y.Entity)("complaint_activity")],u)},(e,t,a)=>{var o,r,n;Object.defineProperty(t,"__esModule",{value:!0}),t.ComplaintEntity=void 0;const i=a(4),d=a(15),y=a(70),s=a(72),p=a(73);let c=class ComplaintEntity{};t.ComplaintEntity=c,i.__decorate([(0,d.PrimaryGeneratedColumn)(),i.__metadata("design:type",Number)],c.prototype,"id",void 0),i.__decorate([(0,d.CreateDateColumn)(),i.__metadata("design:type","function"==typeof(o="undefined"!=typeof Date&&Date)?o:Object)],c.prototype,"inscriptionTimestamp",void 0),i.__decorate([(0,d.ManyToOne)((()=>p.RequestEntity),(e=>e.complaints)),i.__metadata("design:type","function"==typeof(r=void 0!==p.RequestEntity&&p.RequestEntity)?r:Object)],c.prototype,"request",void 0),i.__decorate([(0,d.Column)(),i.__metadata("design:type",Number)],c.prototype,"requestId",void 0),i.__decorate([(0,d.Column)(),i.__metadata("design:type",Boolean)],c.prototype,"requestedByDriver",void 0),i.__decorate([(0,d.Column)(),i.__metadata("design:type",String)],c.prototype,"subject",void 0),i.__decorate([(0,d.Column)({nullable:!0}),i.__metadata("design:type",String)],c.prototype,"content",void 0),i.__decorate([(0,d.Column)("enum",{enum:s.ComplaintStatus,default:s.ComplaintStatus.Submitted}),i.__metadata("design:type","function"==typeof(n=void 0!==s.ComplaintStatus&&s.ComplaintStatus)?n:Object)],c.prototype,"status",void 0),i.__decorate([(0,d.OneToMany)((()=>y.ComplaintActivityEntity),(e=>e.complaint)),i.__metadata("design:type",Array)],c.prototype,"activities",void 0),t.ComplaintEntity=c=i.__decorate([(0,d.Entity)("complaint")],c)},(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ComplaintStatus=void 0;const o=a(10);var r;!function(e){e.Submitted="Submitted",e.UnderInvestigation="UnderInvestigation",e.Resolved="Resolved"}(r||(t.ComplaintStatus=r={})),(0,o.registerEnumType)(r,{name:"ComplaintStatus"})},(e,t,a)=>{var o,r,n,i,d,y,s,p,c,u,_,l,m,v,f,g,b,S,P,O;Object.defineProperty(t,"__esModule",{value:!0}),t.RequestEntity=void 0;const M=a(4),E=a(15),C=a(74),h=a(71),T=a(75),w=a(64),R=a(61),j=a(122),I=a(123),A=a(109),F=a(125),D=a(83),N=a(89),k=a(76),q=a(84),G=a(94),x=a(69),$=a(127),U=a(102),B=a(129),L=a(106),W=a(133),V=a(134),K=a(93),H=a(121);let z=class RequestEntity{};t.RequestEntity=z,M.__decorate([(0,E.PrimaryGeneratedColumn)(),M.__metadata("design:type",Number)],z.prototype,"id",void 0),M.__decorate([(0,E.CreateDateColumn)({name:"requestTimestamp"}),M.__metadata("design:type","function"==typeof(o="undefined"!=typeof Date&&Date)?o:Object)],z.prototype,"createdOn",void 0),M.__decorate([(0,E.Column)({nullable:!0}),M.__metadata("design:type","function"==typeof(r="undefined"!=typeof Date&&Date)?r:Object)],z.prototype,"startTimestamp",void 0),M.__decorate([(0,E.Column)({nullable:!0}),M.__metadata("design:type","function"==typeof(n="undefined"!=typeof Date&&Date)?n:Object)],z.prototype,"finishTimestamp",void 0),M.__decorate([(0,E.Column)("enum",{enum:j.OrderStatus,default:j.OrderStatus.Requested}),M.__metadata("design:type","function"==typeof(i=void 0!==j.OrderStatus&&j.OrderStatus)?i:Object)],z.prototype,"status",void 0),M.__decorate([(0,E.Column)("int",{default:0}),M.__metadata("design:type",Number)],z.prototype,"distanceBest",void 0),M.__decorate([(0,E.Column)("int",{default:0}),M.__metadata("design:type",Number)],z.prototype,"durationBest",void 0),M.__decorate([(0,E.Column)("int",{default:0}),M.__metadata("design:type",Number)],z.prototype,"waitMinutes",void 0),M.__decorate([(0,E.Column)("float",{precision:10,scale:2,default:0}),M.__metadata("design:type",Number)],z.prototype,"waitCost",void 0),M.__decorate([(0,E.Column)("float",{precision:10,scale:2,default:0}),M.__metadata("design:type",Number)],z.prototype,"rideOptionsCost",void 0),M.__decorate([(0,E.Column)("float",{precision:10,scale:2,default:0}),M.__metadata("design:type",Number)],z.prototype,"taxCost",void 0),M.__decorate([(0,E.Column)("float",{precision:10,scale:2,default:0}),M.__metadata("design:type",Number)],z.prototype,"serviceCost",void 0),M.__decorate([(0,E.Column)(),M.__metadata("design:type","function"==typeof(d="undefined"!=typeof Date&&Date)?d:Object)],z.prototype,"expectedTimestamp",void 0),M.__decorate([(0,E.Column)({nullable:!0}),M.__metadata("design:type","function"==typeof(y="undefined"!=typeof Date&&Date)?y:Object)],z.prototype,"etaPickup",void 0),M.__decorate([(0,E.Column)("float",{precision:10,scale:2}),M.__metadata("design:type",Number)],z.prototype,"costBest",void 0),M.__decorate([(0,E.Column)("float",{precision:10,scale:2,default:"0.00"}),M.__metadata("design:type",Number)],z.prototype,"costAfterCoupon",void 0),M.__decorate([(0,E.Column)("float",{precision:10,scale:2,default:"0.00"}),M.__metadata("design:type",Number)],z.prototype,"tipAmount",void 0),M.__decorate([(0,E.Column)("float",{default:0,precision:10,scale:2}),M.__metadata("design:type",Number)],z.prototype,"paidAmount",void 0),M.__decorate([(0,E.Column)("float",{precision:10,default:0,scale:2}),M.__metadata("design:type",Number)],z.prototype,"providerShare",void 0),M.__decorate([(0,E.Column)("tinyint",{default:-1}),M.__metadata("design:type",Number)],z.prototype,"destinationArrivedTo",void 0),M.__decorate([(0,E.OneToMany)((()=>$.RequestActivityEntity),(e=>e.request)),M.__metadata("design:type",Array)],z.prototype,"activities",void 0),M.__decorate([(0,E.Column)({type:"text",transformer:{to:e=>e.join("|"),from:e=>null==e?[]:e.split("|")}}),M.__metadata("design:type",Array)],z.prototype,"addresses",void 0),M.__decorate([(0,E.Column)("multipoint",{transformer:new C.MultipointTransformer}),M.__metadata("design:type",Array)],z.prototype,"points",void 0),M.__decorate([(0,E.Column)("multipoint",{transformer:new C.MultipointTransformer,nullable:!0}),M.__metadata("design:type",Array)],z.prototype,"directions",void 0),M.__decorate([(0,E.Column)("multipoint",{transformer:new C.MultipointTransformer,nullable:!0}),M.__metadata("design:type",Array)],z.prototype,"driverDirections",void 0),M.__decorate([(0,E.Column)({default:()=>"CURRENT_TIMESTAMP"}),M.__metadata("design:type","function"==typeof(s="undefined"!=typeof Date&&Date)?s:Object)],z.prototype,"driverLastSeenMessagesAt",void 0),M.__decorate([(0,E.Column)({default:()=>"CURRENT_TIMESTAMP"}),M.__metadata("design:type","function"==typeof(p="undefined"!=typeof Date&&Date)?p:Object)],z.prototype,"riderLastSeenMessagesAt",void 0),M.__decorate([(0,E.ManyToOne)((()=>R.DriverEntity),(e=>e.orders)),M.__metadata("design:type","function"==typeof(c=void 0!==R.DriverEntity&&R.DriverEntity)?c:Object)],z.prototype,"driver",void 0),M.__decorate([(0,E.Column)({nullable:!0}),M.__metadata("design:type",Number)],z.prototype,"driverId",void 0),M.__decorate([(0,E.ManyToOne)((()=>k.RiderEntity),(e=>e.orders)),M.__metadata("design:type","function"==typeof(u=void 0!==k.RiderEntity&&k.RiderEntity)?u:Object)],z.prototype,"rider",void 0),M.__decorate([(0,E.Column)(),M.__metadata("design:type",Number)],z.prototype,"riderId",void 0),M.__decorate([(0,E.ManyToOne)((()=>T.CouponEntity),(e=>e.orders)),M.__metadata("design:type","function"==typeof(_=void 0!==T.CouponEntity&&T.CouponEntity)?_:Object)],z.prototype,"coupon",void 0),M.__decorate([(0,E.Column)({nullable:!0}),M.__metadata("design:type",Number)],z.prototype,"couponId",void 0),M.__decorate([(0,E.Column)("char",{length:3}),M.__metadata("design:type",String)],z.prototype,"currency",void 0),M.__decorate([(0,E.OneToMany)((()=>F.OrderMessageEntity),(e=>e.request)),M.__metadata("design:type",Array)],z.prototype,"conversation",void 0),M.__decorate([(0,E.Column)("enum",{enum:V.PaymentMode,nullable:!0}),M.__metadata("design:type","function"==typeof(l=void 0!==V.PaymentMode&&V.PaymentMode)?l:Object)],z.prototype,"paymentMode",void 0),M.__decorate([(0,E.ManyToOne)((()=>D.PaymentGatewayEntity),(e=>e.orders)),M.__metadata("design:type","function"==typeof(m=void 0!==D.PaymentGatewayEntity&&D.PaymentGatewayEntity)?m:Object)],z.prototype,"paymentGateway",void 0),M.__decorate([(0,E.Column)({nullable:!0}),M.__metadata("design:type",Number)],z.prototype,"paymentGatewayId",void 0),M.__decorate([(0,E.ManyToOne)((()=>K.SavedPaymentMethodEntity),(e=>e.orders)),M.__metadata("design:type","function"==typeof(v=void 0!==K.SavedPaymentMethodEntity&&K.SavedPaymentMethodEntity)?v:Object)],z.prototype,"savedPaymentMethod",void 0),M.__decorate([(0,E.Column)({nullable:!0}),M.__metadata("design:type",Number)],z.prototype,"savedPaymentMethodId",void 0),M.__decorate([(0,E.OneToMany)((()=>h.ComplaintEntity),(e=>e.request)),M.__metadata("design:type",Array)],z.prototype,"complaints",void 0),M.__decorate([(0,E.ManyToOne)((()=>G.ServiceEntity),(e=>e.requests)),M.__metadata("design:type","function"==typeof(f=void 0!==G.ServiceEntity&&G.ServiceEntity)?f:Object)],z.prototype,"service",void 0),M.__decorate([(0,E.Column)(),M.__metadata("design:type",Number)],z.prototype,"serviceId",void 0),M.__decorate([(0,E.ManyToOne)((()=>x.OperatorEntity),(e=>e.requests),{onDelete:"CASCADE"}),M.__metadata("design:type","function"==typeof(g=void 0!==x.OperatorEntity&&x.OperatorEntity)?g:Object)],z.prototype,"operator",void 0),M.__decorate([(0,E.Column)({nullable:!0}),M.__metadata("design:type",Number)],z.prototype,"operatorId",void 0),M.__decorate([(0,E.ManyToOne)((()=>L.FleetEntity),(e=>e.requests),{onDelete:"SET NULL"}),M.__metadata("design:type","function"==typeof(b=void 0!==L.FleetEntity&&L.FleetEntity)?b:Object)],z.prototype,"fleet",void 0),M.__decorate([(0,E.Column)({nullable:!0}),M.__metadata("design:type",Number)],z.prototype,"fleetId",void 0),M.__decorate([(0,E.OneToMany)((()=>q.RiderTransactionEntity),(e=>e.request)),M.__metadata("design:type",Array)],z.prototype,"riderTransactions",void 0),M.__decorate([(0,E.OneToMany)((()=>A.FleetTransactionEntity),(e=>e.request)),M.__metadata("design:type",Array)],z.prototype,"fleetTransactions",void 0),M.__decorate([(0,E.OneToOne)((()=>I.FeedbackEntity),(e=>e.request)),M.__metadata("design:type","function"==typeof(S=void 0!==I.FeedbackEntity&&I.FeedbackEntity)?S:Object)],z.prototype,"review",void 0),M.__decorate([(0,E.OneToMany)((()=>w.DriverTransactionEntity),(e=>e.request)),M.__metadata("design:type",Array)],z.prototype,"driverTransactions",void 0),M.__decorate([(0,E.OneToMany)((()=>N.ProviderTransactionEntity),(e=>e.request)),M.__metadata("design:type",Array)],z.prototype,"providerTransactions",void 0),M.__decorate([(0,E.ManyToMany)((()=>U.ServiceOptionEntity),(e=>e.requests),{onDelete:"CASCADE"}),(0,E.JoinTable)(),M.__metadata("design:type",Array)],z.prototype,"options",void 0),M.__decorate([(0,E.OneToMany)((()=>B.SOSEntity),(e=>e.request)),M.__metadata("design:type",Array)],z.prototype,"sosCalls",void 0),M.__decorate([(0,E.ManyToOne)((()=>W.OrderCancelReasonEntity),(e=>e.orders)),M.__metadata("design:type","function"==typeof(P=void 0!==W.OrderCancelReasonEntity&&W.OrderCancelReasonEntity)?P:Object)],z.prototype,"cancelReason",void 0),M.__decorate([(0,E.Column)({nullable:!0}),M.__metadata("design:type",Number)],z.prototype,"cancelReasonId",void 0),M.__decorate([(0,E.Column)({nullable:!0}),M.__metadata("design:type",String)],z.prototype,"cancelReasonNote",void 0),M.__decorate([(0,E.OneToOne)((()=>H.RiderReviewEntity),(e=>e.request)),M.__metadata("design:type","function"==typeof(O=void 0!==H.RiderReviewEntity&&H.RiderReviewEntity)?O:Object)],z.prototype,"driverReviewForRider",void 0),t.RequestEntity=z=M.__decorate([(0,E.Entity)("request")],z)},(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.MultipointTransformer=void 0;t.MultipointTransformer=class MultipointTransformer{to(e){return null==e||e.length<1?null:`MULTIPOINT(${e.map((e=>`${e.lng} ${e.lat}`)).join(",")})`}from(e){if(null==e)return[];return e.substring(11,e.length-1).split(",").map((e=>{const t=e.substring(1,e.length-1).split(" ");return{lng:parseFloat(t[0]),lat:parseFloat(t[1])}}))}}},(e,t,a)=>{var o,r;Object.defineProperty(t,"__esModule",{value:!0}),t.CouponEntity=void 0;const n=a(4),i=a(15),d=a(73),y=a(76),s=a(94);let p=class CouponEntity{};t.CouponEntity=p,n.__decorate([(0,i.PrimaryGeneratedColumn)(),n.__metadata("design:type",Number)],p.prototype,"id",void 0),n.__decorate([(0,i.Column)({unique:!0}),n.__metadata("design:type",String)],p.prototype,"code",void 0),n.__decorate([(0,i.Column)(),n.__metadata("design:type",String)],p.prototype,"title",void 0),n.__decorate([(0,i.Column)({nullable:!0}),n.__metadata("design:type",String)],p.prototype,"description",void 0),n.__decorate([(0,i.Column)({default:0}),n.__metadata("design:type",Number)],p.prototype,"manyUsersCanUse",void 0),n.__decorate([(0,i.Column)({default:1}),n.__metadata("design:type",Number)],p.prototype,"manyTimesUserCanUse",void 0),n.__decorate([(0,i.Column)("float",{default:"0.00",precision:10,scale:2}),n.__metadata("design:type",Number)],p.prototype,"minimumCost",void 0),n.__decorate([(0,i.Column)("float",{default:"0.00",precision:10,scale:2}),n.__metadata("design:type",Number)],p.prototype,"maximumCost",void 0),n.__decorate([(0,i.Column)({name:"startTimestamp"}),n.__metadata("design:type","function"==typeof(o="undefined"!=typeof Date&&Date)?o:Object)],p.prototype,"startAt",void 0),n.__decorate([(0,i.Column)({name:"expirationTimestamp",nullable:!0}),n.__metadata("design:type","function"==typeof(r="undefined"!=typeof Date&&Date)?r:Object)],p.prototype,"expireAt",void 0),n.__decorate([(0,i.Column)("tinyint",{default:0}),n.__metadata("design:type",Number)],p.prototype,"discountPercent",void 0),n.__decorate([(0,i.Column)("float",{default:0,precision:10,scale:2}),n.__metadata("design:type",Number)],p.prototype,"discountFlat",void 0),n.__decorate([(0,i.Column)("float",{default:0,precision:10,scale:2}),n.__metadata("design:type",Number)],p.prototype,"creditGift",void 0),n.__decorate([(0,i.Column)({default:!0}),n.__metadata("design:type",Boolean)],p.prototype,"isEnabled",void 0),n.__decorate([(0,i.Column)({default:!1}),n.__metadata("design:type",Boolean)],p.prototype,"isFirstTravelOnly",void 0),n.__decorate([(0,i.ManyToMany)((()=>s.ServiceEntity),(e=>e.allowedCoupons)),(0,i.JoinTable)({name:"coupon_services_service"}),n.__metadata("design:type",Array)],p.prototype,"allowedServices",void 0),n.__decorate([(0,i.ManyToMany)((()=>y.RiderEntity),(e=>e.coupons)),n.__metadata("design:type",Array)],p.prototype,"riders",void 0),n.__decorate([(0,i.OneToMany)((()=>d.RequestEntity),(e=>e.coupon),{onDelete:"CASCADE",onUpdate:"NO ACTION"}),n.__metadata("design:type",Array)],p.prototype,"orders",void 0),t.CouponEntity=p=n.__decorate([(0,i.Entity)("coupon")],p)},(e,t,a)=>{var o,r,n,i,d,y;Object.defineProperty(t,"__esModule",{value:!0}),t.RiderEntity=void 0;const s=a(4),p=a(15),c=a(75),u=a(77),_=a(78),l=a(79),m=a(80),v=a(73),f=a(116),g=a(84),b=a(120),S=a(93),P=a(121),O=a(61);let M=class RiderEntity{};t.RiderEntity=M,s.__decorate([(0,p.PrimaryGeneratedColumn)(),s.__metadata("design:type",Number)],M.prototype,"id",void 0),s.__decorate([(0,p.Column)("enum",{enum:l.RiderStatus,default:l.RiderStatus.Enabled}),s.__metadata("design:type","function"==typeof(o=void 0!==l.RiderStatus&&l.RiderStatus)?o:Object)],M.prototype,"status",void 0),s.__decorate([(0,p.Column)({nullable:!0}),s.__metadata("design:type",String)],M.prototype,"firstName",void 0),s.__decorate([(0,p.Column)({nullable:!0}),s.__metadata("design:type",String)],M.prototype,"lastName",void 0),s.__decorate([(0,p.Column)({nullable:!0,type:"varchar",length:5}),s.__metadata("design:type",String)],M.prototype,"countryIso",void 0),s.__decorate([(0,p.Column)("bigint",{unique:!0}),s.__metadata("design:type",String)],M.prototype,"mobileNumber",void 0),s.__decorate([(0,p.CreateDateColumn)(),s.__metadata("design:type","function"==typeof(r="undefined"!=typeof Date&&Date)?r:Object)],M.prototype,"registrationTimestamp",void 0),s.__decorate([(0,p.Column)({nullable:!0}),s.__metadata("design:type",String)],M.prototype,"email",void 0),s.__decorate([(0,p.Column)("enum",{enum:u.Gender,nullable:!0}),s.__metadata("design:type","function"==typeof(n=void 0!==u.Gender&&u.Gender)?n:Object)],M.prototype,"gender",void 0),s.__decorate([(0,p.Column)("varchar",{nullable:!0}),s.__metadata("design:type",String)],M.prototype,"address",void 0),s.__decorate([(0,p.Column)({nullable:!0}),s.__metadata("design:type",Boolean)],M.prototype,"isResident",void 0),s.__decorate([(0,p.Column)({nullable:!0}),s.__metadata("design:type",String)],M.prototype,"idNumber",void 0),s.__decorate([(0,p.Column)({nullable:!0}),s.__metadata("design:type",String)],M.prototype,"password",void 0),s.__decorate([(0,p.Column)({nullable:!0}),s.__metadata("design:type","function"==typeof(i=void 0!==_.RiderDocumentType&&_.RiderDocumentType)?i:Object)],M.prototype,"documentType",void 0),s.__decorate([(0,p.Column)({nullable:!0}),s.__metadata("design:type",String)],M.prototype,"notificationPlayerId",void 0),s.__decorate([(0,p.DeleteDateColumn)(),s.__metadata("design:type","function"==typeof(d="undefined"!=typeof Date&&Date)?d:Object)],M.prototype,"deletedAt",void 0),s.__decorate([(0,p.OneToMany)((()=>f.RiderAddressEntity),(e=>e.rider)),s.__metadata("design:type",Array)],M.prototype,"addresses",void 0),s.__decorate([(0,p.OneToOne)((()=>m.MediaEntity),(e=>e.rider)),(0,p.JoinColumn)(),s.__metadata("design:type","function"==typeof(y=void 0!==m.MediaEntity&&m.MediaEntity)?y:Object)],M.prototype,"media",void 0),s.__decorate([(0,p.Column)({nullable:!0}),s.__metadata("design:type",Number)],M.prototype,"mediaId",void 0),s.__decorate([(0,p.Column)("int",{nullable:!0}),s.__metadata("design:type",Number)],M.prototype,"presetAvatarNumber",void 0),s.__decorate([(0,p.OneToMany)((()=>v.RequestEntity),(e=>e.rider)),s.__metadata("design:type",Array)],M.prototype,"orders",void 0),s.__decorate([(0,p.OneToMany)((()=>b.RiderWalletEntity),(e=>e.rider)),s.__metadata("design:type",Array)],M.prototype,"wallets",void 0),s.__decorate([(0,p.ManyToMany)((()=>O.DriverEntity),(e=>e.ridersFavorited)),(0,p.JoinTable)(),s.__metadata("design:type",Array)],M.prototype,"favoriteDrivers",void 0),s.__decorate([(0,p.ManyToMany)((()=>O.DriverEntity),(e=>e.ridersBlocked)),(0,p.JoinTable)(),s.__metadata("design:type",Array)],M.prototype,"blockedDrivers",void 0),s.__decorate([(0,p.OneToMany)((()=>g.RiderTransactionEntity),(e=>e.rider),{onDelete:"CASCADE",onUpdate:"RESTRICT"}),s.__metadata("design:type",Array)],M.prototype,"transactions",void 0),s.__decorate([(0,p.ManyToMany)((()=>c.CouponEntity),(e=>e.riders)),(0,p.JoinTable)(),s.__metadata("design:type",Array)],M.prototype,"coupons",void 0),s.__decorate([(0,p.OneToMany)((()=>S.SavedPaymentMethodEntity),(e=>e.rider)),s.__metadata("design:type",Array)],M.prototype,"savedPaymentMethods",void 0),s.__decorate([(0,p.OneToMany)((()=>P.RiderReviewEntity),(e=>e.rider)),s.__metadata("design:type",Array)],M.prototype,"reviewsForRider",void 0),t.RiderEntity=M=s.__decorate([(0,p.Entity)("rider")],M)},(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Gender=void 0;const o=a(10);var r;!function(e){e.Male="male",e.Female="female",e.Unknown="unknown"}(r||(t.Gender=r={})),(0,o.registerEnumType)(r,{name:"Gender"})},(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.RiderDocumentType=void 0;const o=a(10);var r;!function(e){e.ID="ID",e.Passport="Passport",e.DriverLicense="DriverLicense",e.ResidentPermitID="ResidentPermitID"}(r||(t.RiderDocumentType=r={})),(0,o.registerEnumType)(r,{name:"RiderDocumentType"})},(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.RiderStatus=void 0;const o=a(10);var r;!function(e){e.Enabled="enabled",e.Disabled="blocked"}(r||(t.RiderStatus=r={})),(0,o.registerEnumType)(r,{name:"RiderStatus"})},(e,t,a)=>{var o,r,n,i,d,y,s;Object.defineProperty(t,"__esModule",{value:!0}),t.MediaEntity=void 0;const p=a(4),c=a(15),u=a(81),_=a(61),l=a(69),m=a(83),v=a(76),f=a(94),g=a(113);let b=class MediaEntity{};t.MediaEntity=b,p.__decorate([(0,c.PrimaryGeneratedColumn)(),p.__metadata("design:type",Number)],b.prototype,"id",void 0),p.__decorate([(0,c.Column)("varchar"),p.__metadata("design:type",String)],b.prototype,"address",void 0),p.__decorate([(0,c.Column)("longtext",{nullable:!0}),p.__metadata("design:type",String)],b.prototype,"base64",void 0),p.__decorate([(0,c.OneToOne)((()=>_.DriverEntity),(e=>e.media),{onDelete:"SET NULL"}),p.__metadata("design:type","function"==typeof(o=void 0!==_.DriverEntity&&_.DriverEntity)?o:Object)],b.prototype,"driver",void 0),p.__decorate([(0,c.ManyToOne)((()=>_.DriverEntity),(e=>e.documents),{onDelete:"SET NULL"}),p.__metadata("design:type","function"==typeof(r=void 0!==_.DriverEntity&&_.DriverEntity)?r:Object)],b.prototype,"driverDocument",void 0),p.__decorate([(0,c.Column)({nullable:!0}),p.__metadata("design:type",Number)],b.prototype,"driverDocumentId",void 0),p.__decorate([(0,c.OneToOne)((()=>l.OperatorEntity),(e=>e.media),{onDelete:"SET NULL"}),p.__metadata("design:type","function"==typeof(n=void 0!==l.OperatorEntity&&l.OperatorEntity)?n:Object)],b.prototype,"operator",void 0),p.__decorate([(0,c.OneToOne)((()=>u.AnnouncementEntity),(e=>e.media),{onDelete:"SET NULL"}),p.__metadata("design:type","function"==typeof(i=void 0!==u.AnnouncementEntity&&u.AnnouncementEntity)?i:Object)],b.prototype,"announcement",void 0),p.__decorate([(0,c.OneToOne)((()=>v.RiderEntity),(e=>e.media),{onDelete:"SET NULL"}),p.__metadata("design:type",Array)],b.prototype,"rider",void 0),p.__decorate([(0,c.OneToOne)((()=>f.ServiceEntity),(e=>e.media),{onDelete:"SET NULL"}),p.__metadata("design:type",Array)],b.prototype,"service",void 0),p.__decorate([(0,c.OneToOne)((()=>m.PaymentGatewayEntity),(e=>e.media),{onDelete:"SET NULL"}),p.__metadata("design:type","function"==typeof(d=void 0!==m.PaymentGatewayEntity&&m.PaymentGatewayEntity)?d:Object)],b.prototype,"paymentGateway",void 0),p.__decorate([(0,c.OneToOne)((()=>g.PayoutMethodEntity),(e=>e.media),{onDelete:"SET NULL"}),p.__metadata("design:type","function"==typeof(y=void 0!==g.PayoutMethodEntity&&g.PayoutMethodEntity)?y:Object)],b.prototype,"payoutMethod",void 0),p.__decorate([(0,c.ManyToOne)((()=>_.DriverEntity),(e=>e.uploads),{onDelete:"SET NULL"}),p.__metadata("design:type","function"==typeof(s=void 0!==_.DriverEntity&&_.DriverEntity)?s:Object)],b.prototype,"uploadedByDriver",void 0),p.__decorate([(0,c.Column)({nullable:!0}),p.__metadata("design:type",Number)],b.prototype,"uploadedByDriverId",void 0),t.MediaEntity=b=p.__decorate([(0,c.Entity)("media")],b)},(e,t,a)=>{var o,r,n;Object.defineProperty(t,"__esModule",{value:!0}),t.AnnouncementEntity=void 0;const i=a(4),d=a(15),y=a(82),s=a(80);let p=class AnnouncementEntity{};t.AnnouncementEntity=p,i.__decorate([(0,d.PrimaryGeneratedColumn)(),i.__metadata("design:type",Number)],p.prototype,"id",void 0),i.__decorate([(0,d.Column)("set",{enum:y.AnnouncementUserType,default:[y.AnnouncementUserType.Rider]}),i.__metadata("design:type",Array)],p.prototype,"userType",void 0),i.__decorate([(0,d.Column)({name:"startTimestamp"}),i.__metadata("design:type","function"==typeof(o="undefined"!=typeof Date&&Date)?o:Object)],p.prototype,"startAt",void 0),i.__decorate([(0,d.Column)({name:"expirationTimestamp"}),i.__metadata("design:type","function"==typeof(r="undefined"!=typeof Date&&Date)?r:Object)],p.prototype,"expireAt",void 0),i.__decorate([(0,d.Column)(),i.__metadata("design:type",String)],p.prototype,"title",void 0),i.__decorate([(0,d.Column)({nullable:!0}),i.__metadata("design:type",String)],p.prototype,"url",void 0),i.__decorate([(0,d.Column)(),i.__metadata("design:type",String)],p.prototype,"description",void 0),i.__decorate([(0,d.OneToOne)((()=>s.MediaEntity),(e=>e.announcement)),(0,d.JoinColumn)(),i.__metadata("design:type","function"==typeof(n=void 0!==s.MediaEntity&&s.MediaEntity)?n:Object)],p.prototype,"media",void 0),i.__decorate([(0,d.Column)({nullable:!0}),i.__metadata("design:type",Number)],p.prototype,"mediaId",void 0),t.AnnouncementEntity=p=i.__decorate([(0,d.Entity)("promotion")],p)},(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.AnnouncementUserType=void 0;const o=a(10);var r;!function(e){e.Driver="Driver",e.Rider="Rider",e.Operator="Operator"}(r||(t.AnnouncementUserType=r={})),(0,o.registerEnumType)(r,{name:"AnnouncementUserType"})},(e,t,a)=>{var o,r,n;Object.defineProperty(t,"__esModule",{value:!0}),t.PaymentGatewayEntity=void 0;const i=a(4),d=a(15),y=a(73),s=a(84),p=a(9),c=a(89),u=a(80),_=a(92),l=a(93),m=a(60);let v=class PaymentGatewayEntity{};t.PaymentGatewayEntity=v,i.__decorate([(0,d.PrimaryGeneratedColumn)(),i.__metadata("design:type",Number)],v.prototype,"id",void 0),i.__decorate([(0,d.Column)({default:!0}),i.__metadata("design:type",Boolean)],v.prototype,"enabled",void 0),i.__decorate([(0,d.Column)(),i.__metadata("design:type",String)],v.prototype,"title",void 0),i.__decorate([(0,d.Column)("enum",{enum:p.PaymentGatewayType}),i.__metadata("design:type","function"==typeof(o=void 0!==p.PaymentGatewayType&&p.PaymentGatewayType)?o:Object)],v.prototype,"type",void 0),i.__decorate([(0,d.Column)({nullable:!0,type:"text"}),i.__metadata("design:type",String)],v.prototype,"publicKey",void 0),i.__decorate([(0,d.Column)({type:"text"}),i.__metadata("design:type",String)],v.prototype,"privateKey",void 0),i.__decorate([(0,d.Column)({nullable:!0,type:"text"}),i.__metadata("design:type",String)],v.prototype,"saltKey",void 0),i.__decorate([(0,d.Column)({nullable:!0,type:"text"}),i.__metadata("design:type",String)],v.prototype,"merchantId",void 0),i.__decorate([(0,d.DeleteDateColumn)(),i.__metadata("design:type","function"==typeof(r="undefined"!=typeof Date&&Date)?r:Object)],v.prototype,"deletedAt",void 0),i.__decorate([(0,d.OneToOne)((()=>u.MediaEntity),(e=>e.paymentGateway),{nullable:!0}),(0,d.JoinColumn)(),i.__metadata("design:type","function"==typeof(n=void 0!==u.MediaEntity&&u.MediaEntity)?n:Object)],v.prototype,"media",void 0),i.__decorate([(0,d.Column)({nullable:!0}),i.__metadata("design:type",Number)],v.prototype,"mediaId",void 0),i.__decorate([(0,d.OneToMany)((()=>y.RequestEntity),(e=>e.paymentGateway)),i.__metadata("design:type",Array)],v.prototype,"orders",void 0),i.__decorate([(0,d.OneToMany)((()=>s.RiderTransactionEntity),(e=>e.paymentGateway)),i.__metadata("design:type",Array)],v.prototype,"riderTransactions",void 0),i.__decorate([(0,d.OneToMany)((()=>c.ProviderTransactionEntity),(e=>e.paymentGateway)),i.__metadata("design:type",Array)],v.prototype,"adminTransactions",void 0),i.__decorate([(0,d.OneToMany)((()=>_.GatewayToUserEntity),(e=>e.gateway)),i.__metadata("design:type",Array)],v.prototype,"userIds",void 0),i.__decorate([(0,d.OneToMany)((()=>l.SavedPaymentMethodEntity),(e=>e.paymentGateway)),i.__metadata("design:type",Array)],v.prototype,"savedPaymentMethods",void 0),i.__decorate([(0,d.OneToMany)((()=>m.PayoutAccountEntity),(e=>e.paymentGateway)),i.__metadata("design:type",Array)],v.prototype,"payoutAccounts",void 0),t.PaymentGatewayEntity=v=i.__decorate([(0,d.Entity)("payment_gateway")],v)},(e,t,a)=>{var o,r,n,i,d,y,s,p,c,u;Object.defineProperty(t,"__esModule",{value:!0}),t.RiderTransactionEntity=void 0;const _=a(4),l=a(15),m=a(85),v=a(86),f=a(67),g=a(68),b=a(69),S=a(73),P=a(83),O=a(76),M=a(87);let E=class RiderTransactionEntity{};t.RiderTransactionEntity=E,_.__decorate([(0,l.PrimaryGeneratedColumn)(),_.__metadata("design:type",Number)],E.prototype,"id",void 0),_.__decorate([(0,l.CreateDateColumn)({name:"transactionTime"}),_.__metadata("design:type","function"==typeof(o="undefined"!=typeof Date&&Date)?o:Object)],E.prototype,"createdAt",void 0),_.__decorate([(0,l.Column)("enum",{enum:g.TransactionStatus,default:g.TransactionStatus.Processing}),_.__metadata("design:type","function"==typeof(r=void 0!==g.TransactionStatus&&g.TransactionStatus)?r:Object)],E.prototype,"status",void 0),_.__decorate([(0,l.Column)("enum",{enum:f.TransactionAction}),_.__metadata("design:type","function"==typeof(n=void 0!==f.TransactionAction&&f.TransactionAction)?n:Object)],E.prototype,"action",void 0),_.__decorate([(0,l.Column)("enum",{enum:m.RiderDeductTransactionType,nullable:!0}),_.__metadata("design:type","function"==typeof(i=void 0!==m.RiderDeductTransactionType&&m.RiderDeductTransactionType)?i:Object)],E.prototype,"deductType",void 0),_.__decorate([(0,l.Column)("enum",{enum:v.RiderRechargeTransactionType,nullable:!0}),_.__metadata("design:type","function"==typeof(d=void 0!==v.RiderRechargeTransactionType&&v.RiderRechargeTransactionType)?d:Object)],E.prototype,"rechargeType",void 0),_.__decorate([(0,l.Column)("float",{default:"0.00",precision:10,scale:2}),_.__metadata("design:type",Number)],E.prototype,"amount",void 0),_.__decorate([(0,l.Column)("char",{length:"3"}),_.__metadata("design:type",String)],E.prototype,"currency",void 0),_.__decorate([(0,l.Column)({nullable:!0,name:"documentNumber"}),_.__metadata("design:type",String)],E.prototype,"refrenceNumber",void 0),_.__decorate([(0,l.Column)({nullable:!0,name:"details"}),_.__metadata("design:type",String)],E.prototype,"description",void 0),_.__decorate([(0,l.ManyToOne)((()=>O.RiderEntity),(e=>e.transactions)),_.__metadata("design:type","function"==typeof(y=void 0!==O.RiderEntity&&O.RiderEntity)?y:Object)],E.prototype,"rider",void 0),_.__decorate([(0,l.Column)(),_.__metadata("design:type",Number)],E.prototype,"riderId",void 0),_.__decorate([(0,l.ManyToOne)((()=>P.PaymentGatewayEntity),(e=>e.riderTransactions)),_.__metadata("design:type","function"==typeof(s=void 0!==P.PaymentGatewayEntity&&P.PaymentGatewayEntity)?s:Object)],E.prototype,"paymentGateway",void 0),_.__decorate([(0,l.Column)({nullable:!0}),_.__metadata("design:type",Number)],E.prototype,"paymentGatewayId",void 0),_.__decorate([(0,l.ManyToOne)((()=>b.OperatorEntity),(e=>e.riderTransactions)),_.__metadata("design:type","function"==typeof(p=void 0!==b.OperatorEntity&&b.OperatorEntity)?p:Object)],E.prototype,"operator",void 0),_.__decorate([(0,l.Column)({nullable:!0,name:"operatorId"}),_.__metadata("design:type",Number)],E.prototype,"operatorId",void 0),_.__decorate([(0,l.OneToOne)((()=>M.GiftCodeEntity),(e=>e.riderTransaction)),(0,l.JoinColumn)(),_.__metadata("design:type","function"==typeof(c=void 0!==M.GiftCodeEntity&&M.GiftCodeEntity)?c:Object)],E.prototype,"giftCard",void 0),_.__decorate([(0,l.Column)({nullable:!0}),_.__metadata("design:type",Number)],E.prototype,"giftCardId",void 0),_.__decorate([(0,l.ManyToOne)((()=>S.RequestEntity),(e=>e.riderTransactions)),_.__metadata("design:type","function"==typeof(u=void 0!==S.RequestEntity&&S.RequestEntity)?u:Object)],E.prototype,"request",void 0),_.__decorate([(0,l.Column)({nullable:!0}),_.__metadata("design:type",Number)],E.prototype,"requestId",void 0),t.RiderTransactionEntity=E=_.__decorate([(0,l.Entity)("rider_transaction")],E)},(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.RiderDeductTransactionType=void 0;const o=a(10);var r;!function(e){e.OrderFee="OrderFee",e.ParkingFee="ParkingFee",e.CancellationFee="CancellationFee",e.Withdraw="Withdraw",e.Correction="Correction"}(r||(t.RiderDeductTransactionType=r={})),(0,o.registerEnumType)(r,{name:"RiderDeductTransactionType"})},(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.RiderRechargeTransactionType=void 0;const o=a(10);var r;!function(e){e.BankTransfer="BankTransfer",e.Gift="Gift",e.Correction="Correction",e.InAppPayment="InAppPayment"}(r||(t.RiderRechargeTransactionType=r={})),(0,o.registerEnumType)(r,{name:"RiderRechargeTransactionType"})},(e,t,a)=>{var o,r,n,i;Object.defineProperty(t,"__esModule",{value:!0}),t.GiftCodeEntity=void 0;const d=a(4),y=a(15),s=a(84),p=a(64),c=a(88);let u=class GiftCodeEntity{};t.GiftCodeEntity=u,d.__decorate([(0,y.PrimaryGeneratedColumn)(),d.__metadata("design:type",Number)],u.prototype,"id",void 0),d.__decorate([(0,y.Column)(),d.__metadata("design:type",String)],u.prototype,"code",void 0),d.__decorate([(0,y.Column)({nullable:!0}),d.__metadata("design:type","function"==typeof(o="undefined"!=typeof Date&&Date)?o:Object)],u.prototype,"usedAt",void 0),d.__decorate([(0,y.OneToOne)((()=>p.DriverTransactionEntity),(e=>e.giftCard)),d.__metadata("design:type","function"==typeof(r=void 0!==p.DriverTransactionEntity&&p.DriverTransactionEntity)?r:Object)],u.prototype,"driverTransaction",void 0),d.__decorate([(0,y.OneToOne)((()=>s.RiderTransactionEntity),(e=>e.giftCard)),d.__metadata("design:type","function"==typeof(n=void 0!==s.RiderTransactionEntity&&s.RiderTransactionEntity)?n:Object)],u.prototype,"riderTransaction",void 0),d.__decorate([(0,y.ManyToOne)((()=>c.GiftBatchEntity),(e=>e.giftCodes)),d.__metadata("design:type","function"==typeof(i=void 0!==c.GiftBatchEntity&&c.GiftBatchEntity)?i:Object)],u.prototype,"gift",void 0),d.__decorate([(0,y.Column)(),d.__metadata("design:type",Number)],u.prototype,"giftId",void 0),t.GiftCodeEntity=u=d.__decorate([(0,y.Entity)("gift_code")],u)},(e,t,a)=>{var o,r,n,i;Object.defineProperty(t,"__esModule",{value:!0}),t.GiftBatchEntity=void 0;const d=a(4),y=a(15),s=a(87),p=a(69);let c=class GiftBatchEntity{};t.GiftBatchEntity=c,d.__decorate([(0,y.PrimaryGeneratedColumn)(),d.__metadata("design:type",Number)],c.prototype,"id",void 0),d.__decorate([(0,y.CreateDateColumn)(),d.__metadata("design:type","function"==typeof(o="undefined"!=typeof Date&&Date)?o:Object)],c.prototype,"createdAt",void 0),d.__decorate([(0,y.Column)(),d.__metadata("design:type",String)],c.prototype,"name",void 0),d.__decorate([(0,y.Column)("varchar",{length:3}),d.__metadata("design:type",String)],c.prototype,"currency",void 0),d.__decorate([(0,y.Column)("float",{precision:10,scale:2}),d.__metadata("design:type",Number)],c.prototype,"amount",void 0),d.__decorate([(0,y.Column)({nullable:!0}),d.__metadata("design:type","function"==typeof(r="undefined"!=typeof Date&&Date)?r:Object)],c.prototype,"availableFrom",void 0),d.__decorate([(0,y.Column)({nullable:!0}),d.__metadata("design:type","function"==typeof(n="undefined"!=typeof Date&&Date)?n:Object)],c.prototype,"expireAt",void 0),d.__decorate([(0,y.ManyToOne)((()=>p.OperatorEntity),(e=>e.giftBatchesCreated)),d.__metadata("design:type","function"==typeof(i=void 0!==p.OperatorEntity&&p.OperatorEntity)?i:Object)],c.prototype,"createdByOperator",void 0),d.__decorate([(0,y.Column)(),d.__metadata("design:type",Number)],c.prototype,"createdByOperatorId",void 0),d.__decorate([(0,y.OneToMany)((()=>s.GiftCodeEntity),(e=>e.gift)),d.__metadata("design:type",Array)],c.prototype,"giftCodes",void 0),t.GiftBatchEntity=c=d.__decorate([(0,y.Entity)("gift")],c)},(e,t,a)=>{var o,r,n,i,d,y,s;Object.defineProperty(t,"__esModule",{value:!0}),t.ProviderTransactionEntity=void 0;const p=a(4),c=a(15),u=a(90),_=a(91),l=a(67),m=a(69),v=a(83),f=a(73);let g=class ProviderTransactionEntity{};t.ProviderTransactionEntity=g,p.__decorate([(0,c.PrimaryGeneratedColumn)(),p.__metadata("design:type",Number)],g.prototype,"id",void 0),p.__decorate([(0,c.CreateDateColumn)({name:"transactionTime"}),p.__metadata("design:type","function"==typeof(o="undefined"!=typeof Date&&Date)?o:Object)],g.prototype,"createdAt",void 0),p.__decorate([(0,c.Column)("enum",{enum:l.TransactionAction}),p.__metadata("design:type","function"==typeof(r=void 0!==l.TransactionAction&&l.TransactionAction)?r:Object)],g.prototype,"action",void 0),p.__decorate([(0,c.Column)("enum",{enum:u.ProviderDeductTransactionType,nullable:!0}),p.__metadata("design:type","function"==typeof(n=void 0!==u.ProviderDeductTransactionType&&u.ProviderDeductTransactionType)?n:Object)],g.prototype,"deductType",void 0),p.__decorate([(0,c.Column)("enum",{enum:_.ProviderRechargeTransactionType,nullable:!0}),p.__metadata("design:type","function"==typeof(i=void 0!==_.ProviderRechargeTransactionType&&_.ProviderRechargeTransactionType)?i:Object)],g.prototype,"rechargeType",void 0),p.__decorate([(0,c.Column)("float",{default:"0.00",precision:10,scale:2}),p.__metadata("design:type",Number)],g.prototype,"amount",void 0),p.__decorate([(0,c.Column)("char",{length:3}),p.__metadata("design:type",String)],g.prototype,"currency",void 0),p.__decorate([(0,c.Column)({nullable:!0,name:"documentNumber"}),p.__metadata("design:type",String)],g.prototype,"refrenceNumber",void 0),p.__decorate([(0,c.Column)({nullable:!0,name:"details"}),p.__metadata("design:type",String)],g.prototype,"description",void 0),p.__decorate([(0,c.ManyToOne)((()=>m.OperatorEntity),(e=>e.providerTransactions)),p.__metadata("design:type","function"==typeof(d=void 0!==m.OperatorEntity&&m.OperatorEntity)?d:Object)],g.prototype,"operator",void 0),p.__decorate([(0,c.Column)({nullable:!0}),p.__metadata("design:type",Number)],g.prototype,"operatorId",void 0),p.__decorate([(0,c.ManyToOne)((()=>f.RequestEntity),(e=>e.providerTransactions),{onDelete:"CASCADE"}),p.__metadata("design:type","function"==typeof(y=void 0!==f.RequestEntity&&f.RequestEntity)?y:Object)],g.prototype,"request",void 0),p.__decorate([(0,c.Column)({nullable:!0}),p.__metadata("design:type",Number)],g.prototype,"requestId",void 0),p.__decorate([(0,c.ManyToOne)((()=>v.PaymentGatewayEntity),(e=>e.adminTransactions),{onDelete:"CASCADE"}),p.__metadata("design:type","function"==typeof(s=void 0!==v.PaymentGatewayEntity&&v.PaymentGatewayEntity)?s:Object)],g.prototype,"paymentGateway",void 0),p.__decorate([(0,c.Column)({nullable:!0}),p.__metadata("design:type",Number)],g.prototype,"paymentGatewayId",void 0),t.ProviderTransactionEntity=g=p.__decorate([(0,c.Entity)("admin_transaction")],g)},(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ProviderDeductTransactionType=void 0;const o=a(10);var r;!function(e){e.Withdraw="Withdraw"}(r||(t.ProviderDeductTransactionType=r={})),(0,o.registerEnumType)(r,{name:"ProviderDeductTransactionType"})},(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ProviderRechargeTransactionType=void 0;const o=a(10);var r;!function(e){e.Commission="Commission"}(r||(t.ProviderRechargeTransactionType=r={})),(0,o.registerEnumType)(r,{name:"ProviderRechargeTransactionType"})},(e,t,a)=>{var o;Object.defineProperty(t,"__esModule",{value:!0}),t.GatewayToUserEntity=void 0;const r=a(4),n=a(15),i=a(83);let d=class GatewayToUserEntity{};t.GatewayToUserEntity=d,r.__decorate([(0,n.PrimaryGeneratedColumn)(),r.__metadata("design:type",Number)],d.prototype,"id",void 0),r.__decorate([(0,n.ManyToOne)((()=>i.PaymentGatewayEntity),(e=>e.userIds)),r.__metadata("design:type","function"==typeof(o=void 0!==i.PaymentGatewayEntity&&i.PaymentGatewayEntity)?o:Object)],d.prototype,"gateway",void 0),r.__decorate([(0,n.Column)(),r.__metadata("design:type",Number)],d.prototype,"gatewayId",void 0),r.__decorate([(0,n.Index)(),(0,n.Column)(),r.__metadata("design:type",String)],d.prototype,"internalUserId",void 0),r.__decorate([(0,n.Column)(),r.__metadata("design:type",String)],d.prototype,"externalReferenceNumber",void 0),t.GatewayToUserEntity=d=r.__decorate([(0,n.Entity)("gateway_to_user")],d)},(e,t,a)=>{var o,r,n,i,d,y;Object.defineProperty(t,"__esModule",{value:!0}),t.SavedPaymentMethodEntity=void 0;const s=a(4),p=a(15),c=a(18),u=a(76),_=a(61),l=a(83),m=a(19),v=a(73);let f=class SavedPaymentMethodEntity{};t.SavedPaymentMethodEntity=f,s.__decorate([(0,p.PrimaryGeneratedColumn)(),s.__metadata("design:type",Number)],f.prototype,"id",void 0),s.__decorate([(0,p.Column)(),s.__metadata("design:type",String)],f.prototype,"title",void 0),s.__decorate([(0,p.Column)({nullable:!0}),s.__metadata("design:type",String)],f.prototype,"lastFour",void 0),s.__decorate([(0,p.Column)({default:!0}),s.__metadata("design:type",Boolean)],f.prototype,"isEnabled",void 0),s.__decorate([(0,p.Column)({default:!1}),s.__metadata("design:type",Boolean)],f.prototype,"isDefault",void 0),s.__decorate([(0,p.Column)("enum",{enum:c.SavedPaymentMethodType}),s.__metadata("design:type","function"==typeof(o=void 0!==c.SavedPaymentMethodType&&c.SavedPaymentMethodType)?o:Object)],f.prototype,"type",void 0),s.__decorate([(0,p.Column)("enum",{enum:m.ProviderBrand,nullable:!0}),s.__metadata("design:type","function"==typeof(r=void 0!==m.ProviderBrand&&m.ProviderBrand)?r:Object)],f.prototype,"providerBrand",void 0),s.__decorate([(0,p.Column)({nullable:!0}),s.__metadata("design:type","function"==typeof(n="undefined"!=typeof Date&&Date)?n:Object)],f.prototype,"expiryDate",void 0),s.__decorate([(0,p.Column)({nullable:!0}),s.__metadata("design:type",String)],f.prototype,"holderName",void 0),s.__decorate([(0,p.ManyToOne)((()=>u.RiderEntity),(e=>e.savedPaymentMethods)),s.__metadata("design:type","function"==typeof(i=void 0!==u.RiderEntity&&u.RiderEntity)?i:Object)],f.prototype,"rider",void 0),s.__decorate([(0,p.Column)({nullable:!0}),s.__metadata("design:type",Number)],f.prototype,"riderId",void 0),s.__decorate([(0,p.ManyToOne)((()=>_.DriverEntity),(e=>e.savedPaymentMethods)),s.__metadata("design:type","function"==typeof(d=void 0!==_.DriverEntity&&_.DriverEntity)?d:Object)],f.prototype,"driver",void 0),s.__decorate([(0,p.Column)({nullable:!0}),s.__metadata("design:type",Number)],f.prototype,"driverId",void 0),s.__decorate([(0,p.Column)(),s.__metadata("design:type",String)],f.prototype,"token",void 0),s.__decorate([(0,p.ManyToOne)((()=>l.PaymentGatewayEntity),(e=>e.savedPaymentMethods)),s.__metadata("design:type","function"==typeof(y=void 0!==l.PaymentGatewayEntity&&l.PaymentGatewayEntity)?y:Object)],f.prototype,"paymentGateway",void 0),s.__decorate([(0,p.Column)(),s.__metadata("design:type",Number)],f.prototype,"paymentGatewayId",void 0),s.__decorate([(0,p.OneToMany)((()=>v.RequestEntity),(e=>e.savedPaymentMethod)),s.__metadata("design:type",Array)],f.prototype,"orders",void 0),t.SavedPaymentMethodEntity=f=s.__decorate([(0,p.Entity)("saved_payment_method")],f)},(e,t,a)=>{var o,r,n,i,d,y;Object.defineProperty(t,"__esModule",{value:!0}),t.ServiceEntity=void 0;const s=a(4),p=a(15),c=a(95),u=a(96),_=a(75),l=a(61),m=a(97),v=a(98),f=a(80),g=a(73),b=a(99),S=a(101),P=a(102),O=a(105),M=a(111),E=a(112);let C=class ServiceEntity{};t.ServiceEntity=C,s.__decorate([(0,p.PrimaryGeneratedColumn)(),s.__metadata("design:type",Number)],C.prototype,"id",void 0),s.__decorate([(0,p.ManyToOne)((()=>S.ServiceCategoryEntity),(e=>e.services),{onDelete:"CASCADE"}),s.__metadata("design:type","function"==typeof(o=void 0!==S.ServiceCategoryEntity&&S.ServiceCategoryEntity)?o:Object)],C.prototype,"category",void 0),s.__decorate([(0,p.Column)(),s.__metadata("design:type",Number)],C.prototype,"categoryId",void 0),s.__decorate([(0,p.Column)({name:"title"}),s.__metadata("design:type",String)],C.prototype,"name",void 0),s.__decorate([(0,p.Column)({nullable:!0}),s.__metadata("design:type",String)],C.prototype,"description",void 0),s.__decorate([(0,p.Column)("smallint",{nullable:!0}),s.__metadata("design:type",Number)],C.prototype,"personCapacity",void 0),s.__decorate([(0,p.Column)("float",{default:"0.00",precision:12,scale:2}),s.__metadata("design:type",Number)],C.prototype,"baseFare",void 0),s.__decorate([(0,p.Column)("float",{default:"0.00",precision:12,scale:2}),s.__metadata("design:type",Number)],C.prototype,"perHundredMeters",void 0),s.__decorate([(0,p.Column)("float",{default:"0.00",precision:12,scale:2}),s.__metadata("design:type",Number)],C.prototype,"perMinuteDrive",void 0),s.__decorate([(0,p.Column)("float",{default:"0.00",precision:12,scale:2}),s.__metadata("design:type",Number)],C.prototype,"perMinuteWait",void 0),s.__decorate([(0,p.Column)("float",{default:"0.00",precision:10,scale:2}),s.__metadata("design:type",Number)],C.prototype,"minimumFee",void 0),s.__decorate([(0,p.Column)("int",{default:1e4}),s.__metadata("design:type",Number)],C.prototype,"searchRadius",void 0),s.__decorate([(0,p.Column)({type:"enum",enum:v.ServicePaymentMethod,default:v.ServicePaymentMethod.CashCredit}),s.__metadata("design:type","function"==typeof(r=void 0!==v.ServicePaymentMethod&&v.ServicePaymentMethod)?r:Object)],C.prototype,"paymentMethod",void 0),s.__decorate([(0,p.Column)("enum",{enum:m.ServiceDistanceFeeMode,default:m.ServiceDistanceFeeMode.PickupToDestination}),s.__metadata("design:type","function"==typeof(n=void 0!==m.ServiceDistanceFeeMode&&m.ServiceDistanceFeeMode)?n:Object)],C.prototype,"distanceFeeMode",void 0),s.__decorate([(0,p.Column)("time",{default:"00:00"}),s.__metadata("design:type",String)],C.prototype,"availableTimeFrom",void 0),s.__decorate([(0,p.Column)("time",{default:"23:59"}),s.__metadata("design:type",String)],C.prototype,"availableTimeTo",void 0),s.__decorate([(0,p.Column)("int",{default:0,name:"maxDestinationDistance"}),s.__metadata("design:type",Number)],C.prototype,"maximumDestinationDistance",void 0),s.__decorate([(0,p.Column)("tinyint",{default:0}),s.__metadata("design:type",Number)],C.prototype,"prepayPercent",void 0),s.__decorate([(0,p.Column)({default:!1}),s.__metadata("design:type",Boolean)],C.prototype,"twoWayAvailable",void 0),s.__decorate([(0,p.Column)("float",{default:"0.00",precision:10,scale:2}),s.__metadata("design:type",Number)],C.prototype,"cancellationTotalFee",void 0),s.__decorate([(0,p.Column)("float",{default:"0.00",precision:10,scale:2}),s.__metadata("design:type",Number)],C.prototype,"cancellationDriverShare",void 0),s.__decorate([(0,p.Column)("tinyint",{default:0}),s.__metadata("design:type",Number)],C.prototype,"providerSharePercent",void 0),s.__decorate([(0,p.Column)("float",{default:"0.00",precision:10,scale:2}),s.__metadata("design:type",Number)],C.prototype,"providerShareFlat",void 0),s.__decorate([(0,p.Column)("float",{nullable:!0,precision:10,scale:2}),s.__metadata("design:type",Number)],C.prototype,"roundingFactor",void 0),s.__decorate([(0,p.OneToOne)((()=>f.MediaEntity),(e=>e.service)),(0,p.JoinColumn)(),s.__metadata("design:type","function"==typeof(i=void 0!==f.MediaEntity&&f.MediaEntity)?i:Object)],C.prototype,"media",void 0),s.__decorate([(0,p.Column)(),s.__metadata("design:type",Number)],C.prototype,"mediaId",void 0),s.__decorate([(0,p.Column)("simple-array",{nullable:!0,transformer:new u.TimeMultiplierTransformer}),s.__metadata("design:type",Array)],C.prototype,"timeMultipliers",void 0),s.__decorate([(0,p.Column)("simple-array",{nullable:!0,transformer:new c.DistanceMultiplierTransformer}),s.__metadata("design:type",Array)],C.prototype,"distanceMultipliers",void 0),s.__decorate([(0,p.Column)("simple-array",{nullable:!0,transformer:new E.DateRangeMultiplierTransformer}),s.__metadata("design:type",Array)],C.prototype,"dateRangeMultipliers",void 0),s.__decorate([(0,p.Column)("simple-array",{nullable:!0,transformer:new M.WeekdayMultiplierTransformer}),s.__metadata("design:type",Array)],C.prototype,"weekdayMultipliers",void 0),s.__decorate([(0,p.DeleteDateColumn)(),s.__metadata("design:type","function"==typeof(d="undefined"!=typeof Date&&Date)?d:Object)],C.prototype,"deletedAt",void 0),s.__decorate([(0,p.Column)("float",{default:1}),s.__metadata("design:type",Number)],C.prototype,"touristMultiplier",void 0),s.__decorate([(0,p.ManyToMany)((()=>l.DriverEntity),(e=>e.enabledServices)),s.__metadata("design:type",Array)],C.prototype,"drivers",void 0),s.__decorate([(0,p.ManyToMany)((()=>_.CouponEntity),(e=>e.allowedServices)),s.__metadata("design:type",Array)],C.prototype,"allowedCoupons",void 0),s.__decorate([(0,p.ManyToMany)((()=>b.RegionEntity),(e=>e.services)),(0,p.JoinTable)(),s.__metadata("design:type",Array)],C.prototype,"regions",void 0),s.__decorate([(0,p.OneToMany)((()=>g.RequestEntity),(e=>e.service)),s.__metadata("design:type",Array)],C.prototype,"requests",void 0),s.__decorate([(0,p.ManyToMany)((()=>P.ServiceOptionEntity),(e=>e.services)),(0,p.JoinTable)(),s.__metadata("design:type",Array)],C.prototype,"options",void 0),s.__decorate([(0,p.ManyToMany)((()=>O.ZonePriceEntity),(e=>e.fleets)),s.__metadata("design:type","function"==typeof(y=void 0!==O.ZonePriceEntity&&O.ZonePriceEntity)?y:Object)],C.prototype,"zonePrices",void 0),t.ServiceEntity=C=s.__decorate([(0,p.Entity)("service")],C)},(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.DistanceMultiplierTransformer=void 0;t.DistanceMultiplierTransformer=class DistanceMultiplierTransformer{to(e){return null==e?[]:e.map((e=>`${e.distanceFrom}-${e.distanceTo}|${e.multiply}`))}from(e){return null==e?[]:e.map((e=>({distanceFrom:parseInt(e.split("|")[0].split("-")[0]),distanceTo:parseInt(e.split("|")[0].split("-")[1]),multiply:parseFloat(e.split("|")[1])})))}}},(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.TimeMultiplierTransformer=void 0;t.TimeMultiplierTransformer=class TimeMultiplierTransformer{to(e){return null==e?[]:e.map((e=>`${e.startTime}-${e.endTime}|${e.multiply}`))}from(e){return null==e?[]:e.map((e=>({startTime:e.split("|")[0].split("-")[0],endTime:e.split("|")[0].split("-")[1],multiply:parseFloat(e.split("|")[1])})))}}},(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ServiceDistanceFeeMode=void 0;const o=a(10);var r;!function(e){e.None="None",e.PickupToDestination="PickupToDestination",e.Radial="Radial"}(r||(t.ServiceDistanceFeeMode=r={})),(0,o.registerEnumType)(r,{name:"ServiceDistanceFeeMode"})},(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ServicePaymentMethod=void 0;const o=a(10);var r;!function(e){e.CashCredit="CashCredit",e.OnlyCredit="OnlyCredit",e.OnlyCash="OnlyCash"}(r||(t.ServicePaymentMethod=r={})),(0,o.registerEnumType)(r,{name:"ServicePaymentMethod"})},(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.RegionEntity=void 0;const o=a(4),r=a(15),n=a(100),i=a(94);let d=class RegionEntity{};t.RegionEntity=d,o.__decorate([(0,r.PrimaryGeneratedColumn)(),o.__metadata("design:type",Number)],d.prototype,"id",void 0),o.__decorate([(0,r.Column)(),o.__metadata("design:type",String)],d.prototype,"name",void 0),o.__decorate([(0,r.Column)("char",{length:3}),o.__metadata("design:type",String)],d.prototype,"currency",void 0),o.__decorate([(0,r.Column)({default:!0}),o.__metadata("design:type",Boolean)],d.prototype,"enabled",void 0),o.__decorate([(0,r.Column)("polygon",{transformer:new n.PolygonTransformer}),o.__metadata("design:type",Array)],d.prototype,"location",void 0),o.__decorate([(0,r.ManyToMany)((()=>i.ServiceEntity),(e=>e.regions)),o.__metadata("design:type",Array)],d.prototype,"services",void 0),t.RegionEntity=d=o.__decorate([(0,r.Entity)("region")],d)},(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.PolygonTransformer=void 0;t.PolygonTransformer=class PolygonTransformer{to(e){if(null==e)return null;return`POLYGON((${e.map((e=>e.map((e=>`${e.lng} ${e.lat}`)).join(","))).join("),(")}))`}from(e){return null==e||null==e?[]:e.substring(8,e.length-1).split("),(").map((e=>e.substring(1,e.length-1).split(",").map((e=>{const t=e.split(" ");return{lng:parseFloat(t[0]),lat:parseFloat(t[1])}}))))}}},(e,t,a)=>{var o;Object.defineProperty(t,"__esModule",{value:!0}),t.ServiceCategoryEntity=void 0;const r=a(4),n=a(15),i=a(94);let d=class ServiceCategoryEntity{};t.ServiceCategoryEntity=d,r.__decorate([(0,n.PrimaryGeneratedColumn)(),r.__metadata("design:type",Number)],d.prototype,"id",void 0),r.__decorate([(0,n.Column)({name:"title"}),r.__metadata("design:type",String)],d.prototype,"name",void 0),r.__decorate([(0,n.OneToMany)((()=>i.ServiceEntity),(e=>e.category)),r.__metadata("design:type",Array)],d.prototype,"services",void 0),r.__decorate([(0,n.DeleteDateColumn)(),r.__metadata("design:type","function"==typeof(o="undefined"!=typeof Date&&Date)?o:Object)],d.prototype,"deletedAt",void 0),t.ServiceCategoryEntity=d=r.__decorate([(0,n.Entity)("service_category")],d)},(e,t,a)=>{var o,r,n;Object.defineProperty(t,"__esModule",{value:!0}),t.ServiceOptionEntity=void 0;const i=a(4),d=a(15),y=a(103),s=a(104),p=a(73),c=a(94);let u=class ServiceOptionEntity{};t.ServiceOptionEntity=u,i.__decorate([(0,d.PrimaryGeneratedColumn)(),i.__metadata("design:type",Number)],u.prototype,"id",void 0),i.__decorate([(0,d.Column)(),i.__metadata("design:type",String)],u.prototype,"name",void 0),i.__decorate([(0,d.Column)({nullable:!0}),i.__metadata("design:type",String)],u.prototype,"description",void 0),i.__decorate([(0,d.Column)("enum",{enum:s.ServiceOptionType}),i.__metadata("design:type","function"==typeof(o=void 0!==s.ServiceOptionType&&s.ServiceOptionType)?o:Object)],u.prototype,"type",void 0),i.__decorate([(0,d.Column)("float",{precision:12,scale:2,nullable:!0}),i.__metadata("design:type",Number)],u.prototype,"additionalFee",void 0),i.__decorate([(0,d.Column)("enum",{enum:y.ServiceOptionIcon}),i.__metadata("design:type","function"==typeof(r=void 0!==y.ServiceOptionIcon&&y.ServiceOptionIcon)?r:Object)],u.prototype,"icon",void 0),i.__decorate([(0,d.ManyToMany)((()=>c.ServiceEntity),(e=>e.options)),i.__metadata("design:type","function"==typeof(n=void 0!==c.ServiceEntity&&c.ServiceEntity)?n:Object)],u.prototype,"services",void 0),i.__decorate([(0,d.ManyToMany)((()=>p.RequestEntity),(e=>e.options)),i.__metadata("design:type",Array)],u.prototype,"requests",void 0),t.ServiceOptionEntity=u=i.__decorate([(0,d.Entity)("service_option")],u)},(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ServiceOptionIcon=void 0;const o=a(10);var r;!function(e){e.Pet="Pet",e.TwoWay="TwoWay",e.Luggage="Luggage",e.PackageDelivery="PackageDelivery",e.Shopping="Shopping",e.Custom1="Custom1",e.Custom2="Custom2",e.Custom3="Custom3",e.Custom4="Custom4",e.Custom5="Custom5"}(r||(t.ServiceOptionIcon=r={})),(0,o.registerEnumType)(r,{name:"ServiceOptionIcon"})},(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ServiceOptionType=void 0;const o=a(10);var r;!function(e){e.Free="Free",e.Paid="Paid",e.TwoWay="TwoWay"}(r||(t.ServiceOptionType=r={})),(0,o.registerEnumType)(r,{name:"ServiceOptionType"})},(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ZonePriceEntity=void 0;const o=a(4),r=a(15),n=a(100),i=a(96),d=a(106),y=a(94);let s=class ZonePriceEntity{};t.ZonePriceEntity=s,o.__decorate([(0,r.PrimaryGeneratedColumn)(),o.__metadata("design:type",Number)],s.prototype,"id",void 0),o.__decorate([(0,r.Column)(),o.__metadata("design:type",String)],s.prototype,"name",void 0),o.__decorate([(0,r.Column)("polygon",{transformer:new n.PolygonTransformer}),o.__metadata("design:type",Array)],s.prototype,"from",void 0),o.__decorate([(0,r.Column)("polygon",{transformer:new n.PolygonTransformer}),o.__metadata("design:type",Array)],s.prototype,"to",void 0),o.__decorate([(0,r.Column)("float",{default:"0.00",precision:10,scale:2}),o.__metadata("design:type",Number)],s.prototype,"cost",void 0),o.__decorate([(0,r.Column)("simple-array",{nullable:!0,transformer:new i.TimeMultiplierTransformer}),o.__metadata("design:type",Array)],s.prototype,"timeMultipliers",void 0),o.__decorate([(0,r.ManyToMany)((()=>d.FleetEntity),(e=>e.zonePrices)),(0,r.JoinTable)(),o.__metadata("design:type",Array)],s.prototype,"fleets",void 0),o.__decorate([(0,r.ManyToMany)((()=>y.ServiceEntity),(e=>e.zonePrices)),(0,r.JoinTable)(),o.__metadata("design:type",Array)],s.prototype,"services",void 0),t.ZonePriceEntity=s=o.__decorate([(0,r.Entity)("zone_price")],s)},(e,t,a)=>{var o;Object.defineProperty(t,"__esModule",{value:!0}),t.FleetEntity=void 0;const r=a(4),n=a(15),i=a(100),d=a(61),y=a(107),s=a(109),p=a(110),c=a(69),u=a(73),_=a(105);let l=class FleetEntity{};t.FleetEntity=l,r.__decorate([(0,n.PrimaryGeneratedColumn)(),r.__metadata("design:type",Number)],l.prototype,"id",void 0),r.__decorate([(0,n.Column)(),r.__metadata("design:type",String)],l.prototype,"name",void 0),r.__decorate([(0,n.Column)("bigint"),r.__metadata("design:type",String)],l.prototype,"phoneNumber",void 0),r.__decorate([(0,n.Column)(),r.__metadata("design:type",String)],l.prototype,"accountNumber",void 0),r.__decorate([(0,n.Column)("bigint"),r.__metadata("design:type",String)],l.prototype,"mobileNumber",void 0),r.__decorate([(0,n.Column)("tinyint",{default:0}),r.__metadata("design:type",Number)],l.prototype,"commissionSharePercent",void 0),r.__decorate([(0,n.Column)("float",{default:0}),r.__metadata("design:type",Number)],l.prototype,"commissionShareFlat",void 0),r.__decorate([(0,n.Column)("varchar",{nullable:!0}),r.__metadata("design:type",String)],l.prototype,"address",void 0),r.__decorate([(0,n.Column)({nullable:!0}),r.__metadata("design:type",String)],l.prototype,"userName",void 0),r.__decorate([(0,n.Column)({nullable:!0}),r.__metadata("design:type",String)],l.prototype,"password",void 0),r.__decorate([(0,n.Column)("float",{precision:10,scale:2,nullable:!0}),r.__metadata("design:type",Number)],l.prototype,"feeMultiplier",void 0),r.__decorate([(0,n.Column)("polygon",{transformer:new i.PolygonTransformer,nullable:!0}),r.__metadata("design:type",Array)],l.prototype,"exclusivityAreas",void 0),r.__decorate([(0,n.OneToMany)((()=>d.DriverEntity),(e=>e.fleet)),r.__metadata("design:type",Array)],l.prototype,"drivers",void 0),r.__decorate([(0,n.OneToMany)((()=>p.FleetWalletEntity),(e=>e.fleet)),r.__metadata("design:type",Array)],l.prototype,"wallet",void 0),r.__decorate([(0,n.OneToMany)((()=>s.FleetTransactionEntity),(e=>e.fleet),{onDelete:"CASCADE",onUpdate:"RESTRICT"}),r.__metadata("design:type",Array)],l.prototype,"transactions",void 0),r.__decorate([(0,n.OneToMany)((()=>c.OperatorEntity),(e=>e.fleet)),r.__metadata("design:type",Array)],l.prototype,"operators",void 0),r.__decorate([(0,n.ManyToMany)((()=>_.ZonePriceEntity),(e=>e.fleets)),r.__metadata("design:type","function"==typeof(o=void 0!==_.ZonePriceEntity&&_.ZonePriceEntity)?o:Object)],l.prototype,"zonePrices",void 0),r.__decorate([(0,n.OneToMany)((()=>y.FleetDeviceEntity),(e=>e.fleet)),r.__metadata("design:type",Array)],l.prototype,"devices",void 0),r.__decorate([(0,n.OneToMany)((()=>u.RequestEntity),(e=>e.fleet)),r.__metadata("design:type",Array)],l.prototype,"requests",void 0),t.FleetEntity=l=r.__decorate([(0,n.Entity)("fleet")],l)},(e,t,a)=>{var o,r,n;Object.defineProperty(t,"__esModule",{value:!0}),t.FleetDeviceEntity=void 0;const i=a(4),d=a(15),y=a(108),s=a(106);let p=class FleetDeviceEntity{};t.FleetDeviceEntity=p,i.__decorate([(0,d.PrimaryGeneratedColumn)(),i.__metadata("design:type",Number)],p.prototype,"id",void 0),i.__decorate([(0,d.Column)("enum",{enum:y.DevicePlatform,nullable:!0}),i.__metadata("design:type","function"==typeof(o=void 0!==y.DevicePlatform&&y.DevicePlatform)?o:Object)],p.prototype,"devicePlatform",void 0),i.__decorate([(0,d.Column)(),i.__metadata("design:type",String)],p.prototype,"deviceName",void 0),i.__decorate([(0,d.Column)(),i.__metadata("design:type",String)],p.prototype,"ipAddress",void 0),i.__decorate([(0,d.Column)(),i.__metadata("design:type",String)],p.prototype,"jwt",void 0),i.__decorate([(0,d.Column)({default:()=>"CURRENT_TIMESTAMP"}),i.__metadata("design:type","function"==typeof(r="undefined"!=typeof Date&&Date)?r:Object)],p.prototype,"lastSeenAt",void 0),i.__decorate([(0,d.Column)({default:!1}),i.__metadata("design:type",Boolean)],p.prototype,"isTerminated",void 0),i.__decorate([(0,d.ManyToOne)((()=>s.FleetEntity),(e=>e.devices)),i.__metadata("design:type","function"==typeof(n=void 0!==s.FleetEntity&&s.FleetEntity)?n:Object)],p.prototype,"fleet",void 0),i.__decorate([(0,d.Column)(),i.__metadata("design:type",Number)],p.prototype,"fleetId",void 0),t.FleetDeviceEntity=p=i.__decorate([(0,d.Entity)("fleet_device")],p)},(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.DevicePlatform=void 0;const o=a(10);var r;!function(e){e.Android="ANDROID",e.Ios="IOS",e.Web="WEB",e.MacOS="MACOS",e.Windows="WINDOWS",e.Linux="LINUX"}(r||(t.DevicePlatform=r={})),(0,o.registerEnumType)(r,{name:"DevicePlatform"})},(e,t,a)=>{var o,r,n,i,d,y,s,p;Object.defineProperty(t,"__esModule",{value:!0}),t.FleetTransactionEntity=void 0;const c=a(4),u=a(15),_=a(61),l=a(90),m=a(91),v=a(67),f=a(106),g=a(69),b=a(73);let S=class FleetTransactionEntity{};t.FleetTransactionEntity=S,c.__decorate([(0,u.PrimaryGeneratedColumn)(),c.__metadata("design:type",Number)],S.prototype,"id",void 0),c.__decorate([(0,u.CreateDateColumn)({name:"transactionTime"}),c.__metadata("design:type","function"==typeof(o="undefined"!=typeof Date&&Date)?o:Object)],S.prototype,"transactionTimestamp",void 0),c.__decorate([(0,u.Column)("enum",{enum:v.TransactionAction}),c.__metadata("design:type","function"==typeof(r=void 0!==v.TransactionAction&&v.TransactionAction)?r:Object)],S.prototype,"action",void 0),c.__decorate([(0,u.Column)("enum",{enum:l.ProviderDeductTransactionType,nullable:!0}),c.__metadata("design:type","function"==typeof(n=void 0!==l.ProviderDeductTransactionType&&l.ProviderDeductTransactionType)?n:Object)],S.prototype,"deductType",void 0),c.__decorate([(0,u.Column)("enum",{enum:m.ProviderRechargeTransactionType,nullable:!0}),c.__metadata("design:type","function"==typeof(i=void 0!==m.ProviderRechargeTransactionType&&m.ProviderRechargeTransactionType)?i:Object)],S.prototype,"rechargeType",void 0),c.__decorate([(0,u.Column)("float",{default:"0.00",precision:10,scale:2}),c.__metadata("design:type",Number)],S.prototype,"amount",void 0),c.__decorate([(0,u.Column)("char",{length:"3"}),c.__metadata("design:type",String)],S.prototype,"currency",void 0),c.__decorate([(0,u.Column)({nullable:!0,name:"documentNumber"}),c.__metadata("design:type",String)],S.prototype,"refrenceNumber",void 0),c.__decorate([(0,u.Column)({nullable:!0,name:"details"}),c.__metadata("design:type",String)],S.prototype,"description",void 0),c.__decorate([(0,u.ManyToOne)((()=>b.RequestEntity),(e=>e.fleetTransactions)),c.__metadata("design:type","function"==typeof(d=void 0!==b.RequestEntity&&b.RequestEntity)?d:Object)],S.prototype,"request",void 0),c.__decorate([(0,u.Column)({nullable:!0}),c.__metadata("design:type",Number)],S.prototype,"requestId",void 0),c.__decorate([(0,u.ManyToOne)((()=>_.DriverEntity),(e=>e.fleetTransactions)),c.__metadata("design:type","function"==typeof(y=void 0!==_.DriverEntity&&_.DriverEntity)?y:Object)],S.prototype,"driver",void 0),c.__decorate([(0,u.Column)({nullable:!0}),c.__metadata("design:type",Number)],S.prototype,"driverId",void 0),c.__decorate([(0,u.ManyToOne)((()=>f.FleetEntity),(e=>e.transactions)),c.__metadata("design:type","function"==typeof(s=void 0!==f.FleetEntity&&f.FleetEntity)?s:Object)],S.prototype,"fleet",void 0),c.__decorate([(0,u.Column)(),c.__metadata("design:type",Number)],S.prototype,"fleetId",void 0),c.__decorate([(0,u.ManyToOne)((()=>g.OperatorEntity),(e=>e.fleetTransactions)),c.__metadata("design:type","function"==typeof(p=void 0!==g.OperatorEntity&&g.OperatorEntity)?p:Object)],S.prototype,"operator",void 0),c.__decorate([(0,u.Column)({nullable:!0,name:"operatorId"}),c.__metadata("design:type",Number)],S.prototype,"operatorId",void 0),t.FleetTransactionEntity=S=c.__decorate([(0,u.Entity)("fleet_transaction")],S)},(e,t,a)=>{var o;Object.defineProperty(t,"__esModule",{value:!0}),t.FleetWalletEntity=void 0;const r=a(4),n=a(15),i=a(106);let d=class FleetWalletEntity{};t.FleetWalletEntity=d,r.__decorate([(0,n.PrimaryGeneratedColumn)(),r.__metadata("design:type",Number)],d.prototype,"id",void 0),r.__decorate([(0,n.Column)("float",{default:0,name:"amount"}),r.__metadata("design:type",Number)],d.prototype,"balance",void 0),r.__decorate([(0,n.Column)(),r.__metadata("design:type",String)],d.prototype,"currency",void 0),r.__decorate([(0,n.ManyToOne)((()=>i.FleetEntity),(e=>e.wallet)),r.__metadata("design:type","function"==typeof(o=void 0!==i.FleetEntity&&i.FleetEntity)?o:Object)],d.prototype,"fleet",void 0),r.__decorate([(0,n.Column)(),r.__metadata("design:type",Number)],d.prototype,"fleetId",void 0),t.FleetWalletEntity=d=r.__decorate([(0,n.Entity)("fleet_wallet")],d)},(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.WeekdayMultiplierTransformer=void 0;t.WeekdayMultiplierTransformer=class WeekdayMultiplierTransformer{to(e){return null==e?[]:e.map((e=>`${e.weekday}|${e.multiply}`))}from(e){return null==e?[]:e.map((e=>({weekday:e.split("|")[0],multiply:parseFloat(e.split("|")[1])})))}}},(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.DateRangeMultiplierTransformer=void 0;t.DateRangeMultiplierTransformer=class DateRangeMultiplierTransformer{to(e){return null==e?[]:e.map((e=>`${e.startDate}-${e.endDate}|${e.multiply}`))}from(e){return null==e?[]:e.map((e=>({startDate:parseInt(e.split("|")[0].split("-")[0]),endDate:parseInt(e.split("|")[0].split("-")[1]),multiply:parseFloat(e.split("|")[1])})))}}},(e,t,a)=>{var o,r,n;Object.defineProperty(t,"__esModule",{value:!0}),t.PayoutMethodEntity=void 0;const i=a(4),d=a(15),y=a(80),s=a(54),p=a(60),c=a(114),u=a(64);let _=class PayoutMethodEntity{};t.PayoutMethodEntity=_,i.__decorate([(0,d.PrimaryGeneratedColumn)(),i.__metadata("design:type",Number)],_.prototype,"id",void 0),i.__decorate([(0,d.Column)({default:!0}),i.__metadata("design:type",Boolean)],_.prototype,"enabled",void 0),i.__decorate([(0,d.Column)(),i.__metadata("design:type",String)],_.prototype,"name",void 0),i.__decorate([(0,d.Column)(),i.__metadata("design:type",String)],_.prototype,"currency",void 0),i.__decorate([(0,d.Column)({nullable:!0}),i.__metadata("design:type",String)],_.prototype,"description",void 0),i.__decorate([(0,d.Column)("enum",{enum:s.PayoutMethodType}),i.__metadata("design:type","function"==typeof(o=void 0!==s.PayoutMethodType&&s.PayoutMethodType)?o:Object)],_.prototype,"type",void 0),i.__decorate([(0,d.Column)({nullable:!0,type:"text"}),i.__metadata("design:type",String)],_.prototype,"publicKey",void 0),i.__decorate([(0,d.Column)({nullable:!0,type:"text"}),i.__metadata("design:type",String)],_.prototype,"privateKey",void 0),i.__decorate([(0,d.Column)({nullable:!0,type:"text"}),i.__metadata("design:type",String)],_.prototype,"saltKey",void 0),i.__decorate([(0,d.Column)({nullable:!0,type:"text"}),i.__metadata("design:type",String)],_.prototype,"merchantId",void 0),i.__decorate([(0,d.DeleteDateColumn)(),i.__metadata("design:type","function"==typeof(r="undefined"!=typeof Date&&Date)?r:Object)],_.prototype,"deletedAt",void 0),i.__decorate([(0,d.OneToOne)((()=>y.MediaEntity),(e=>e.payoutMethod),{nullable:!0}),(0,d.JoinColumn)(),i.__metadata("design:type","function"==typeof(n=void 0!==y.MediaEntity&&y.MediaEntity)?n:Object)],_.prototype,"media",void 0),i.__decorate([(0,d.Column)({nullable:!0}),i.__metadata("design:type",Number)],_.prototype,"mediaId",void 0),i.__decorate([(0,d.OneToMany)((()=>p.PayoutAccountEntity),(e=>e.payoutMethod)),i.__metadata("design:type",Array)],_.prototype,"payoutAccounts",void 0),i.__decorate([(0,d.ManyToMany)((()=>c.PayoutSessionEntity),(e=>e.payoutMethods)),i.__metadata("design:type",Array)],_.prototype,"payoutSessions",void 0),i.__decorate([(0,d.OneToMany)((()=>u.DriverTransactionEntity),(e=>e.payoutMethod)),i.__metadata("design:type",Array)],_.prototype,"driverTransactions",void 0),t.PayoutMethodEntity=_=i.__decorate([(0,d.Entity)("payout_method")],_)},(e,t,a)=>{var o,r,n,i;Object.defineProperty(t,"__esModule",{value:!0}),t.PayoutSessionEntity=void 0;const d=a(4),y=a(15),s=a(64),p=a(115),c=a(69),u=a(113);let _=class PayoutSessionEntity{};t.PayoutSessionEntity=_,d.__decorate([(0,y.PrimaryGeneratedColumn)(),d.__metadata("design:type",Number)],_.prototype,"id",void 0),d.__decorate([(0,y.CreateDateColumn)(),d.__metadata("design:type","function"==typeof(o="undefined"!=typeof Date&&Date)?o:Object)],_.prototype,"createdAt",void 0),d.__decorate([(0,y.Column)({nullable:!0}),d.__metadata("design:type","function"==typeof(r="undefined"!=typeof Date&&Date)?r:Object)],_.prototype,"processedAt",void 0),d.__decorate([(0,y.Column)({nullable:!0}),d.__metadata("design:type",String)],_.prototype,"description",void 0),d.__decorate([(0,y.Column)({default:p.PayoutSessionStatus.PENDING,type:"enum",enum:p.PayoutSessionStatus}),d.__metadata("design:type","function"==typeof(n=void 0!==p.PayoutSessionStatus&&p.PayoutSessionStatus)?n:Object)],_.prototype,"status",void 0),d.__decorate([(0,y.ManyToMany)((()=>u.PayoutMethodEntity),(e=>e.payoutSessions),{onDelete:"CASCADE"}),(0,y.JoinTable)(),d.__metadata("design:type",Array)],_.prototype,"payoutMethods",void 0),d.__decorate([(0,y.OneToMany)((()=>s.DriverTransactionEntity),(e=>e.payoutSession)),d.__metadata("design:type",Array)],_.prototype,"driverTransactions",void 0),d.__decorate([(0,y.Column)("float",{default:"0.00",precision:10,scale:2}),d.__metadata("design:type",Number)],_.prototype,"totalAmount",void 0),d.__decorate([(0,y.Column)(),d.__metadata("design:type",String)],_.prototype,"currency",void 0),d.__decorate([(0,y.ManyToOne)((()=>c.OperatorEntity),(e=>e.payoutSessionsCreated)),d.__metadata("design:type","function"==typeof(i=void 0!==c.OperatorEntity&&c.OperatorEntity)?i:Object)],_.prototype,"createdByOperator",void 0),d.__decorate([(0,y.Column)(),d.__metadata("design:type",Number)],_.prototype,"createdByOperatorId",void 0),t.PayoutSessionEntity=_=d.__decorate([(0,y.Entity)("payout_session")],_)},(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.PayoutSessionStatus=void 0;const o=a(10);var r;!function(e){e.PENDING="pending",e.PAID="paid",e.FAILED="failed",e.CANCELLED="cancelled"}(r||(t.PayoutSessionStatus=r={})),(0,o.registerEnumType)(r,{name:"PayoutSessionStatus",description:void 0})},(e,t,a)=>{var o,r,n;Object.defineProperty(t,"__esModule",{value:!0}),t.RiderAddressEntity=void 0;const i=a(4),d=a(15),y=a(117),s=a(118),p=a(119),c=a(76);let u=class RiderAddressEntity{};t.RiderAddressEntity=u,i.__decorate([(0,d.PrimaryGeneratedColumn)(),i.__metadata("design:type",Number)],u.prototype,"id",void 0),i.__decorate([(0,d.Column)("enum",{enum:p.RiderAddressType,default:p.RiderAddressType.Other}),i.__metadata("design:type","function"==typeof(o=void 0!==p.RiderAddressType&&p.RiderAddressType)?o:Object)],u.prototype,"type",void 0),i.__decorate([(0,d.Column)(),i.__metadata("design:type",String)],u.prototype,"title",void 0),i.__decorate([(0,d.Column)({nullable:!0,name:"address"}),i.__metadata("design:type",String)],u.prototype,"details",void 0),i.__decorate([(0,d.Column)("point",{transformer:new s.PointTransformer}),i.__metadata("design:type","function"==typeof(r=void 0!==y.Point&&y.Point)?r:Object)],u.prototype,"location",void 0),i.__decorate([(0,d.ManyToOne)((()=>c.RiderEntity),(e=>e.addresses)),i.__metadata("design:type","function"==typeof(n=void 0!==c.RiderEntity&&c.RiderEntity)?n:Object)],u.prototype,"rider",void 0),i.__decorate([(0,d.Column)(),i.__metadata("design:type",Number)],u.prototype,"riderId",void 0),t.RiderAddressEntity=u=i.__decorate([(0,d.Entity)("rider_address")],u)},(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Point=void 0;const o=a(4),r=a(10);let n=class Point{};t.Point=n,o.__decorate([(0,r.Field)((()=>r.Float)),o.__metadata("design:type",Number)],n.prototype,"lat",void 0),o.__decorate([(0,r.Field)((()=>r.Float)),o.__metadata("design:type",Number)],n.prototype,"lng",void 0),o.__decorate([(0,r.Field)((()=>r.Int),{nullable:!0}),o.__metadata("design:type",Number)],n.prototype,"heading",void 0),t.Point=n=o.__decorate([(0,r.ObjectType)(),(0,r.InputType)("PointInput")],n)},(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.PointTransformer=void 0;t.PointTransformer=class PointTransformer{to(e){return null==e?null:`POINT(${e.lng} ${e.lat})`}from(e){if(null==e||""==e)return null;const t=e.substring(6,e.length-1).split(" ");return{lng:parseFloat(t[0]),lat:parseFloat(t[1])}}}},(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.RiderAddressType=void 0;const o=a(10);var r;!function(e){e.Home="Home",e.Work="Work",e.Partner="Partner",e.Gym="Gym",e.Parent="Parent",e.Cafe="Cafe",e.Park="Park",e.Other="Other"}(r||(t.RiderAddressType=r={})),(0,o.registerEnumType)(r,{name:"RiderAddressType"})},(e,t,a)=>{var o;Object.defineProperty(t,"__esModule",{value:!0}),t.RiderWalletEntity=void 0;const r=a(4),n=a(15),i=a(76);let d=class RiderWalletEntity{};t.RiderWalletEntity=d,r.__decorate([(0,n.PrimaryGeneratedColumn)(),r.__metadata("design:type",Number)],d.prototype,"id",void 0),r.__decorate([(0,n.Column)("float",{default:0,name:"amount"}),r.__metadata("design:type",Number)],d.prototype,"balance",void 0),r.__decorate([(0,n.Column)("char",{length:3}),r.__metadata("design:type",String)],d.prototype,"currency",void 0),r.__decorate([(0,n.ManyToOne)((()=>i.RiderEntity),(e=>e.wallets)),r.__metadata("design:type","function"==typeof(o=void 0!==i.RiderEntity&&i.RiderEntity)?o:Object)],d.prototype,"rider",void 0),r.__decorate([(0,n.Column)(),r.__metadata("design:type",Number)],d.prototype,"riderId",void 0),t.RiderWalletEntity=d=r.__decorate([(0,n.Entity)("rider_wallet")],d)},(e,t,a)=>{var o,r,n,i;Object.defineProperty(t,"__esModule",{value:!0}),t.RiderReviewEntity=void 0;const d=a(4),y=a(15),s=a(76),p=a(61),c=a(73);let u=class RiderReviewEntity{};t.RiderReviewEntity=u,d.__decorate([(0,y.PrimaryGeneratedColumn)(),d.__metadata("design:type",Number)],u.prototype,"id",void 0),d.__decorate([(0,y.Column)("tinyint"),d.__metadata("design:type",Number)],u.prototype,"score",void 0),d.__decorate([(0,y.Column)({name:"review",nullable:!0}),d.__metadata("design:type",String)],u.prototype,"description",void 0),d.__decorate([(0,y.ManyToOne)((()=>s.RiderEntity),(e=>e.reviewsForRider)),d.__metadata("design:type","function"==typeof(o=void 0!==s.RiderEntity&&s.RiderEntity)?o:Object)],u.prototype,"rider",void 0),d.__decorate([(0,y.Column)(),d.__metadata("design:type",Number)],u.prototype,"riderId",void 0),d.__decorate([(0,y.ManyToOne)((()=>p.DriverEntity),(e=>e.reviewsByDriver)),d.__metadata("design:type","function"==typeof(r=void 0!==p.DriverEntity&&p.DriverEntity)?r:Object)],u.prototype,"driver",void 0),d.__decorate([(0,y.Column)(),d.__metadata("design:type",Number)],u.prototype,"driverId",void 0),d.__decorate([(0,y.CreateDateColumn)(),d.__metadata("design:type","function"==typeof(n="undefined"!=typeof Date&&Date)?n:Object)],u.prototype,"reviewTimestamp",void 0),d.__decorate([(0,y.OneToOne)((()=>c.RequestEntity),(e=>e.driverReviewForRider)),(0,y.JoinColumn)(),d.__metadata("design:type","function"==typeof(i=void 0!==c.RequestEntity&&c.RequestEntity)?i:Object)],u.prototype,"request",void 0),d.__decorate([(0,y.Column)(),d.__metadata("design:type",Number)],u.prototype,"orderId",void 0),t.RiderReviewEntity=u=d.__decorate([(0,y.Entity)("rider_review")],u)},(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.OrderStatus=void 0;const o=a(10);var r;!function(e){e.Requested="Requested",e.NotFound="NotFound",e.NoCloseFound="NoCloseFound",e.Found="Found",e.DriverAccepted="DriverAccepted",e.Arrived="Arrived",e.WaitingForPrePay="WaitingForPrePay",e.DriverCanceled="DriverCanceled",e.RiderCanceled="RiderCanceled",e.Started="Started",e.WaitingForPostPay="WaitingForPostPay",e.WaitingForReview="WaitingForReview",e.Finished="Finished",e.Booked="Booked",e.Expired="Expired"}(r||(t.OrderStatus=r={})),(0,o.registerEnumType)(r,{name:"OrderStatus"})},(e,t,a)=>{var o,r,n;Object.defineProperty(t,"__esModule",{value:!0}),t.FeedbackEntity=void 0;const i=a(4),d=a(15),y=a(61),s=a(124),p=a(73);let c=class FeedbackEntity{};t.FeedbackEntity=c,i.__decorate([(0,d.PrimaryGeneratedColumn)(),i.__metadata("design:type",Number)],c.prototype,"id",void 0),i.__decorate([(0,d.CreateDateColumn)(),i.__metadata("design:type","function"==typeof(o="undefined"!=typeof Date&&Date)?o:Object)],c.prototype,"reviewTimestamp",void 0),i.__decorate([(0,d.Column)("tinyint"),i.__metadata("design:type",Number)],c.prototype,"score",void 0),i.__decorate([(0,d.Column)({name:"review",nullable:!0}),i.__metadata("design:type",String)],c.prototype,"description",void 0),i.__decorate([(0,d.ManyToOne)((()=>y.DriverEntity),(e=>e.feedbacks)),i.__metadata("design:type","function"==typeof(r=void 0!==y.DriverEntity&&y.DriverEntity)?r:Object)],c.prototype,"driver",void 0),i.__decorate([(0,d.Column)(),i.__metadata("design:type",Number)],c.prototype,"driverId",void 0),i.__decorate([(0,d.OneToOne)((()=>p.RequestEntity),(e=>e.review)),(0,d.JoinColumn)(),i.__metadata("design:type","function"==typeof(n=void 0!==p.RequestEntity&&p.RequestEntity)?n:Object)],c.prototype,"request",void 0),i.__decorate([(0,d.Column)({nullable:!0}),i.__metadata("design:type",Number)],c.prototype,"requestId",void 0),i.__decorate([(0,d.ManyToMany)((()=>s.FeedbackParameterEntity),(e=>e.feedbacks)),i.__metadata("design:type",Array)],c.prototype,"parameters",void 0),t.FeedbackEntity=c=i.__decorate([(0,d.Entity)("request_review")],c)},(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.FeedbackParameterEntity=void 0;const o=a(4),r=a(15),n=a(123);let i=class FeedbackParameterEntity{};t.FeedbackParameterEntity=i,o.__decorate([(0,r.PrimaryGeneratedColumn)(),o.__metadata("design:type",Number)],i.prototype,"id",void 0),o.__decorate([(0,r.Column)(),o.__metadata("design:type",String)],i.prototype,"title",void 0),o.__decorate([(0,r.Column)(),o.__metadata("design:type",Boolean)],i.prototype,"isGood",void 0),o.__decorate([(0,r.ManyToMany)((()=>n.FeedbackEntity),(e=>e.parameters)),(0,r.JoinTable)(),o.__metadata("design:type",Array)],i.prototype,"feedbacks",void 0),t.FeedbackParameterEntity=i=o.__decorate([(0,r.Entity)("review_parameter")],i)},(e,t,a)=>{var o,r,n;Object.defineProperty(t,"__esModule",{value:!0}),t.OrderMessageEntity=void 0;const i=a(4),d=a(15),y=a(126),s=a(73);let p=class OrderMessageEntity{};t.OrderMessageEntity=p,i.__decorate([(0,d.PrimaryGeneratedColumn)(),i.__metadata("design:type",Number)],p.prototype,"id",void 0),i.__decorate([(0,d.CreateDateColumn)(),i.__metadata("design:type","function"==typeof(o="undefined"!=typeof Date&&Date)?o:Object)],p.prototype,"sentAt",void 0),i.__decorate([(0,d.Column)(),i.__metadata("design:type",Boolean)],p.prototype,"sentByDriver",void 0),i.__decorate([(0,d.Column)("enum",{name:"state",enum:y.MessageStatus,default:y.MessageStatus.Sent}),i.__metadata("design:type","function"==typeof(r=void 0!==y.MessageStatus&&y.MessageStatus)?r:Object)],p.prototype,"status",void 0),i.__decorate([(0,d.Column)(),i.__metadata("design:type",String)],p.prototype,"content",void 0),i.__decorate([(0,d.ManyToOne)((()=>s.RequestEntity),(e=>e.conversation)),i.__metadata("design:type","function"==typeof(n=void 0!==s.RequestEntity&&s.RequestEntity)?n:Object)],p.prototype,"request",void 0),i.__decorate([(0,d.Column)(),i.__metadata("design:type",Number)],p.prototype,"requestId",void 0),t.OrderMessageEntity=p=i.__decorate([(0,d.Entity)("request_chat")],p)},(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.MessageStatus=void 0;const o=a(10);var r;!function(e){e.Sent="sent",e.Delivered="delivered",e.Seen="seen"}(r||(t.MessageStatus=r={})),(0,o.registerEnumType)(r,{name:"MessageStatus"})},(e,t,a)=>{var o,r,n;Object.defineProperty(t,"__esModule",{value:!0}),t.RequestActivityEntity=void 0;const i=a(4),d=a(15),y=a(128),s=a(73);let p=class RequestActivityEntity{};t.RequestActivityEntity=p,i.__decorate([(0,d.PrimaryGeneratedColumn)(),i.__metadata("design:type",Number)],p.prototype,"id",void 0),i.__decorate([(0,d.Column)("enum",{enum:y.RequestActivityType}),i.__metadata("design:type","function"==typeof(o=void 0!==y.RequestActivityType&&y.RequestActivityType)?o:Object)],p.prototype,"type",void 0),i.__decorate([(0,d.CreateDateColumn)(),i.__metadata("design:type","function"==typeof(r="undefined"!=typeof Date&&Date)?r:Object)],p.prototype,"createdAt",void 0),i.__decorate([(0,d.ManyToOne)((()=>s.RequestEntity),(e=>e.activities)),i.__metadata("design:type","function"==typeof(n=void 0!==s.RequestEntity&&s.RequestEntity)?n:Object)],p.prototype,"request",void 0),i.__decorate([(0,d.Column)(),i.__metadata("design:type",Number)],p.prototype,"requestId",void 0),t.RequestActivityEntity=p=i.__decorate([(0,d.Entity)("request_activity")],p)},(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.RequestActivityType=void 0;const o=a(10);var r;!function(e){e.RequestedByOperator="RequestedByOperator",e.BookedByOperator="BookedByOperator",e.RequestedByRider="RequestedByRider",e.BookedByRider="BookedByRider",e.DriverAccepted="DriverAccepted",e.ArrivedToPickupPoint="ArrivedToPickupPoint",e.CanceledByDriver="CanceledByDriver",e.CanceledByRider="CanceledByRider",e.CanceledByOperator="CanceledByOperator",e.Started="Started",e.ArrivedToDestination="ArrivedToDestination",e.Paid="Paid",e.Reviewed="Reviewed",e.Expired="Expired"}(r||(t.RequestActivityType=r={})),(0,o.registerEnumType)(r,{name:"RequestActivityType"})},(e,t,a)=>{var o,r,n,i;Object.defineProperty(t,"__esModule",{value:!0}),t.SOSEntity=void 0;const d=a(4),y=a(15),s=a(117),p=a(118),c=a(130),u=a(73),_=a(131);let l=class SOSEntity{};t.SOSEntity=l,d.__decorate([(0,y.PrimaryGeneratedColumn)(),d.__metadata("design:type",Number)],l.prototype,"id",void 0),d.__decorate([(0,y.CreateDateColumn)(),d.__metadata("design:type","function"==typeof(o="undefined"!=typeof Date&&Date)?o:Object)],l.prototype,"createdAt",void 0),d.__decorate([(0,y.Column)("enum",{enum:c.SOSStatus,default:c.SOSStatus.Submitted}),d.__metadata("design:type","function"==typeof(r=void 0!==c.SOSStatus&&c.SOSStatus)?r:Object)],l.prototype,"status",void 0),d.__decorate([(0,y.Column)("point",{transformer:new p.PointTransformer,nullable:!0}),d.__metadata("design:type","function"==typeof(n=void 0!==s.Point&&s.Point)?n:Object)],l.prototype,"location",void 0),d.__decorate([(0,y.ManyToOne)((()=>u.RequestEntity),(e=>e.sosCalls)),d.__metadata("design:type","function"==typeof(i=void 0!==u.RequestEntity&&u.RequestEntity)?i:Object)],l.prototype,"request",void 0),d.__decorate([(0,y.Column)(),d.__metadata("design:type",Number)],l.prototype,"requestId",void 0),d.__decorate([(0,y.Column)(),d.__metadata("design:type",Boolean)],l.prototype,"submittedByRider",void 0),d.__decorate([(0,y.OneToMany)((()=>_.SOSActivityEntity),(e=>e.sos)),d.__metadata("design:type",Array)],l.prototype,"activities",void 0),t.SOSEntity=l=d.__decorate([(0,y.Entity)("sos")],l)},(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.SOSStatus=void 0;const o=a(10);var r;!function(e){e.Submitted="Submitted",e.UnderReview="UnderReview",e.FalseAlarm="FalseAlarm",e.Resolved="Resolved"}(r||(t.SOSStatus=r={})),(0,o.registerEnumType)(r,{name:"SOSStatus"})},(e,t,a)=>{var o,r,n,i;Object.defineProperty(t,"__esModule",{value:!0}),t.SOSActivityEntity=void 0;const d=a(4),y=a(15),s=a(132),p=a(69),c=a(129);let u=class SOSActivityEntity{};t.SOSActivityEntity=u,d.__decorate([(0,y.PrimaryGeneratedColumn)(),d.__metadata("design:type",Number)],u.prototype,"id",void 0),d.__decorate([(0,y.CreateDateColumn)(),d.__metadata("design:type","function"==typeof(o="undefined"!=typeof Date&&Date)?o:Object)],u.prototype,"createdAt",void 0),d.__decorate([(0,y.Column)("enum",{enum:s.SOSActivityAction}),d.__metadata("design:type","function"==typeof(r=void 0!==s.SOSActivityAction&&s.SOSActivityAction)?r:Object)],u.prototype,"action",void 0),d.__decorate([(0,y.Column)({length:2e3}),d.__metadata("design:type",String)],u.prototype,"note",void 0),d.__decorate([(0,y.ManyToOne)((()=>p.OperatorEntity),(e=>e.sosActivities)),d.__metadata("design:type","function"==typeof(n=void 0!==p.OperatorEntity&&p.OperatorEntity)?n:Object)],u.prototype,"operator",void 0),d.__decorate([(0,y.Column)({nullable:!0}),d.__metadata("design:type",Number)],u.prototype,"operatorId",void 0),d.__decorate([(0,y.ManyToOne)((()=>c.SOSEntity),(e=>e.activities)),d.__metadata("design:type","function"==typeof(i=void 0!==c.SOSEntity&&c.SOSEntity)?i:Object)],u.prototype,"sos",void 0),d.__decorate([(0,y.Column)(),d.__metadata("design:type",Number)],u.prototype,"sosId",void 0),t.SOSActivityEntity=u=d.__decorate([(0,y.Entity)("sos_activity")],u)},(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.SOSActivityAction=void 0;const o=a(10);var r;!function(e){e.Submitted="Submitted",e.Seen="Seen",e.ContactDriver="ContactDriver",e.ContactAuthorities="ContactAuthorities",e.MarkedAsResolved="MarkedAsResolved",e.MarkedAsFalseAlarm="MarkedAsFalseAlarm"}(r||(t.SOSActivityAction=r={})),(0,o.registerEnumType)(r,{name:"SOSActivityAction"})},(e,t,a)=>{var o;Object.defineProperty(t,"__esModule",{value:!0}),t.OrderCancelReasonEntity=void 0;const r=a(4),n=a(15),i=a(73),d=a(82);let y=class OrderCancelReasonEntity{};t.OrderCancelReasonEntity=y,r.__decorate([(0,n.PrimaryGeneratedColumn)(),r.__metadata("design:type",Number)],y.prototype,"id",void 0),r.__decorate([(0,n.Column)(),r.__metadata("design:type",String)],y.prototype,"title",void 0),r.__decorate([(0,n.OneToMany)((()=>i.RequestEntity),(e=>e.cancelReason)),r.__metadata("design:type",Array)],y.prototype,"orders",void 0),r.__decorate([(0,n.Column)({default:!0}),r.__metadata("design:type",Boolean)],y.prototype,"isEnabled",void 0),r.__decorate([(0,n.Column)("enum",{enum:d.AnnouncementUserType,default:d.AnnouncementUserType.Rider}),r.__metadata("design:type","function"==typeof(o=void 0!==d.AnnouncementUserType&&d.AnnouncementUserType)?o:Object)],y.prototype,"userType",void 0),t.OrderCancelReasonEntity=y=r.__decorate([(0,n.Entity)("order_cancel_reason")],y)},(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.PaymentMode=void 0;const o=a(10);var r;!function(e){e.Cash="cash",e.SavedPaymentMethod="savedPaymentMethod",e.PaymentGateway="paymentGateway",e.Wallet="wallet"}(r||(t.PaymentMode=r={})),(0,o.registerEnumType)(r,{name:"PaymentMode",description:"The means of payment for an order."})},(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ComplaintActivityType=void 0;const o=a(10);var r;!function(e){e.AssignToOperator="AssignedToOperator",e.Update="Update",e.Resolved="Resolved"}(r||(t.ComplaintActivityType=r={})),(0,o.registerEnumType)(r,{name:"ComplaintActivityType"})},(e,t)=>{var a;Object.defineProperty(t,"__esModule",{value:!0}),t.EnabledNotification=void 0,function(e){e.SOS="sos",e.Complaint="complaint",e.Order="order",e.DriverSubmittedDocs="driverSubmittedDocs"}(a||(t.EnabledNotification=a={}))},(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.OperatorRoleEntity=void 0;const o=a(4),r=a(15),n=a(138),i=a(69);let d=class OperatorRoleEntity{};t.OperatorRoleEntity=d,o.__decorate([(0,r.PrimaryGeneratedColumn)(),o.__metadata("design:type",Number)],d.prototype,"id",void 0),o.__decorate([(0,r.Column)(),o.__metadata("design:type",String)],d.prototype,"title",void 0),o.__decorate([(0,r.Column)("set",{enum:n.OperatorPermission}),o.__metadata("design:type",Array)],d.prototype,"permissions",void 0),o.__decorate([(0,r.OneToMany)((()=>i.OperatorEntity),(e=>e.role)),o.__metadata("design:type",Array)],d.prototype,"operators",void 0),t.OperatorRoleEntity=d=o.__decorate([(0,r.Entity)("operator_role")],d)},(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.OperatorPermission=void 0;const o=a(10);var r;!function(e){e.Drivers_View="Drivers_View",e.Drivers_Edit="Drivers_Edit",e.Riders_View="Riders_View",e.Riders_Edit="Riders_Edit",e.Regions_View="Regions_View",e.Regions_Edit="Regions_Edit",e.Services_View="Services_View",e.Services_Edit="Services_Edit",e.Complaints_View="Complaints_View",e.Complaints_Edit="Complaints_Edit",e.Coupons_View="Coupons_View",e.Coupons_Edit="Coupons_Edit",e.Announcements_View="Announcements_View",e.Announcements_Edit="Announcements_Edit",e.Requests_View="Requests_View",e.Fleets_View="Fleets_View",e.Fleets_Edit="Fleets_Edit",e.Gateways_View="Gateways_View",e.Gateways_Edit="Gateways_Edit",e.Users_View="Users_View",e.Users_Edit="Users_Edit",e.Cars_View="Cars_View",e.Cars_Edit="Cars_Edit",e.FleetWallet_View="FleetWallet_View",e.FleetWallet_Edit="FleetWallet_Edit",e.ProviderWallet_View="ProviderWallet_View",e.ProviderWallet_Edit="ProviderWallet_Edit",e.DriverWallet_View="DriverWallet_View",e.DriverWallet_Edit="DriverWallet_Edit",e.RiderWallet_View="RiderWallet_View",e.RiderWallet_Edit="RiderWallet_Edit",e.ReviewParameter_Edit="ReviewParameter_Edit",e.Payouts_View="Payouts_View",e.Payouts_Edit="Payouts_Edit",e.GiftBatch_View="GiftBatch_View",e.GiftBatch_Create="GiftBatch_Create",e.GiftBatch_ViewCodes="GiftBatch_ViewCodes",e.SMSProviders_View="SMSProviders_View",e.SMSProviders_Edit="SMSProviders_Edit"}(r||(t.OperatorPermission=r={})),(0,o.registerEnumType)(r,{name:"OperatorPermission"})},(e,t,a)=>{var o;Object.defineProperty(t,"__esModule",{value:!0}),t.DriverWalletEntity=void 0;const r=a(4),n=a(15),i=a(61);let d=class DriverWalletEntity{};t.DriverWalletEntity=d,r.__decorate([(0,n.PrimaryGeneratedColumn)(),r.__metadata("design:type",Number)],d.prototype,"id",void 0),r.__decorate([(0,n.Column)("float",{default:0,name:"amount"}),r.__metadata("design:type",Number)],d.prototype,"balance",void 0),r.__decorate([(0,n.Column)("char",{length:3}),r.__metadata("design:type",String)],d.prototype,"currency",void 0),r.__decorate([(0,n.ManyToOne)((()=>i.DriverEntity),(e=>e.wallet),{onDelete:"CASCADE"}),r.__metadata("design:type","function"==typeof(o=void 0!==i.DriverEntity&&i.DriverEntity)?o:Object)],d.prototype,"driver",void 0),r.__decorate([(0,n.Column)(),r.__metadata("design:type",Number)],d.prototype,"driverId",void 0),t.DriverWalletEntity=d=r.__decorate([(0,n.Entity)("driver_wallet")],d)},(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.DriverStatus=void 0;const o=a(10);var r;!function(e){e.Online="online",e.Offline="offline",e.Blocked="blocked",e.InService="in service",e.WaitingDocuments="waiting documents",e.PendingApproval="pending approval",e.SoftReject="soft reject",e.HardReject="hard reject"}(r||(t.DriverStatus=r={})),(0,o.registerEnumType)(r,{name:"DriverStatus"})},e=>{e.exports=require("@nestjs/config")},(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.GatewaysModule=void 0;const o=a(4),r=a(29),n=a(1),i=a(13),d=a(16),y=a(143),s=a(20),p=a(145),c=a(28),u=a(147),_=a(44),l=a(149),m=a(31),v=a(151),f=a(32),g=a(154),b=a(42),S=a(156),P=a(11),O=a(158),M=a(26),E=a(160),C=a(39),h=a(162),T=a(37),w=a(164),R=a(35),j=a(166),I=a(43),A=a(169),F=a(33),D=a(173),N=a(46),k=a(175),q=a(48),G=a(177),x=a(50),$=a(179),U=a(52),B=a(181),L=a(56);let W=class GatewaysModule{};t.GatewaysModule=W,t.GatewaysModule=W=o.__decorate([(0,n.Module)({imports:[r.HttpModule,y.AmazonPaymentServicesModule,S.PaypalModule,O.PaystackModule,A.StripeModule,p.FlutterwaveModule,w.RazorPayModule,l.MIPSModule,h.PayUMoneyModule,E.PayTMModule,v.MyTMoneyModule,u.MercadopagoModule,g.MyFatoorahModule,j.SberBankModule,D.WayForPayModule,G.BinancePayModule,$.OpenPixModule,k.InstaMojoModule,B.PayTRModule,i.TypeOrmModule.forFeature([d.GatewayToUserEntity])],providers:[s.AmazonPaymentServicesService,P.PaypalService,M.PaystackService,F.StripeService,c.FlutterwaveService,m.MIPSService,R.RazorPayService,f.MyTMoneyService,C.PayTMService,T.PayUMoneyService,_.MercadopagoService,b.MyFatoorahService,I.SberBankService,q.InstaMojoService,x.BinancePayService,U.OpenPixService,N.WayForPayService,L.PayTRService],exports:[s.AmazonPaymentServicesService,P.PaypalService,M.PaystackService,F.StripeService,R.RazorPayService,c.FlutterwaveService,m.MIPSService,C.PayTMService,f.MyTMoneyService,T.PayUMoneyService,_.MercadopagoService,b.MyFatoorahService,I.SberBankService,q.InstaMojoService,x.BinancePayService,U.OpenPixService,N.WayForPayService,L.PayTRService]})],W)},(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.AmazonPaymentServicesModule=void 0;const o=a(4),r=a(1),n=a(13),i=a(14),d=a(24),y=a(58),s=a(144),p=a(20);let c=class AmazonPaymentServicesModule{};t.AmazonPaymentServicesModule=c,t.AmazonPaymentServicesModule=c=o.__decorate([(0,r.Module)({imports:[y.PaymentModule,n.TypeOrmModule.forFeature([d.PaymentEntity,i.PaymentGatewayEntity])],controllers:[s.AmazonPaymentServicesController],providers:[p.AmazonPaymentServicesService],exports:[p.AmazonPaymentServicesService]})],c)},(e,t,a)=>{var o,r,n,i,d,y;Object.defineProperty(t,"__esModule",{value:!0}),t.AmazonPaymentServicesController=void 0;const s=a(4),p=a(1),c=a(13),u=a(6),_=s.__importStar(a(23)),l=a(15),m=a(14),v=a(24),f=a(21);let g=class AmazonPaymentServicesController{constructor(e,t){this.gatewayRepository=e,this.paymentService=t}async redirect(e,t){const a=await this.paymentService.getOne(e.query.transactionId),o=await this.gatewayRepository.findOneByOrFail({id:a.gatewayId}),r=e.query.token,n=Buffer.from(r,"base64").toString("utf8"),i=JSON.parse(n),d=null!=process.env.DEMO_MODE||"dev"==process.env.NODE_ENV?"https://sbcheckout.payfort.com/FortAPI/paymentPage":"https://checkout.payfort.com/FortAPI/paymentPage",y={access_code:o.privateKey,amount:parseInt((100*i.amount).toString()).toString(),command:"PURCHASE",currency:i.currency,customer_email:`${i.userType}_${i.userId}@user.com`,language:"en",merchant_identifier:o.merchantId,merchant_reference:i.transactionId,order_description:"topup",return_url:`${process.env.GATEWAY_SERVER_URL}amazon/callback`};let s='<html xmlns="https://www.w3.org/1999/xhtml"><head></head><body><form action=\'%redirection_url%\' method=\'post\' name=\'frm\'><input type=\'hidden\' name="command" value="PURCHASE"><input type=\'hidden\' name="access_code" value="%access_code%"><input type=\'hidden\' name="merchant_identifier" value="%merchant_identifier%"><input type=\'hidden\' name="merchant_reference" value="%merchant_reference%"><input type=\'hidden\' name="amount" value="%amount%"><input type=\'hidden\' name="currency" value="%currency%"><input type=\'hidden\' name="language" value="%language%"><input type=\'hidden\' name="customer_email" value="%customer_email%"><input type="hidden" name="return_url" value="%return_url%"><input type=\'hidden\' name="signature" value="%signature%"><input type=\'hidden\' name="order_description" value="%order_description%"><script type=\'text/javascript\'>document.frm.submit(); <\/script></form></body></html>';Object.entries(y).forEach((([e,t],a)=>s=s.replace(`%${e}%`,t)));const p=`${o.saltKey}${Object.entries(y).map((([e,t])=>`${e}=${t}`)).join("")}${o.saltKey}`,c=_.createHash("sha256").update(p).digest("hex");s=s.replace("%signature%",c),s=s.replace("%redirection_url%",d),t.send(s),t.code(200)}async callback(e,t){let a=await this.paymentService.getOne(e.body.merchant_reference);a=await this.paymentService.updatePaymentStatus(a.id,"Success"==e.body.response_message?v.PaymentStatus.Success:v.PaymentStatus.Canceled);const o=await this.paymentService.getEncryptedWithPayment(a);t.redirect(301,`${a.returnUrl}?token=${o}`)}};t.AmazonPaymentServicesController=g,s.__decorate([(0,p.Get)("redirect"),s.__param(0,(0,p.Req)()),s.__param(1,(0,p.Res)()),s.__metadata("design:type",Function),s.__metadata("design:paramtypes",["function"==typeof(n=void 0!==u.FastifyRequest&&u.FastifyRequest)?n:Object,"function"==typeof(i=void 0!==u.FastifyReply&&u.FastifyReply)?i:Object]),s.__metadata("design:returntype",Promise)],g.prototype,"redirect",null),s.__decorate([(0,p.Get)("callback"),s.__param(0,(0,p.Req)()),s.__param(1,(0,p.Res)()),s.__metadata("design:type",Function),s.__metadata("design:paramtypes",["function"==typeof(d=void 0!==u.FastifyRequest&&u.FastifyRequest)?d:Object,"function"==typeof(y=void 0!==u.FastifyReply&&u.FastifyReply)?y:Object]),s.__metadata("design:returntype",Promise)],g.prototype,"callback",null),t.AmazonPaymentServicesController=g=s.__decorate([(0,p.Controller)("amazon"),s.__param(0,(0,c.InjectRepository)(m.PaymentGatewayEntity)),s.__metadata("design:paramtypes",["function"==typeof(o=void 0!==l.Repository&&l.Repository)?o:Object,"function"==typeof(r=void 0!==f.PaymentService&&f.PaymentService)?r:Object])],g)},(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.FlutterwaveModule=void 0;const o=a(4),r=a(29),n=a(1),i=a(13),d=a(14),y=a(24),s=a(58),p=a(146),c=a(28);let u=class FlutterwaveModule{};t.FlutterwaveModule=u,t.FlutterwaveModule=u=o.__decorate([(0,n.Module)({imports:[s.PaymentModule,r.HttpModule,i.TypeOrmModule.forFeature([y.PaymentEntity,d.PaymentGatewayEntity])],controllers:[p.FlutterwaveController],providers:[c.FlutterwaveService],exports:[c.FlutterwaveService]})],u)},(e,t,a)=>{var o,r,n,i;Object.defineProperty(t,"__esModule",{value:!0}),t.FlutterwaveController=void 0;const d=a(4),y=a(1),s=a(13),p=a(6),c=a(15),u=a(14),_=a(24),l=a(21);let m=class FlutterwaveController{constructor(e,t){this.gatewayRepository=e,this.paymentService=t}async callback(e,t){console.log(`Verify Flutterwave called with query: ${JSON.stringify(e.query)}`);const a=e.query.tx_ref;let o=await this.paymentService.getOne(a);if(null==o)throw new y.ForbiddenException("Transaction Not found.");await this.gatewayRepository.findOneBy({id:o.gatewayId});await this.paymentService.updatePaymentStatus(o.id,"successful"==e.query.status?_.PaymentStatus.Success:_.PaymentStatus.Canceled),o=await this.paymentService.getOne(a);const r=await this.paymentService.getEncryptedWithPayment(o);t.redirect(301,`${o.returnUrl}?token=${r}`)}};t.FlutterwaveController=m,d.__decorate([(0,y.Get)("callback"),d.__param(0,(0,y.Req)()),d.__param(1,(0,y.Res)()),d.__metadata("design:type",Function),d.__metadata("design:paramtypes",["function"==typeof(n=void 0!==p.FastifyRequest&&p.FastifyRequest)?n:Object,"function"==typeof(i=void 0!==p.FastifyReply&&p.FastifyReply)?i:Object]),d.__metadata("design:returntype",Promise)],m.prototype,"callback",null),t.FlutterwaveController=m=d.__decorate([(0,y.Controller)("flutterwave"),d.__param(0,(0,s.InjectRepository)(u.PaymentGatewayEntity)),d.__metadata("design:paramtypes",["function"==typeof(o=void 0!==c.Repository&&c.Repository)?o:Object,"function"==typeof(r=void 0!==l.PaymentService&&l.PaymentService)?r:Object])],m)},(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.MercadopagoModule=void 0;const o=a(4),r=a(1),n=a(13),i=a(14),d=a(24),y=a(58),s=a(148),p=a(44);let c=class MercadopagoModule{};t.MercadopagoModule=c,t.MercadopagoModule=c=o.__decorate([(0,r.Module)({imports:[y.PaymentModule,n.TypeOrmModule.forFeature([d.PaymentEntity,i.PaymentGatewayEntity])],controllers:[s.MercadopagoController],providers:[p.MercadopagoService],exports:[p.MercadopagoService]})],c)},(e,t,a)=>{var o,r,n,i,d,y,s;Object.defineProperty(t,"__esModule",{value:!0}),t.MercadopagoController=void 0;const p=a(4),c=a(1),u=a(13),_=a(6),l=a(15),m=a(14),v=a(24),f=a(21),g=a(44),b=a(45);let S=class MercadopagoController{constructor(e,t,a){this.gatewayRepository=e,this.paymentService=t,this.mercadopagoService=a}async redirect(e,t){const a=`<script src="https://sdk.mercadopago.com/js/v2"><\/script><div class="cho-container"></div><script>const mp=new MercadoPago('${(await this.gatewayRepository.findOneByOrFail({id:parseInt(e.query.gatewayId)})).publicKey}',{locale: 'es-AR'}); mp.checkout({preference:{id: '${e.query.token}'}, render:{container: '.cho-container',}});<\/script>`;console.log(a),t.raw.write(a),t.raw.end()}async callback(e,t){c.Logger.log(`Mercadopago callback query:${JSON.stringify(e.query)}`);const a=await this.gatewayRepository.findOneByOrFail({id:parseInt(e.query.gatewayId)});b.configure({access_token:a.privateKey});const o=await b.preferences.get(e.query.preference_id);c.Logger.log(`Mercadopago decrypted verify result:${JSON.stringify(o)}`);let r=await this.paymentService.getOne(o.external_reference);if(null==r)throw new c.ForbiddenException("Transaction Not found.");await this.paymentService.updatePaymentStatus(r.id,null!=o.response.total_amount?v.PaymentStatus.Success:v.PaymentStatus.Canceled),r=await this.paymentService.getOne(o.external_reference);const n=await this.paymentService.getEncryptedWithPayment(r);t.redirect(301,`${r.returnUrl}?token=${n}`)}};t.MercadopagoController=S,p.__decorate([(0,c.Get)("redirect"),p.__param(0,(0,c.Req)()),p.__param(1,(0,c.Res)()),p.__metadata("design:type",Function),p.__metadata("design:paramtypes",["function"==typeof(i=void 0!==_.FastifyRequest&&_.FastifyRequest)?i:Object,"function"==typeof(d=void 0!==_.FastifyReply&&_.FastifyReply)?d:Object]),p.__metadata("design:returntype",Promise)],S.prototype,"redirect",null),p.__decorate([(0,c.Get)("callback"),p.__param(0,(0,c.Req)()),p.__param(1,(0,c.Res)()),p.__metadata("design:type",Function),p.__metadata("design:paramtypes",["function"==typeof(y=void 0!==_.FastifyRequest&&_.FastifyRequest)?y:Object,"function"==typeof(s=void 0!==_.FastifyReply&&_.FastifyReply)?s:Object]),p.__metadata("design:returntype",Promise)],S.prototype,"callback",null),t.MercadopagoController=S=p.__decorate([(0,c.Controller)("mercadopago"),p.__param(0,(0,u.InjectRepository)(m.PaymentGatewayEntity)),p.__metadata("design:paramtypes",["function"==typeof(o=void 0!==l.Repository&&l.Repository)?o:Object,"function"==typeof(r=void 0!==f.PaymentService&&f.PaymentService)?r:Object,"function"==typeof(n=void 0!==g.MercadopagoService&&g.MercadopagoService)?n:Object])],S)},(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.MIPSModule=void 0;const o=a(4),r=a(29),n=a(1),i=a(13),d=a(14),y=a(24),s=a(58),p=a(150),c=a(31);let u=class MIPSModule{};t.MIPSModule=u,t.MIPSModule=u=o.__decorate([(0,n.Module)({imports:[s.PaymentModule,r.HttpModule,i.TypeOrmModule.forFeature([y.PaymentEntity,d.PaymentGatewayEntity])],controllers:[p.MIPSController],providers:[c.MIPSService],exports:[c.MIPSService]})],u)},(e,t,a)=>{var o,r,n,i,d,y;Object.defineProperty(t,"__esModule",{value:!0}),t.MIPSController=void 0;const s=a(4),p=a(29),c=a(1),u=a(13),_=a(6),l=a(30),m=a(15),v=a(14),f=a(24),g=a(21),b=a(31);let S=class MIPSController{constructor(e,t,a,o){this.gatewayRepository=e,this.paymentService=t,this.mipsService=a,this.httpService=o}async callback(e,t){c.Logger.log(`Verify Mips called with query: ${JSON.stringify(e.query)} & body: ${JSON.stringify(e.body)}`);let a=await this.paymentService.getOne(e.query.id_order);if(null==a)throw new c.ForbiddenException("Transaction Not found.");const o=await this.gatewayRepository.findOneByOrFail({id:a.gatewayId}),r=await this.mipsService.getMipsDecrypted(o,e.body.posted_data);c.Logger.log(JSON.stringify(r)),await this.paymentService.updatePaymentStatus(a.id,"success"==r.status.toLowerCase()?f.PaymentStatus.Success:f.PaymentStatus.Canceled),a=await this.paymentService.getOne(e.query.id_order);const n=await this.paymentService.getEncryptedWithPayment(a);await(0,l.firstValueFrom)(this.httpService.get(`${a.returnUrl}?token=${n}`)),t.send(200)}};t.MIPSController=S,s.__decorate([(0,c.Post)("callback"),s.__param(0,(0,c.Req)()),s.__param(1,(0,c.Res)()),s.__metadata("design:type",Function),s.__metadata("design:paramtypes",["function"==typeof(d=void 0!==_.FastifyRequest&&_.FastifyRequest)?d:Object,"function"==typeof(y=void 0!==_.FastifyReply&&_.FastifyReply)?y:Object]),s.__metadata("design:returntype",Promise)],S.prototype,"callback",null),t.MIPSController=S=s.__decorate([(0,c.Controller)("mips"),s.__param(0,(0,u.InjectRepository)(v.PaymentGatewayEntity)),s.__metadata("design:paramtypes",["function"==typeof(o=void 0!==m.Repository&&m.Repository)?o:Object,"function"==typeof(r=void 0!==g.PaymentService&&g.PaymentService)?r:Object,"function"==typeof(n=void 0!==b.MIPSService&&b.MIPSService)?n:Object,"function"==typeof(i=void 0!==p.HttpService&&p.HttpService)?i:Object])],S)},(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.MyTMoneyModule=void 0;const o=a(4),r=a(29),n=a(1),i=a(13),d=a(14),y=a(24),s=a(58),p=a(152),c=a(32);let u=class MyTMoneyModule{};t.MyTMoneyModule=u,t.MyTMoneyModule=u=o.__decorate([(0,n.Module)({imports:[s.PaymentModule,r.HttpModule,i.TypeOrmModule.forFeature([y.PaymentEntity,d.PaymentGatewayEntity])],controllers:[p.MyTMoneyController],providers:[c.MyTMoneyService],exports:[c.MyTMoneyService]})],u)},(e,t,a)=>{var o,r,n,i,d,y;Object.defineProperty(t,"__esModule",{value:!0}),t.MyTMoneyController=void 0;const s=a(4),p=a(1),c=a(13),u=a(6),_=a(15),l=a(14),m=a(24),v=a(21),f=s.__importStar(a(23)),g=a(153);let b=class MyTMoneyController{constructor(e,t){this.gatewayRepository=e,this.paymentService=t}async redirect(e,t){const a=e.query.token,o=Buffer.from(a,"base64").toString("utf8"),r=JSON.parse(o),n=await this.gatewayRepository.findOneByOrFail({id:r.gatewayId}),i={totalPrice:parseInt(r.amount.toString().split(".")[0]),currency:r.currency,merTradeNo:r.transactionId,notifyUrl:`${process.env.GATEWAY_SERVER_URL}mytmoney/callback`,returnUrl:"",lang:"en",remark:"Payment in my.t money"},d=new g("-----BEGIN PUBLIC KEY-----\n"+n.publicKey+"-----END PUBLIC KEY-----").encrypt(i,"base64"),y=`appId=${n.merchantId}&merTradeNo=${r.transactionId}&payload=${d}&paymentType=S`,s=f.createHmac("sha512",n.privateKey).update(y).digest("base64"),p={appid:n.merchantId,merTradeNo:r.transactionId,payload:d,sign:s};let c='<html xmlns="https://www.w3.org/1999/xhtml"><head></head><body><form action="https://pay.mytmoney.mu/Mt/web/payments" method="post" name="frm"> <input type="hidden" name="appId" value="$appid" /> <input type="hidden" name="merTradeNo" value="$merTradeNo" /> <input type="hidden" name="payload" value="$payload" /> <input type="hidden" name="paymentType" value="S" /> <input type="hidden" name="sign" value="$sign" /></form> <script type=\'text/javascript\'>document.frm.submit();<\/script></body></html>';Object.entries(p).forEach((([e,t],a)=>c=c.replace(`$${e}`,t))),t.raw.write(c),t.raw.end()}async callback(e,t){console.log(`MYTMoney Notify is called with body: ${JSON.stringify(e.body)} & query: ${JSON.stringify(e.query)}`);let a=await this.paymentService.getOne(e.query.merTradeNo);if(null==a)throw new p.ForbiddenException("Transaction Not found.");a=await this.paymentService.updatePaymentStatus(a.id,"TRADE_FINISHED"==e.query.tradeStatus?m.PaymentStatus.Success:m.PaymentStatus.Failed);const o=await this.paymentService.getEncryptedWithPayment(a);t.redirect(301,`${a.returnUrl}?token=${o}`)}};t.MyTMoneyController=b,s.__decorate([(0,p.Get)("redirect"),s.__param(0,(0,p.Req)()),s.__param(1,(0,p.Res)()),s.__metadata("design:type",Function),s.__metadata("design:paramtypes",["function"==typeof(n=void 0!==u.FastifyRequest&&u.FastifyRequest)?n:Object,"function"==typeof(i=void 0!==u.FastifyReply&&u.FastifyReply)?i:Object]),s.__metadata("design:returntype",Promise)],b.prototype,"redirect",null),s.__decorate([(0,p.Get)("callback"),s.__param(0,(0,p.Req)()),s.__param(1,(0,p.Res)()),s.__metadata("design:type",Function),s.__metadata("design:paramtypes",["function"==typeof(d=void 0!==u.FastifyRequest&&u.FastifyRequest)?d:Object,"function"==typeof(y=void 0!==u.FastifyReply&&u.FastifyReply)?y:Object]),s.__metadata("design:returntype",Promise)],b.prototype,"callback",null),t.MyTMoneyController=b=s.__decorate([(0,p.Controller)("mytmoney"),s.__param(0,(0,c.InjectRepository)(l.PaymentGatewayEntity)),s.__metadata("design:paramtypes",["function"==typeof(o=void 0!==_.Repository&&_.Repository)?o:Object,"function"==typeof(r=void 0!==v.PaymentService&&v.PaymentService)?r:Object])],b)},e=>{e.exports=require("node-rsa")},(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.MyFatoorahModule=void 0;const o=a(4),r=a(29),n=a(1),i=a(13),d=a(14),y=a(24),s=a(58),p=a(155),c=a(42);let u=class MyFatoorahModule{};t.MyFatoorahModule=u,t.MyFatoorahModule=u=o.__decorate([(0,n.Module)({imports:[s.PaymentModule,r.HttpModule,i.TypeOrmModule.forFeature([y.PaymentEntity,d.PaymentGatewayEntity])],controllers:[p.MyFatoorahController],providers:[c.MyFatoorahService],exports:[c.MyFatoorahService]})],u)},(e,t,a)=>{var o,r,n,i;Object.defineProperty(t,"__esModule",{value:!0}),t.MyFatoorahController=void 0;const d=a(4),y=a(1),s=a(13),p=a(6),c=a(15),u=a(14),_=a(24),l=a(21);let m=class MyFatoorahController{constructor(e,t){this.gatewayRepository=e,this.paymentService=t}async callback(e,t){console.log(`Verify Flutterwave called with query: ${JSON.stringify(e.query)}`);const a=e.query.tx_ref;let o=await this.paymentService.getOne(a);if(null==o)throw new y.ForbiddenException("Transaction Not found.");await this.gatewayRepository.findOneBy({id:o.gatewayId});await this.paymentService.updatePaymentStatus(o.id,"successful"==e.query.status?_.PaymentStatus.Success:_.PaymentStatus.Canceled),o=await this.paymentService.getOne(a);const r=await this.paymentService.getEncryptedWithPayment(o);t.redirect(301,`${o.returnUrl}?token=${r}`)}};t.MyFatoorahController=m,d.__decorate([(0,y.Get)("callback"),d.__param(0,(0,y.Req)()),d.__param(1,(0,y.Res)()),d.__metadata("design:type",Function),d.__metadata("design:paramtypes",["function"==typeof(n=void 0!==p.FastifyRequest&&p.FastifyRequest)?n:Object,"function"==typeof(i=void 0!==p.FastifyReply&&p.FastifyReply)?i:Object]),d.__metadata("design:returntype",Promise)],m.prototype,"callback",null),t.MyFatoorahController=m=d.__decorate([(0,y.Controller)("myfatoorah"),d.__param(0,(0,s.InjectRepository)(u.PaymentGatewayEntity)),d.__metadata("design:paramtypes",["function"==typeof(o=void 0!==c.Repository&&c.Repository)?o:Object,"function"==typeof(r=void 0!==l.PaymentService&&l.PaymentService)?r:Object])],m)},(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.PaypalModule=void 0;const o=a(4),r=a(1),n=a(11),i=a(157),d=a(58),y=a(13),s=a(14);let p=class PaypalModule{};t.PaypalModule=p,t.PaypalModule=p=o.__decorate([(0,r.Module)({imports:[d.PaymentModule,y.TypeOrmModule.forFeature([s.PaymentGatewayEntity])],providers:[n.PaypalService],exports:[n.PaypalService],controllers:[i.PaypalController]})],p)},(e,t,a)=>{var o,r,n,i,d,y,s;Object.defineProperty(t,"__esModule",{value:!0}),t.PaypalController=void 0;const p=a(4),c=a(1),u=a(6),_=a(11),l=a(13),m=a(15),v=a(21),f=a(14),g=a(24);let b=class PaypalController{constructor(e,t,a){this.payPalService=e,this.gatewayRepository=t,this.paymentService=a}async verifyPayPal(e,t){let a=await this.paymentService.getOne(e.query.token);if(null==a)throw new c.ForbiddenException("Transaction Not found.");const o=await this.gatewayRepository.findOneByOrFail({id:a.gatewayId});this.payPalService.verify(o,a.transactionNumber),a=await this.paymentService.updatePaymentStatus(a.id,g.PaymentStatus.Success);const r=await this.paymentService.getEncryptedWithPayment(a);t.redirect(301,`${a.returnUrl}?token=${r}`)}async cancelPayPal(e,t){const a=await this.paymentService.getOne(e.query.token),o=await this.paymentService.getEncryptedWithPayment(a);await this.paymentService.updatePaymentStatus(a.id,g.PaymentStatus.Canceled),t.redirect(301,`${a.returnUrl}?token=${o}`)}};t.PaypalController=b,p.__decorate([(0,c.Get)("verify"),p.__param(0,(0,c.Req)()),p.__param(1,(0,c.Res)()),p.__metadata("design:type",Function),p.__metadata("design:paramtypes",["function"==typeof(i=void 0!==u.FastifyRequest&&u.FastifyRequest)?i:Object,"function"==typeof(d=void 0!==u.FastifyReply&&u.FastifyReply)?d:Object]),p.__metadata("design:returntype",Promise)],b.prototype,"verifyPayPal",null),p.__decorate([(0,c.Get)("cancel"),p.__param(0,(0,c.Req)()),p.__param(1,(0,c.Res)()),p.__metadata("design:type",Function),p.__metadata("design:paramtypes",["function"==typeof(y=void 0!==u.FastifyRequest&&u.FastifyRequest)?y:Object,"function"==typeof(s=void 0!==u.FastifyReply&&u.FastifyReply)?s:Object]),p.__metadata("design:returntype",Promise)],b.prototype,"cancelPayPal",null),t.PaypalController=b=p.__decorate([(0,c.Controller)("paypal"),p.__param(1,(0,l.InjectRepository)(f.PaymentGatewayEntity)),p.__metadata("design:paramtypes",["function"==typeof(o=void 0!==_.PaypalService&&_.PaypalService)?o:Object,"function"==typeof(r=void 0!==m.Repository&&m.Repository)?r:Object,"function"==typeof(n=void 0!==v.PaymentService&&v.PaymentService)?n:Object])],b)},(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.PaystackModule=void 0;const o=a(4),r=a(1),n=a(13),i=a(14),d=a(24),y=a(58),s=a(159),p=a(26);let c=class PaystackModule{};t.PaystackModule=c,t.PaystackModule=c=o.__decorate([(0,r.Module)({imports:[y.PaymentModule,n.TypeOrmModule.forFeature([d.PaymentEntity,i.PaymentGatewayEntity])],controllers:[s.PaystackController],providers:[p.PaystackService],exports:[p.PaystackService]})],c)},(e,t,a)=>{var o,r,n,i,d;Object.defineProperty(t,"__esModule",{value:!0}),t.PaystackController=void 0;const y=a(4),s=a(1),p=a(13),c=a(6),u=a(15),_=a(14),l=a(24),m=a(21),v=a(26);let f=class PaystackController{constructor(e,t,a){this.paystackService=e,this.gatewayRepository=t,this.paymentService=a}async callback(e,t){console.log(`Verify Paystack called with query: ${JSON.stringify(e.query)}`);const a=e.query.reference;let o=await this.paymentService.getOne(a);if(null==o)throw new s.ForbiddenException("Transaction Not found.");const r=await this.gatewayRepository.findOneByOrFail({id:o.gatewayId}),n=await this.paystackService.verify(r,o.transactionNumber);await this.paymentService.updatePaymentStatus(o.id,n.status?l.PaymentStatus.Success:l.PaymentStatus.Canceled),o=await this.paymentService.getOne(a);const i=await this.paymentService.getEncryptedWithPayment(o);t.redirect(301,`${o.returnUrl}?token=${i}`)}};t.PaystackController=f,y.__decorate([(0,s.Get)("callback"),y.__param(0,(0,s.Req)()),y.__param(1,(0,s.Res)()),y.__metadata("design:type",Function),y.__metadata("design:paramtypes",["function"==typeof(i=void 0!==c.FastifyRequest&&c.FastifyRequest)?i:Object,"function"==typeof(d=void 0!==c.FastifyReply&&c.FastifyReply)?d:Object]),y.__metadata("design:returntype",Promise)],f.prototype,"callback",null),t.PaystackController=f=y.__decorate([(0,s.Controller)("paystack"),y.__param(1,(0,p.InjectRepository)(_.PaymentGatewayEntity)),y.__metadata("design:paramtypes",["function"==typeof(o=void 0!==v.PaystackService&&v.PaystackService)?o:Object,"function"==typeof(r=void 0!==u.Repository&&u.Repository)?r:Object,"function"==typeof(n=void 0!==m.PaymentService&&m.PaymentService)?n:Object])],f)},(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.PayTMModule=void 0;const o=a(4),r=a(29),n=a(1),i=a(13),d=a(14),y=a(24),s=a(58),p=a(161),c=a(39);let u=class PayTMModule{};t.PayTMModule=u,t.PayTMModule=u=o.__decorate([(0,n.Module)({imports:[s.PaymentModule,r.HttpModule,i.TypeOrmModule.forFeature([y.PaymentEntity,d.PaymentGatewayEntity])],controllers:[p.PayTMController],providers:[c.PayTMService],exports:[c.PayTMService]})],u)},(e,t,a)=>{var o,r,n,i,d,y,s,p;Object.defineProperty(t,"__esModule",{value:!0}),t.PayTMController=void 0;const c=a(4),u=a(29),_=a(1),l=a(13),m=a(6),v=a(30),f=a(15),g=a(14),b=a(24),S=a(21),P=a(39);let O=class PayTMController{constructor(e,t,a,o){this.payTMService=e,this.gatewayRepository=t,this.paymentService=a,this.httpService=o}async redirect(e,t){const a=await this.paymentService.getOne(e.query.transactionId),o=await this.gatewayRepository.findOneByOrFail({id:a.gatewayId}),r=`${null==process.env.DEMO_MODE?"https://securegw.paytm.in":"https://securegw-stage.paytm.in"}/theia/api/v1/processTransaction?mid=${o.merchantId}&orderId=${e.query.transactionId}`,n=(await(0,v.firstValueFrom)(this.httpService.post(r,{requestType:"NATIVE",mid:o.merchantId,orderId:e.query.transactionId},{headers:{"Content-Type":"application/json",txnToken:e.query.token}})),{merchantId:o.merchantId,orderId:e.query.transactionId});let i=`<html xmlns="https://www.w3.org/1999/xhtml"><head></head><body><form action="${r}" headers="" method="post" name="frm"> <input type="hidden" name="requestType" value="NATIVE" /> <input type="hidden" name="mid" value="$merchantId" /> <input type="hidden" name="orderId" value="$orderId" /></form> <script type='text/javascript'>document.frm.submit();<\/script></body></html>`;Object.entries(n).forEach((([e,t],a)=>i=i.replace(`$${e}`,t))),t.send(i),t.code(200)}async callback(e,t){console.log(`Verify Paystack called with query: ${JSON.stringify(e.query)}`);const a=e.query.reference;let o=await this.paymentService.getOne(a);if(null==o)throw new _.ForbiddenException("Transaction Not found.");const r=await this.gatewayRepository.findOneByOrFail({id:o.gatewayId});await this.payTMService.verify(r,o.transactionNumber);await this.paymentService.updatePaymentStatus(o.id,b.PaymentStatus.Success),o=await this.paymentService.getOne(a);const n=await this.paymentService.getEncryptedWithPayment(o);t.redirect(301,`${o.returnUrl}?token=${n}`)}};t.PayTMController=O,c.__decorate([(0,_.Get)("redirect"),c.__param(0,(0,_.Req)()),c.__param(1,(0,_.Res)()),c.__metadata("design:type",Function),c.__metadata("design:paramtypes",["function"==typeof(d=void 0!==m.FastifyRequest&&m.FastifyRequest)?d:Object,"function"==typeof(y=void 0!==m.FastifyReply&&m.FastifyReply)?y:Object]),c.__metadata("design:returntype",Promise)],O.prototype,"redirect",null),c.__decorate([(0,_.Get)("callback"),c.__param(0,(0,_.Req)()),c.__param(1,(0,_.Res)()),c.__metadata("design:type",Function),c.__metadata("design:paramtypes",["function"==typeof(s=void 0!==m.FastifyRequest&&m.FastifyRequest)?s:Object,"function"==typeof(p=void 0!==m.FastifyReply&&m.FastifyReply)?p:Object]),c.__metadata("design:returntype",Promise)],O.prototype,"callback",null),t.PayTMController=O=c.__decorate([(0,_.Controller)("paytm"),c.__param(1,(0,l.InjectRepository)(g.PaymentGatewayEntity)),c.__metadata("design:paramtypes",["function"==typeof(o=void 0!==P.PayTMService&&P.PayTMService)?o:Object,"function"==typeof(r=void 0!==f.Repository&&f.Repository)?r:Object,"function"==typeof(n=void 0!==S.PaymentService&&S.PaymentService)?n:Object,"function"==typeof(i=void 0!==u.HttpService&&u.HttpService)?i:Object])],O)},(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.PayUMoneyModule=void 0;const o=a(4),r=a(1),n=a(37),i=a(163),d=a(58),y=a(13),s=a(14);let p=class PayUMoneyModule{};t.PayUMoneyModule=p,t.PayUMoneyModule=p=o.__decorate([(0,r.Module)({imports:[d.PaymentModule,y.TypeOrmModule.forFeature([s.PaymentGatewayEntity])],providers:[n.PayUMoneyService],exports:[n.PayUMoneyService],controllers:[i.PayUMoneyController]})],p)},(e,t,a)=>{var o,r,n;Object.defineProperty(t,"__esModule",{value:!0}),t.PayUMoneyController=void 0;const i=a(4),d=a(1),y=a(6),s=a(24),p=a(21);let c=class PayUMoneyController{constructor(e){this.paymentService=e}async verify(e,t){const a=await this.paymentService.getOne(e.query.razorpay_payment_link_reference_id);if(null==a)throw new d.ForbiddenException("Transaction Not found.");const o=await this.paymentService.getEncryptedWithPayment(a);await this.paymentService.updatePaymentStatus(a.id,s.PaymentStatus.Success),t.redirect(301,`${a.returnUrl}?token=${o}`)}};t.PayUMoneyController=c,i.__decorate([(0,d.Get)("callback"),i.__param(0,(0,d.Req)()),i.__param(1,(0,d.Res)()),i.__metadata("design:type",Function),i.__metadata("design:paramtypes",["function"==typeof(r=void 0!==y.FastifyRequest&&y.FastifyRequest)?r:Object,"function"==typeof(n=void 0!==y.FastifyReply&&y.FastifyReply)?n:Object]),i.__metadata("design:returntype",Promise)],c.prototype,"verify",null),t.PayUMoneyController=c=i.__decorate([(0,d.Controller)("payumoney"),i.__metadata("design:paramtypes",["function"==typeof(o=void 0!==p.PaymentService&&p.PaymentService)?o:Object])],c)},(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.RazorPayModule=void 0;const o=a(4),r=a(1),n=a(35),i=a(165),d=a(58),y=a(13),s=a(14);let p=class RazorPayModule{};t.RazorPayModule=p,t.RazorPayModule=p=o.__decorate([(0,r.Module)({imports:[d.PaymentModule,y.TypeOrmModule.forFeature([s.PaymentGatewayEntity])],providers:[n.RazorPayService],exports:[n.RazorPayService],controllers:[i.RazorPayController]})],p)},(e,t,a)=>{var o,r,n,i,d;Object.defineProperty(t,"__esModule",{value:!0}),t.RazorPayController=void 0;const y=a(4),s=a(1),p=a(6),c=a(35),u=a(13),_=a(15),l=a(21),m=a(14),v=a(24);let f=class RazorPayController{constructor(e,t,a){this.razorpayService=e,this.gatewayRepository=t,this.paymentService=a}async verify(e,t){const a=await this.paymentService.getOne(e.query.razorpay_payment_link_reference_id);if(null==a)throw new s.ForbiddenException("Transaction Not found.");const o=await this.paymentService.getEncryptedWithPayment(a);await this.paymentService.updatePaymentStatus(a.id,v.PaymentStatus.Success),t.redirect(301,`${a.returnUrl}?token=${o}`)}};t.RazorPayController=f,y.__decorate([(0,s.Get)("callback"),y.__param(0,(0,s.Req)()),y.__param(1,(0,s.Res)()),y.__metadata("design:type",Function),y.__metadata("design:paramtypes",["function"==typeof(i=void 0!==p.FastifyRequest&&p.FastifyRequest)?i:Object,"function"==typeof(d=void 0!==p.FastifyReply&&p.FastifyReply)?d:Object]),y.__metadata("design:returntype",Promise)],f.prototype,"verify",null),t.RazorPayController=f=y.__decorate([(0,s.Controller)("razorpay"),y.__param(1,(0,u.InjectRepository)(m.PaymentGatewayEntity)),y.__metadata("design:paramtypes",["function"==typeof(o=void 0!==c.RazorPayService&&c.RazorPayService)?o:Object,"function"==typeof(r=void 0!==_.Repository&&_.Repository)?r:Object,"function"==typeof(n=void 0!==l.PaymentService&&l.PaymentService)?n:Object])],f)},(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.SberBankModule=void 0;const o=a(4),r=a(29),n=a(1),i=a(13),d=a(14),y=a(24),s=a(58),p=a(167),c=a(43);let u=class SberBankModule{};t.SberBankModule=u,t.SberBankModule=u=o.__decorate([(0,n.Module)({imports:[s.PaymentModule,r.HttpModule,i.TypeOrmModule.forFeature([y.PaymentEntity,d.PaymentGatewayEntity])],controllers:[p.SberBankController],providers:[c.SberBankService],exports:[c.SberBankService]})],u)},(e,t,a)=>{var o,r,n,i,d,y;Object.defineProperty(t,"__esModule",{value:!0}),t.SberBankController=void 0;const s=a(4),p=a(1),c=a(13),u=a(6),_=a(15),l=a(14),m=a(24),v=a(21),f=s.__importDefault(a(168));let g=class SberBankController{constructor(e,t){this.gatewayRepository=e,this.paymentService=t}async callback(e,t){console.log(`Verify SberBank called with query: ${JSON.stringify(e.query)}`);const a=e.query.orderNumber;let o=await this.paymentService.getOne(a);if(null==o)throw new p.ForbiddenException("Transaction Not found.");const r=await this.gatewayRepository.findOneBy({id:o.gatewayId});if(null==r)throw new p.ForbiddenException("Payment method not found.");const n=new f.default({userName:r.publicKey,password:r.privateKey},`${process.env.GATEWAY_SERVER_URL}/sberbank/callback`,null!=process.env.DEMO_MODE),i=await n.status(a);console.log(`SberBank order status: ${JSON.stringify(i)}`),await this.paymentService.updatePaymentStatus(o.id,"successful"==e.query.status?m.PaymentStatus.Success:m.PaymentStatus.Canceled),o=await this.paymentService.getOne(a);const d=await this.paymentService.getEncryptedWithPayment(o);t.redirect(301,`${o.returnUrl}?token=${d}`)}async cancel(e,t){}};t.SberBankController=g,s.__decorate([(0,p.Get)("callback"),s.__param(0,(0,p.Req)()),s.__param(1,(0,p.Res)()),s.__metadata("design:type",Function),s.__metadata("design:paramtypes",["function"==typeof(n=void 0!==u.FastifyRequest&&u.FastifyRequest)?n:Object,"function"==typeof(i=void 0!==u.FastifyReply&&u.FastifyReply)?i:Object]),s.__metadata("design:returntype",Promise)],g.prototype,"callback",null),s.__decorate([(0,p.Get)("cancel"),s.__param(0,(0,p.Req)()),s.__param(1,(0,p.Res)()),s.__metadata("design:type",Function),s.__metadata("design:paramtypes",["function"==typeof(d=void 0!==u.FastifyRequest&&u.FastifyRequest)?d:Object,"function"==typeof(y=void 0!==u.FastifyReply&&u.FastifyReply)?y:Object]),s.__metadata("design:returntype",Promise)],g.prototype,"cancel",null),t.SberBankController=g=s.__decorate([(0,p.Controller)("sberbank"),s.__param(0,(0,c.InjectRepository)(l.PaymentGatewayEntity)),s.__metadata("design:paramtypes",["function"==typeof(o=void 0!==_.Repository&&_.Repository)?o:Object,"function"==typeof(r=void 0!==v.PaymentService&&v.PaymentService)?r:Object])],g)},e=>{e.exports=require("sberbank-acquiring")},(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.StripeModule=void 0;const o=a(4),r=a(1),n=a(58),i=a(13),d=a(33),y=a(170),s=a(14),p=a(16),c=a(17),u=a(171),_=a(55),l=a(53),m=a(172);let v=class StripeModule{};t.StripeModule=v,t.StripeModule=v=o.__decorate([(0,r.Module)({imports:[n.PaymentModule,i.TypeOrmModule.forFeature([s.PaymentGatewayEntity,p.GatewayToUserEntity,c.SavedPaymentMethodEntity,_.PayoutAccountEntity,l.PayoutMethodEntity])],providers:[d.StripeService,m.StripePayoutService],exports:[d.StripeService],controllers:[y.StripeController,u.StripePayoutController]})],v)},(e,t,a)=>{var o,r,n,i,d,y,s,p,c,u,_,l;Object.defineProperty(t,"__esModule",{value:!0}),t.StripeController=void 0;const m=a(4),v=a(1),f=a(6),g=a(13),b=a(15),S=a(21),P=a(33),O=a(14),M=a(24),E=a(93),C=a(18);let h=class StripeController{constructor(e,t,a,o){this.stripeService=e,this.gatewayRepository=t,this.savedPaymentMethodRepository=a,this.paymentService=o}async webHook(e,t){t.send({status:"OK"})}async verify(e,t){let a=await this.paymentService.getOne(e.query.transactionId);if(null==a)throw new v.ForbiddenException("Transaction Not found.");const o=await this.gatewayRepository.findOneByOrFail({id:a.gatewayId}),r=await this.stripeService.verify(o,a.externalReferenceNumber);a=await this.paymentService.updatePaymentStatus(a.id,this.getPaymentStatusForPayment(r));const n=await this.paymentService.getEncryptedWithPayment(a);t.redirect(301,`${a.returnUrl}?token=${n}`)}async cancel(e,t){let a=await this.paymentService.getOne(e.query.transactionId);a=await this.paymentService.updatePaymentStatus(a.id,M.PaymentStatus.Canceled);const o=await this.paymentService.getEncryptedWithPayment(a);t.redirect(301,`${a.returnUrl}?token=${o}`)}async successAttach(e,t){const a=e.query.session_id;v.Logger.log(a,"success_attach.sessionId");const o=await this.paymentService.paymentRepository.findOneOrFail({where:{externalReferenceNumber:a}}),r=await this.gatewayRepository.findOneByOrFail({id:o.gatewayId});v.Logger.log(r,"success_attach.gateway");const n=await this.stripeService.getSession(r,a);v.Logger.log(n,"success_attach.session");const i=await this.stripeService.getSetupIntentPaymentMethodDetails(r,n.setup_intent);v.Logger.log(i,"success_attach.paymentMethod"),this.savedPaymentMethodRepository.update({riderId:"rider"==o.userType?parseInt(o.userId):void 0,driverId:"driver"==o.userType?parseInt(o.userId):void 0},{isDefault:!1});const d={riderId:"rider"==o.userType?parseInt(o.userId):void 0,driverId:"driver"==o.userType?parseInt(o.userId):void 0,paymentGatewayId:o.gatewayId,token:i.id,type:C.SavedPaymentMethodType.CARD,isDefault:!0,providerBrand:i.card?.brand,title:(i.card?.last4?i.card?.last4:i.card?.brand)??"-",expiryDate:new Date(i.card.exp_year,i.card.exp_month)};this.savedPaymentMethodRepository.save(d),t.redirect(301,o.returnUrl)}getPaymentStatusForPayment(e){return"complete"==e.status&&"unpaid"==e.payment_status?M.PaymentStatus.Authorized:"complete"==e.status&&"paid"==e.payment_status?M.PaymentStatus.Success:M.PaymentStatus.Failed}};t.StripeController=h,m.__decorate([(0,v.Post)("webhook"),m.__param(0,(0,v.Req)()),m.__param(1,(0,v.Res)()),m.__metadata("design:type",Function),m.__metadata("design:paramtypes",["function"==typeof(d=void 0!==f.FastifyRequest&&f.FastifyRequest)?d:Object,"function"==typeof(y=void 0!==f.FastifyReply&&f.FastifyReply)?y:Object]),m.__metadata("design:returntype",Promise)],h.prototype,"webHook",null),m.__decorate([(0,v.Get)("success"),m.__param(0,(0,v.Req)()),m.__param(1,(0,v.Res)()),m.__metadata("design:type",Function),m.__metadata("design:paramtypes",["function"==typeof(s=void 0!==f.FastifyRequest&&f.FastifyRequest)?s:Object,"function"==typeof(p=void 0!==f.FastifyReply&&f.FastifyReply)?p:Object]),m.__metadata("design:returntype",Promise)],h.prototype,"verify",null),m.__decorate([(0,v.Get)("cancel"),m.__param(0,(0,v.Req)()),m.__param(1,(0,v.Res)()),m.__metadata("design:type",Function),m.__metadata("design:paramtypes",["function"==typeof(c=void 0!==f.FastifyRequest&&f.FastifyRequest)?c:Object,"function"==typeof(u=void 0!==f.FastifyReply&&f.FastifyReply)?u:Object]),m.__metadata("design:returntype",Promise)],h.prototype,"cancel",null),m.__decorate([(0,v.Get)("success_attach"),m.__param(0,(0,v.Req)()),m.__param(1,(0,v.Res)()),m.__metadata("design:type",Function),m.__metadata("design:paramtypes",["function"==typeof(_=void 0!==f.FastifyRequest&&f.FastifyRequest)?_:Object,"function"==typeof(l=void 0!==f.FastifyReply&&f.FastifyReply)?l:Object]),m.__metadata("design:returntype",Promise)],h.prototype,"successAttach",null),t.StripeController=h=m.__decorate([(0,v.Controller)("stripe"),m.__param(1,(0,g.InjectRepository)(O.PaymentGatewayEntity)),m.__param(2,(0,g.InjectRepository)(E.SavedPaymentMethodEntity)),m.__metadata("design:paramtypes",["function"==typeof(o=void 0!==P.StripeService&&P.StripeService)?o:Object,"function"==typeof(r=void 0!==b.Repository&&b.Repository)?r:Object,"function"==typeof(n=void 0!==b.Repository&&b.Repository)?n:Object,"function"==typeof(i=void 0!==S.PaymentService&&S.PaymentService)?i:Object])],h)},(e,t,a)=>{var o,r,n,i,d,y;Object.defineProperty(t,"__esModule",{value:!0}),t.StripePayoutController=void 0;const s=a(4),p=a(1),c=a(6),u=a(172),_=s.__importDefault(a(34)),l=a(59),m=a(18);let v=class StripePayoutController{constructor(e,t){this.stripePayoutService=e,this.payoutService=t}async refresh(e,t){return"Link url expired, please try again."}async return(e,t){const a=await this.stripePayoutService.getStripePayoutMethod(e.query.payout_method_id),o=new _.default(a.privateKey,{apiVersion:"2022-11-15"}),r=await o.accounts.retrieve(e.query.account_id,{expand:["external_accounts","external_accounts.data.customer"]});if(!r.metadata.userId)throw new Error("Invalid account, it is not linked to any user.");p.Logger.log(`Linking account ${r.id} to user ${r.metadata.userId}`),p.Logger.log(r,"StripePayoutController.return.account");const n=r.external_accounts.data.find((e=>e.default_for_currency));if(null==n)throw new Error("No default account found.");if("bank_account"==n.object){let t=n;await this.payoutService.linkPayoutAccount({driverId:parseInt(r.metadata.userId),payoutMethodId:e.query.payout_method_id,token:r.id,name:t.bank_name,type:m.SavedPaymentMethodType.BANK_ACCOUNT,currency:t.currency,last4:t.last4,accountNumber:t.last4,accountHolderName:t.account_holder_name??void 0})}else{let t=n;await this.payoutService.linkPayoutAccount({driverId:parseInt(r.metadata.userId),payoutMethodId:e.query.payout_method_id,token:r.id,name:t.brand,type:m.SavedPaymentMethodType.CARD,currency:t.currency,last4:t.last4,accountHolderName:t.name??void 0,accountHolderState:t.address_state??void 0,accountHolderZip:t.address_zip??void 0,accountHolderAddress:t.address_line1??void 0,accountHolderCity:t.address_city??void 0,accountHolderCountry:t.address_country??void 0})}null!=r.metadata?.return_url?t.redirect(301,r.metadata.return_url):t.send("Account linked successfully.")}};t.StripePayoutController=v,s.__decorate([(0,p.Get)("refresh"),s.__param(0,(0,p.Req)()),s.__param(1,(0,p.Res)()),s.__metadata("design:type",Function),s.__metadata("design:paramtypes",["function"==typeof(n=void 0!==c.FastifyRequest&&c.FastifyRequest)?n:Object,"function"==typeof(i=void 0!==c.FastifyReply&&c.FastifyReply)?i:Object]),s.__metadata("design:returntype",Promise)],v.prototype,"refresh",null),s.__decorate([(0,p.Get)("return"),s.__param(0,(0,p.Req)()),s.__param(1,(0,p.Res)()),s.__metadata("design:type",Function),s.__metadata("design:paramtypes",["function"==typeof(d=void 0!==c.FastifyRequest&&c.FastifyRequest)?d:Object,"function"==typeof(y=void 0!==c.FastifyReply&&c.FastifyReply)?y:Object]),s.__metadata("design:returntype",Promise)],v.prototype,"return",null),t.StripePayoutController=v=s.__decorate([(0,p.Controller)("stripe/payout"),s.__metadata("design:paramtypes",["function"==typeof(o=void 0!==u.StripePayoutService&&u.StripePayoutService)?o:Object,"function"==typeof(r=void 0!==l.PayoutService&&l.PayoutService)?r:Object])],v)},(e,t,a)=>{var o;Object.defineProperty(t,"__esModule",{value:!0}),t.StripePayoutService=void 0;const r=a(4),n=a(13),i=a(53),d=a(15),y=a(1);let s=class StripePayoutService{constructor(e){this.payoutMethodRepository=e}async getStripePayoutMethod(e){return await this.payoutMethodRepository.findOneOrFail({where:{id:e}})}};t.StripePayoutService=s,t.StripePayoutService=s=r.__decorate([(0,y.Injectable)(),r.__param(0,(0,n.InjectRepository)(i.PayoutMethodEntity)),r.__metadata("design:paramtypes",["function"==typeof(o=void 0!==d.Repository&&d.Repository)?o:Object])],s)},(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.WayForPayModule=void 0;const o=a(4),r=a(29),n=a(1),i=a(13),d=a(14),y=a(24),s=a(58),p=a(174),c=a(46);let u=class WayForPayModule{};t.WayForPayModule=u,t.WayForPayModule=u=o.__decorate([(0,n.Module)({imports:[s.PaymentModule,r.HttpModule,i.TypeOrmModule.forFeature([y.PaymentEntity,d.PaymentGatewayEntity])],controllers:[p.WayForPayController],providers:[c.WayForPayService],exports:[c.WayForPayService]})],u)},(e,t,a)=>{var o,r,n,i,d;Object.defineProperty(t,"__esModule",{value:!0}),t.WayForPayController=void 0;const y=a(4),s=a(29),p=a(1),c=a(13),u=a(6),_=a(15),l=a(14),m=a(24),v=a(21),f=a(47),g=a(30);let b=class WayForPayController{constructor(e,t,a){this.gatewayRepository=e,this.paymentService=t,this.httpService=a}async callback(e,t){console.log(`Notify wayforpay called with body: ${JSON.stringify(e.body)} & query: ${JSON.stringify(e.query)}`);let a=await this.paymentService.getOne(e.body.orderReference),o=await this.gatewayRepository.findOneByOrFail({id:a.gatewayId});const r=new f.WFP({MERCHANT_ACCOUNT:o.merchantId,MERCHANT_SECRET_KEY:o.privateKey,MERCHANT_DOMAIN_NAME:o.publicKey,SERVICE_URL:`${process.env.GATEWAY_SERVER_URL}wayforpay/callback`}),n=r.parseAndVerifyIncomingWebhook(e.body),i=r.prepareSignedWebhookResponse(n);a=await this.paymentService.updatePaymentStatus(a.id,"Approved"===n.transactionStatus?m.PaymentStatus.Success:m.PaymentStatus.Canceled);const d=await this.paymentService.getEncryptedWithPayment(a);await(0,g.firstValueFrom)(this.httpService.get(`${a.returnUrl}?token=${d}`)),t.send(i)}};t.WayForPayController=b,y.__decorate([(0,p.Get)("callback"),y.__param(0,(0,p.Req)()),y.__param(1,(0,p.Res)()),y.__metadata("design:type",Function),y.__metadata("design:paramtypes",["function"==typeof(i=void 0!==u.FastifyRequest&&u.FastifyRequest)?i:Object,"function"==typeof(d=void 0!==u.FastifyReply&&u.FastifyReply)?d:Object]),y.__metadata("design:returntype",Promise)],b.prototype,"callback",null),t.WayForPayController=b=y.__decorate([(0,p.Controller)("wayforpay"),y.__param(0,(0,c.InjectRepository)(l.PaymentGatewayEntity)),y.__metadata("design:paramtypes",["function"==typeof(o=void 0!==_.Repository&&_.Repository)?o:Object,"function"==typeof(r=void 0!==v.PaymentService&&v.PaymentService)?r:Object,"function"==typeof(n=void 0!==s.HttpService&&s.HttpService)?n:Object])],b)},(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.InstaMojoModule=void 0;const o=a(4),r=a(1),n=a(13),i=a(14),d=a(24),y=a(58),s=a(176),p=a(48);let c=class InstaMojoModule{};t.InstaMojoModule=c,t.InstaMojoModule=c=o.__decorate([(0,r.Module)({imports:[y.PaymentModule,n.TypeOrmModule.forFeature([d.PaymentEntity,i.PaymentGatewayEntity])],controllers:[s.InstaMojoController],providers:[p.InstaMojoService],exports:[p.InstaMojoService]})],c)},(e,t,a)=>{var o,r,n,i,d,y,s;Object.defineProperty(t,"__esModule",{value:!0}),t.InstaMojoController=void 0;const p=a(4),c=a(1),u=a(13),_=a(6),l=a(15),m=a(14),v=a(21),f=a(48);let g=class InstaMojoController{constructor(e,t,a){this.gatewayRepository=e,this.paymentService=t,this.instamojoService=a}async redirect(e,t){}async callback(e,t){await this.gatewayRepository.findOneBy({id:parseInt(e.query.gatewayId)})}};t.InstaMojoController=g,p.__decorate([(0,c.Get)("redirect"),p.__param(0,(0,c.Req)()),p.__param(1,(0,c.Res)()),p.__metadata("design:type",Function),p.__metadata("design:paramtypes",["function"==typeof(i=void 0!==_.FastifyRequest&&_.FastifyRequest)?i:Object,"function"==typeof(d=void 0!==_.FastifyReply&&_.FastifyReply)?d:Object]),p.__metadata("design:returntype",Promise)],g.prototype,"redirect",null),p.__decorate([(0,c.Get)("callback"),p.__param(0,(0,c.Req)()),p.__param(1,(0,c.Res)()),p.__metadata("design:type",Function),p.__metadata("design:paramtypes",["function"==typeof(y=void 0!==_.FastifyRequest&&_.FastifyRequest)?y:Object,"function"==typeof(s=void 0!==_.FastifyReply&&_.FastifyReply)?s:Object]),p.__metadata("design:returntype",Promise)],g.prototype,"callback",null),t.InstaMojoController=g=p.__decorate([(0,c.Controller)("instamojo"),p.__param(0,(0,u.InjectRepository)(m.PaymentGatewayEntity)),p.__metadata("design:paramtypes",["function"==typeof(o=void 0!==l.Repository&&l.Repository)?o:Object,"function"==typeof(r=void 0!==v.PaymentService&&v.PaymentService)?r:Object,"function"==typeof(n=void 0!==f.InstaMojoService&&f.InstaMojoService)?n:Object])],g)},(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.BinancePayModule=void 0;const o=a(4),r=a(29),n=a(1),i=a(13),d=a(14),y=a(24),s=a(58),p=a(178),c=a(50);let u=class BinancePayModule{};t.BinancePayModule=u,t.BinancePayModule=u=o.__decorate([(0,n.Module)({imports:[s.PaymentModule,r.HttpModule,i.TypeOrmModule.forFeature([y.PaymentEntity,d.PaymentGatewayEntity])],controllers:[p.BinancePayController],providers:[c.BinancePayService],exports:[c.BinancePayService]})],u)},(e,t,a)=>{var o,r,n,i,d,y;Object.defineProperty(t,"__esModule",{value:!0}),t.BinancePayController=void 0;const s=a(4),p=a(29),c=a(1),u=a(13),_=a(6),l=a(15),m=a(14),v=a(21),f=a(23),g=a(50),b=a(24),S=a(30);let P=class BinancePayController{constructor(e,t,a,o){this.gatewayRepository=e,this.paymentService=t,this.httpService=a,this.binancePayService=o}async callback(e,t){console.log(JSON.stringify(e.body),"req.body");const a=JSON.parse(e.body.data);let o=await this.paymentService.getOne(a.merchantTradeNo),r=await this.gatewayRepository.findOneByOrFail({id:o.gatewayId});console.log("Verifying Signature...");const n={...e.body,bizId:e.body.bizIdStr},i=`${e.headers["binancepay-timestamp"]}\n${e.headers["binancepay-nonce"]}\n${JSON.stringify(n).replace(/"bizId":"(\d+)"/g,'"bizId":$1')}\n`,d=(await this.binancePayService.getPublicKey(r)).data[0].certPublic,y=Buffer.from(e.headers["binancepay-signature"],"base64"),s=(0,f.createVerify)("SHA256");s.write(i),s.end();if(0==s.verify(d,y))throw new Error("Signature verification failed");o=await this.paymentService.updatePaymentStatus(o.id,"PAY_SUCCESS"==e.body.bizStatus?b.PaymentStatus.Success:b.PaymentStatus.Failed);const p=await this.paymentService.getEncryptedWithPayment(o);return await(0,S.firstValueFrom)(this.httpService.get(`${o.returnUrl}?token=${p}`)),{status:"SUCCESS"}}};t.BinancePayController=P,s.__decorate([(0,c.Post)("callback"),s.__param(0,(0,c.Req)()),s.__param(1,(0,c.Res)()),s.__metadata("design:type",Function),s.__metadata("design:paramtypes",["function"==typeof(d=void 0!==_.FastifyRequest&&_.FastifyRequest)?d:Object,"function"==typeof(y=void 0!==_.FastifyReply&&_.FastifyReply)?y:Object]),s.__metadata("design:returntype",Promise)],P.prototype,"callback",null),t.BinancePayController=P=s.__decorate([(0,c.Controller)("binance"),s.__param(0,(0,u.InjectRepository)(m.PaymentGatewayEntity)),s.__metadata("design:paramtypes",["function"==typeof(o=void 0!==l.Repository&&l.Repository)?o:Object,"function"==typeof(r=void 0!==v.PaymentService&&v.PaymentService)?r:Object,"function"==typeof(n=void 0!==p.HttpService&&p.HttpService)?n:Object,"function"==typeof(i=void 0!==g.BinancePayService&&g.BinancePayService)?i:Object])],P)},(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.OpenPixModule=void 0;const o=a(4),r=a(1),n=a(13),i=a(14),d=a(24),y=a(58),s=a(52),p=a(180),c=a(29);let u=class OpenPixModule{};t.OpenPixModule=u,t.OpenPixModule=u=o.__decorate([(0,r.Module)({imports:[y.PaymentModule,c.HttpModule,n.TypeOrmModule.forFeature([d.PaymentEntity,i.PaymentGatewayEntity])],controllers:[p.OpenPixController],providers:[s.OpenPixService],exports:[s.OpenPixService]})],u)},(e,t,a)=>{var o,r,n,i;Object.defineProperty(t,"__esModule",{value:!0}),t.OpenPixController=void 0;const d=a(4),y=a(1),s=a(6),p=a(24),c=a(21),u=a(13),_=a(83),l=a(15);let m=class OpenPixController{constructor(e,t){this.paymentService=e,this.paymentGatewayRepository=t}async callback(e,t){if(y.Logger.log(`callback query:${JSON.stringify(e.body)}`,"OpenPixController"),null==e.body?.charge)return void t.send(200);let a=await this.paymentService.getOne(e.body.charge.correlationID);if(null!=a){const o=e.body.charge.status;if("ACTIVE"===o)return void t.send(200);a=await this.paymentService.updatePaymentStatus(a.id,"COMPLETED"===o?p.PaymentStatus.Success:p.PaymentStatus.Failed);const r=await this.paymentService.getEncryptedWithPayment(a);t.redirect(301,`${a.returnUrl}?token=${r}`)}else t.send(200)}};t.OpenPixController=m,d.__decorate([(0,y.Post)("callback"),d.__param(0,(0,y.Req)()),d.__param(1,(0,y.Res)()),d.__metadata("design:type",Function),d.__metadata("design:paramtypes",["function"==typeof(n=void 0!==s.FastifyRequest&&s.FastifyRequest)?n:Object,"function"==typeof(i=void 0!==s.FastifyReply&&s.FastifyReply)?i:Object]),d.__metadata("design:returntype",Promise)],m.prototype,"callback",null),t.OpenPixController=m=d.__decorate([(0,y.Controller)("openpix"),d.__param(1,(0,u.InjectRepository)(_.PaymentGatewayEntity)),d.__metadata("design:paramtypes",["function"==typeof(o=void 0!==c.PaymentService&&c.PaymentService)?o:Object,"function"==typeof(r=void 0!==l.Repository&&l.Repository)?r:Object])],m)},(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.PayTRModule=void 0;const o=a(4),r=a(1),n=a(56),i=a(29);let d=class PayTRModule{};t.PayTRModule=d,t.PayTRModule=d=o.__decorate([(0,r.Module)({imports:[i.HttpModule],providers:[n.PayTRService]})],d)},e=>{e.exports=require("@nestjs/platform-fastify")}],t={};function a(o){var r=t[o];if(void 0!==r)return r.exports;var n=t[o]={exports:{}};return e[o](n,n.exports,a),n.exports}var o={};(()=>{var e=o;Object.defineProperty(e,"__esModule",{value:!0});const t=a(1),r=a(2),n=a(3),i=a(182);!async function(){const e=new i.FastifyAdapter,a=await r.NestFactory.create(n.AppModule,e),o=process.env.GATEWAY_API_PORT||3333;a.enableCors(),await a.listen(o,"0.0.0.0",(()=>{t.Logger.log("Listening at http://localhost:"+o)}))}()})();var r=exports;for(var n in o)r[n]=o[n];o.__esModule&&Object.defineProperty(r,"__esModule",{value:!0})})();